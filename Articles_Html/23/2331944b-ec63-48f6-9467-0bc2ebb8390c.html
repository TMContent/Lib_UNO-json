<h1>What to Check For</h1>
  <p>Ensure that direct access to your database server is prevented.</p>
  <h1>Why</h1>
  <p>Direct access allows an attacker to use tools such as Query Analyzer (Isqlw.exe) and establish a connection to the SQL Server and issue commands. This could lead to unauthorized access to data.</p>
  <h1>How to Check</h1>
  <p>Follow these steps to restrict access to the SQL server to prevent unauthorized use:</p>
  <ol>
    <li>
      <p>
        <strong>Ensure access from the external network is prevented.</strong> Check that the firewall is configured such that the SQL server and its ports (TCP 1433 and UDP 1434 by default) are not directly accessible outside the network perimeter. Verify this using a port scanning tool such as Nmap.</p>
      <li>
        <p>
          <strong>Verify that access from within the perimeter is restricted. </strong>Access to the SQL server, even from within the internal network, should be restricted by the use of internal firewalls and IPSec. IPSec can be used to provide server authentication and can help ensure that only the middle-tier application server can connect to the SQL database server. This ensures that the SQL server is protected in cases when hosts on the internal network have been compromised. IPSec also can be used to restrict the ports on which your database server accepts incoming connections. Use a network sniffer to check if all packets between the specified hosts and the SQL server contain an Authentication Header (AH) and Encapsulating Security Payload (ESP) fields after the IP headers to ensure that IPSec has been implemented properly.</p>
        <li>
          <p>
            <strong>Ensure that exposure of the SQL server is minimized.</strong> Ensure that access to the production databse server is restricted to the production application server(s) and a minimum set of maintenance systems for the purpose of logging, backup, monitoring and administration. The production database server should not be accessible to development systems, and a separate database server should be used for development.</p>
        </li>
      </li>
    </li>
  </ol>
  <h1>Problem Example</h1>
  <p>A financial firm uses a web application to allow its agents to interact with the company database. To prevent attackers, the firm uses a firewall which restricts attackers from accessing the database server. However, one of the workstations inside the firewall gets infected with malware. This workstation is exploited by attackers to scan the internal network. When the attackers discover the SQL Server, they use tools such as the Query Analyzer to connect to and issue commands to it, using the compromised workstation as a proxy.</p>
  <h1>Additional Resources</h1>
  <ul>
    <li>
      <a href="http://msdn2.microsoft.com/en-us/library/aa302366.aspx">How To: Use IPSec for Filtering Ports and Authentication</a>
    </li>
  </ul>
  <h1>Related Guideline</h1>
  <ul>
    <li>
      <a href="/article/497597e5-4f03-48f1-83c7-c3cd5356d17e">Guideline: Allow Only Trusted Hosts to Connect to Database Server</a>
    </li>
  </ul>
  <hr />
  <p>Adapted from Microsoft patterns & practices guidance.</p>