<h1>Applies To</h1>
  <ul>
    <li>ASP.NET 4.0</li>
  </ul>
  <h1>Summary</h1>
  <p>The purpose of this code snippet is to illustrate the use of regular expressions to perform validation of user input within an application. Many common attack vectors make use of malicious input data and rely on poor or nonexistent validation of user-supplied input in order to successfully exploit application vulnerabilities.</p>
  <p>These following validation routines make use of regular expressions to ensure that input accepted by an application conforms to predetermined and expected character syntax requirements. This practice is sometimes called "whitelist" validation and is ideally suited to the use of regular expressions.</p>
  <h1>Objectives</h1>
  <ul>
    <li>Defend against common security attacks by validating that user input data meets known-valid syntax requirements. </li>
    <li>Define a set of reusable code-based validation methods that can be reused within different applications or application components.</li>
  </ul>
  <h1>Scenarios</h1>
  <ul>
    <li>Application makes use of user input in any form, whether in processing operations, storage or database queries. </li>
    <li>Application makes use of data that comes from any other untrusted source, such as a third-party data feed or file upload. </li>
    <li>Application does not already make use a validation scheme for input data. </li>
  </ul>
  <h1>Solution Example</h1>
  <p>The solution example defines 16 regular expression validation functions and a helper method that address a common set of application input data types. The regular expression validation functions are:</p>
  <pre>&amp;nbsp;&amp;nbsp;&amp;nbsp;IsValidUserName&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; IsValidCCNumber<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;IsValidPassword&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; IsValidSSN<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;IsValidName&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;    &amp;nbsp;&amp;nbsp;&amp;nbsp; IsValidEmailAddress<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;IsValidStreetAddress&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;   &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; IsValidURL<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;IsValidCity&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;    &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; IsValidIPAddress<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;IsValidUSState&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; IsValidAlphaText<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;IsValidZIPCode&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; IsValidAlphaNumericText<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;IsValidUSPhoneNumber&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;   &amp;nbsp;&amp;nbsp;&amp;nbsp; IsValidNumericText<br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;// Decomposed method which actually creates the pattern object and determines the match.<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;// Used by all of the other functions. <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;static bool MatchString(string str, string regexstr)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;{<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; str = str.Trim();<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; System.Text.RegularExpressions.Regex pattern = new System.Text.RegularExpressions.Regex(regexstr);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return pattern.IsMatch(str);<br />&amp;nbsp;&amp;nbsp; }<br /><br />&amp;nbsp;&amp;nbsp; static bool IsValidUserName(string strUsername)<br />&amp;nbsp;&amp;nbsp; {<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Allows word characters [A-Za-z0-9_], single quote, dash and period<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // must be at least two characters long and less then 128<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; string regExPattern = @"^[\w-'\.]{2,128}$";<br /><br /> &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // We also permit email address characters in user name. Set to false<br />&amp;nbsp;  &amp;nbsp;&amp;nbsp;&amp;nbsp; // if you don't permit email addresses as usernames. <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; bool allowEmailUsernames = true;<br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (allowEmailUsernames)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; {<br /> &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return (MatchString(strUsername, regExPattern) || IsValidEmailAddress(strUsername));<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; else<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; {<br />&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return MatchString(strUsername, regExPattern);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }<br />&amp;nbsp;&amp;nbsp; }<br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;static bool IsValidPassword(string strPassword)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;{<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Allows any type of character<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // If complexity is enabled, the password must be longer<br /> &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // and contain at least one uppercase, one lowercase, <br />&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // one numeric and one symbolic character. Set to false <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // if your requirements differ.<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; bool passwordComple'ity = true;<br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // These are some proposed minimum password lengths. If<br /> &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // complexity is enabled (above), the stronger (longer) <br />&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // minimum password rule applies. <br />&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; int minPasswordLen = 6;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp; int strongPasswordLen = 8;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if(passwordComplexity){<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; string regExPattern =<br />          @"^.*(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[`~!@#\$%\^\&amp;\*\(\)-_\=\+\[\{\]\}\\\|;:',&lt;\.&gt;/?]).*$";&amp;nbsp; <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return(strPassword.Length &gt;= strongPasswordLen &amp;&amp; MatchString(strPassword, regExPattern));<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }<br />       else {<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return(strPassword.Length &gt;= minPasswordLen);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;} <br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;static bool IsValidName(string strName)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;{<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Allows alphabetical chars, single quote, dash and space<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// must be at least two characters long and caps out at 128 (database size)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;string regExPattern = @"^[a-zA-Z-'\.\s]{2,128}$";&amp;nbsp; <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return MatchString(strName, regExPattern);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;}<br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;static bool IsValidStreetAddress(string strAddress)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;{<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Since so many different types of address formats we're just going to swing the bat at <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;  // this one for now and do a match against a series of digits (potentially containing<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // punctuation), followed by a series of characters representing the street name and then<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // potentially a type of street and unit number<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;string regExPattern = @"\d{1,3}.?\d{0,3}\s[a-zA-Z]{2,30}(\s[a-zA-Z]{2,15})?([#\.0-9a-zA-Z]*)?";<br />     return MatchString(strAddress, regExPattern);<br />&amp;nbsp;&amp;nbsp; }<br /><br />&amp;nbsp;&amp;nbsp; static bool IsValidCity(string strCity)<br />&amp;nbsp;&amp;nbsp; {<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Here we simply treat city names like people names and defer to our name validation function. <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return IsValidName(strCity);<br />&amp;nbsp;&amp;nbsp; }<br /><br /> &amp;nbsp; static bool IsValidUSState(string strState)<br />&amp;nbsp;  {<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// Names of 50 US States<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;string[] stateNames=&amp;nbsp;&amp;nbsp;{"ALABAMA","ALASKA","ARIZONA","ARKANSAS","CALIFORNIA","COLORADO","CONNECTICUT","DELAWARE",<br />                            "FLORIDA","GEORGIA","HAWAII","IDAHO","ILLINOIS","INDIANA","IOWA","KANSAS","KENTUCKY","LOUISIANA",<br />                            "MAINE","MARYLAND","MASSACHUSETTS","MICHIGAN","MINNESOTA","MISSISSIPPI","MISSOURI","MONTANA",<br />                            "NEBRASKA","NEVADA","NEW HAMPSHIRE","NEW JERSEY","NEW MEXICO","NEW YORK","NORTH CAROLINA",<br />                            "NORTH DAKOTA","OHIO","OKLAHOMA","OREGON","PENNSYLVANIA","RHODE ISLAND","SOUTH CAROLINA",<br />                            "SOUTHDAKOTA","TENNESSEE","TEXAS","UTAH","VERMONT","VIRGINIA","WASHINGTON","WEST VIRGINIA",<br />                            "WISCONSIN","WYOMING"};<br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Postal codes of 50 US States<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; string[] stateCodes =&amp;nbsp;&amp;nbsp;{"AL","AK","AZ","AR","CA","CO","CT","DE","DC","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA",<br />                             "ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR",<br />                             "PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"};<br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // This one is somewhat easier because we have a finite set of values to check against.<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // We simply uppercase our value anc check against our list.<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; strState = strState.ToUpper();<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ArrayList stateCodesArray = new ArrayList(stateCodes);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ArrayList stateNamesArray = new ArrayList(stateNames);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return (stateCodesArray.Contains(strState) || stateNamesArray.Contains(strState));<br />&amp;nbsp;&amp;nbsp; }<br /><br />&amp;nbsp;&amp;nbsp; static bool IsValidZIPCode(string strZIP)<br />&amp;nbsp;&amp;nbsp; {<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Allows 5 digit, 5+4 digit and 9 digit zip codes<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // must be at least two characters long and caps out at 128 (database size)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;string regExPattern = @"^(\d{5}-\d{4}|\d{5}|\d{9})$";<br /><strong>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; </strong>return MatchString(strZIP, regExPattern);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;}<br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;static bool IsValidUSPhoneNumber(string strPhone)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;{<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;  // Allows phone number of the format: <br />     // NPA = [2-9][0-8][0-9] Nxx = [2-9][0-9][0-9] Station = [0-9][0-9][0-9][0-9]<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;string regExPattern = @"^[01]?[- .]?(\([2-9]\d{2}\)|[2-9]\d{2})[- .]?\d{3}[- .]?\d{4}$";&amp;nbsp; <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return MatchString(strPhone, regExPattern);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;}<br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;static bool IsValidCCNumber(string strCCNumber)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;{<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // This expression is basically looking for series of numbers confirming to the standards<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // for Visa, MC, Discover and American Express with optional dashes between groups of numbers<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;  string regExPattern = @"^((4\d{3})|(5[1-5]\d{2})|(6011))-?\d{4}-?\d{4}-?\d{4}|3[4,7][\d\s-]{15}$";<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return MatchString(strCCNumber, regExPattern);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;} <br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;static bool IsValidSSN(string strSSN)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;{<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;  // Allows SSN's of the format 123-456-7890. Accepts hyphen delimited SSNs or plain numeric values.<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; string regExPattern = @"^\d{3}[-]?\d{2}[-]?\d{4}$";<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return MatchString(strSSN, regExPattern);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;}<br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;static bool IsValidEmailAddress(string strEmail) <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;{<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Allows common email address that can start with a alphanumeric char and contain word, dash and period characters<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;  // followed by a domain name meeting the same criteria followed by a alpha suffix between 2 and 9 character lone<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; string regExPattern = @"^([0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*@([0-9a-zA-Z][-\w]*[0-9a-zA-Z]\.)+[a-zA-Z]{2,9})$";&amp;nbsp; <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return MatchString(strEmail, regExPattern);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;} <br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;static bool IsValidURL(string strURL)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;{<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Allows HTTP'and FTP URL's, domain name must start with alphanumeric and can contain a port number<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // followed by a path containing a standard path character and ending in common file suffixies found in URL's<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// and accounting for potential CGI GET data<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;string regExPattern = @"^^(ht|f)tp(s?)\:\/\/[0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*(:(0-9)*)*(\/?)([a-zA-Z0-9\-\.\?\,\'\/\\\+&amp;%\$#_=]*)?$";&amp;nbsp; <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return MatchString(strURL, regExPattern);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;}<br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;static bool IsValidIPAddress(string strIP)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;{<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Allows four octets of numbers that contain values between 4 numbers in the IP address to 0-255 and are separated by periods<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;  string regExPattern = @"^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$";<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return MatchString(strIP, regExPattern);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;}<br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;static bool IsValidAlphaText(string strAlpha)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;{<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Allows one or more alphabetical characters. This is a more generic validation function.<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; string regExPattern = @"^[A-Za-z]+$";<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return MatchString(strAlpha, regExPattern);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;}<br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;static bool IsValidAlphaNumericText(string strAlphaNum)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;{<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Allows one or more alphabetical and/or numeric characters. This is a more generic validation function.<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; string regExPattern = @"^[A-Za-z0-9]+$";<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return MatchString(strAlphaNum, regExPattern);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;}<br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;static bool IsValidNumericText(string strNumeric)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;{<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Allows one or more positive or negative, integer or decimal numbers. This is a more generic validation function.<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; string regExPattern = @"/[+-]?\d+(\.\d+)?$";<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return MatchString(strNumeric, regExPattern);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;}</pre>
  <h1>Problem Example</h1>
  <p>The following example demonstrates show the use of unvalidated ASP.NET user input in a dynamic-generated SQL query. This code is vulnerable to SQL injection.</p>
  <pre>&amp;nbsp;&amp;nbsp;&amp;nbsp;string sParam = Request["first_name"];<br />&amp;nbsp;&amp;nbsp; // Create a new SQL Command object with our query<br />&amp;nbsp;&amp;nbsp; // Dynamically generate SQL query using passed parameter<br />&amp;nbsp;&amp;nbsp; SqlCommand sqlCommand = new SqlCommand("SELECT first, last FROM people WHERE first = '" + sParam + "'");</pre>
  <ul>
    <li>If the user inserts SQL metacharacters into the '<em>first_name</em>' argument, SQL commands can be executed.</li>
    <li>User data is accessed and processed by the application without any kind of validation. This is a very common practice amongst application developers and results in many of the security vulnerabilities discovered. </li>
  </ul>
  <h1>Test Case</h1>
  <p>The following classes must be included in any project making use of the sample code provided above:</p>
  <pre>&amp;nbsp;&amp;nbsp;&amp;nbsp;using System.Collections;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;using System.Collections.Generic;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;using System.Text;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;using System.Text.RegularExpressions;</pre>
  <p>The test case illustrates the user of all 16 of the defined regular expression validation functions:</p>
  <pre>
    <strong>&amp;nbsp;</strong>static void Main(string[] args)<br />&amp;nbsp;{<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Validate some usernames<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("Jonathan is a valid username: " + IsValidUserName("Jonathan").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("Jonathan!'+ is a valid state: " + IsValidUserName("Jonathan!'+").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine(""); <br /><br /> &amp;nbsp;&amp;nbsp;&amp;nbsp; // Validate some passwords<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("J0na+han is a valid password: " + IsValidPassword("J0na+han!").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("jb is a valid password: " + IsValidPassword("jb").ToString());<br />&amp;nbsp; &amp;nbsp;&amp;nbsp; Console.WriteLine("");<br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Validate some names<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("Jonathan is a valid name: " + IsValidName("Jonathan").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("Jonathan Bailey is a valid name: " + IsValidName("Jonathan Bailey").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("Jonathan GT Bailey is a valid name: " + IsValidName("Jonathan GT Bailey").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("Shawn O'Brien 's a valid name: " + IsValidName("Shawn O'Brien").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Console.WriteLine("Steve Holt! is a valid name: " + IsValidName("Steve Holt!").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Console.WriteLine("");<br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Validate some street addresses<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("123 Main St. is a valid street address: " + IsValidStreetAddress("123 Main St.").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("45-50 South Lake Road is a valid street address: " + IsValidStreetAddress("45-50 South Lake Road").ToString());<br /> &amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("45-50 South Lake Road #8 is a valid street address: " + IsValidStreetAddress("45-50 South Lake Road #8").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("45-50!!! South Lake Road is a valid street address: " + IsValidStreetAddress("45-50!! South Lake Road").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("");<br /><br />&amp;nbsp; &amp;nbsp;&amp;nbsp; // Validate some cities<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("Chicago is a valid name: " + IsValidCity("Chicago").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("Los Angeles is a valid city name: " + IsValidCity("Los Angeles").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("Jones-Parker Corner is a valid city name: " + IsValidCity("Jones-Parker Corner").ToString());<br /> &amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("(*&amp;(*&amp;ville is a valid name: " + IsValidCity("(*&amp;(*&amp;ville").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("");<br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Validate some states<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("Massachusetts is a valid state: " + IsValidUSState("Massachusetts").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("Foobar is a valid state: " + IsValidUSState("Foobar").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("");<br /><br /> &amp;nbsp;&amp;nbsp;&amp;nbsp; // Validate some ZIP Codes<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("90034 is a valid zip code: " + IsValidUSState("90034").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("90034-1234 is a valid zip code: " + IsValidZIPCode("90034-1234").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Console.WriteLine("900345 is a valid zip code: " + IsValidUSState("900345").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("");<br /><br />  &amp;nbsp;&amp;nbsp; // Validate some US Phone Numbers<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("1-617-555-1212 is a valid US phone number: " + IsValidUSPhoneNumber("1-617-555-1212").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("(617) 555-1212 is a valid US phone number: " + IsValidUSPhoneNumber("(617) 555-1212").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("617.555.1212 is a valid US phone number: " + IsValidUSPhoneNumber("617.555.1212").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("6175551212 is a valid US phone number: " + IsValidUSPhoneNumber("6175551212").ToString());<br />&amp;nbsp;&amp;nbsp; &amp;nbsp; Console.WriteLine("617/555/1212 is a valid US phone number: " + IsValidUSPhoneNumber("617/5551212").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("");<br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Validate some credit card numbers<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("4444-1234-5678-9900 is a valid credit card number: " + IsValidCCNumber("4444-1234-5678-9900").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("3718 123456 78900 is a valid credit card number: " + IsValidCCNumber("3718 123456 78900").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("1234567890 is a valid credit card number: " + IsValidCCNumber("1234567890").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("");<br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Validate some SSN's<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("123-45-6789 is a valid Social Security Number: " + IsValidSSN("123-45-6789").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("987654321 is a valid Social Security Number: " + IsValidSSN("987654321").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("123-456 is a valid Social Security Number: " + IsValidSSN("123-456").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("");<br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Validate some email addresses<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("pentest@msn.com is a valid email address: " + IsValidEmailAddress("pentest@msn.com").ToString()';<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("Jonathan_Bailey-01@mail.msn.com is a valid email address: " <br />			+&amp;nbsp;&amp;nbsp;IsValidEmailAddress("Jonathan_Bailey-01@mail.msn.com").ToString());<br /> &amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("Jonathan_Bailey@msn is a valid email address: " +&amp;nbsp;IsValidEmailAddress("Jonathan_Bailey@msn").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("");<br /><br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Validate some URL's<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("http://www.microsoft.com is a valid URL: " <br />			+ IsValidURL("http://www.microsoft.com").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("https://secure.microsoft.com:443/Default.aspx is a valid URL: " <br />			+ IsValidURL("https://secure.microsoft.com:443/Default.aspx").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("ftp://ftp.microsoft.com/download.html#tools is a valid URL: " <br />			+&amp;nbsp;IsValidURL("ftp://ftp.microsoft.com/download.html#tools").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("http://100?arg=val is a valid URL: " <br />			+ IsValidURL("http://100?arg=val").ToString());<br />&amp;nbsp; &amp;nbsp;&amp;nbsp; Console.WriteLine("http://= is a valid URL: " + IsValidURL("http://=").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("");<br /><br /> &amp;nbsp;&amp;nbsp;&amp;nbsp; // Validate some IP Addresses<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("192.168.0.1 is a valid IP Address: " + IsValidIPAddress("192.168.0.1").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("0.0.0.0 is a valid IP Address: " + IsValidIPAddress("192.168.0.1").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("300.300.300.300 is a valid IP Address: " + IsValidIPAddress("300.300.300.300").ToString());<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Console.WriteLine("");&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; <br />&amp;nbsp;}&amp;nbsp;</pre>
  <h1>Expected Result</h1>
  <pre>
    <strong>
    </strong>  Jonathan Bailey is a valid name: True<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;Jonathan GT Bailey is a valid name: True<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;Shawn O'Brien is a valid name: True<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;Steve Holt! is a valid name: False<br />   123 Main St. is a valid street address: True<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;45-50 South Lake Road is a valid street address: True<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;45-50 South Lake Road #8 is a valid street address: True<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;45-50!!! South Lake Road is a valid street address: False<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;Chicago is a valid name: True<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;Los Angeles is a valid city name: True<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;Jones-Parker Corner is a valid city name: True<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;(*&amp;(*&amp;ville is a valid name: False<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;Massachusetts is a valid state: True<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;Foobar is a valid state: False<br />&amp;nbsp;&amp;nbsp; 90034 is a valid zip code: False<br />&amp;nbsp;&amp;nbsp; 90034-1234 is a valid zip code: True<br />&amp;nbsp;&amp;nbsp; 900345 is a valid zip code: False<br />   1-617-555-1212 is a valid US phone number: True<br />&amp;nbsp;&amp;nbsp; (617) 555-1212 is a valid US phone number: True<br />&amp;nbsp;&amp;nbsp; 617.555.1212 is a valid US phone number: True<br />&amp;nbsp;&amp;nbsp; 6175551212 is a valid US phone number: True<br />&amp;nbsp;&amp;nbsp; 617/555/1212 is a valid US phone number: False<br />&amp;nbsp;&amp;nbsp; 4444-1234-5678-9900 is a valid credit card number: True<br />&amp;nbsp;&amp;nbsp; 3718 123456 78900 is a valid credit card number: True<br />   1234567890 is a valid credit card number: False<br />   123-45-6789 is a valid Social Security Number: True<br />&amp;nbsp;&amp;nbsp; 987654321 is a valid Social Security Number: True<br />   123-456 is a valid Social Security Number: False<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;pentest@msn.com is a valid email address: True<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;Jonathan_Bailey-01@mail.msn.com is a valid email address: True<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;Jonathan_Bailey@msn is a valid email address: False<br />&amp;nbsp;&amp;nbsp; http://www.microsoft.com is a valid URL: True<br />&amp;nbsp;&amp;nbsp; https://secure.microsoft.com:443/Default.aspx is a valid URL: True<br />&amp;nbsp;&amp;nbsp; ftp://ftp.microsoft.com/download.html#tools is a valid URL: True<br />&amp;nbsp;&amp;nbsp; http://100?arg=val is a valid URL: True<br />&amp;nbsp;&amp;nbsp; http://= is a valid URL: False<br />   192.168.0.1 is a valid IP Address: True<br />&amp;nbsp;&amp;nbsp; 0.0.0.0 is a valid IP Address: True<br />&amp;nbsp;&amp;nbsp; 300.300.300.300 is a valid IP Address: False</pre>
  <h1>More Information</h1>
  <ul>
    <li>As previously stated, this example makes use of "whitelist" validation practices, in which user data is evaluated against a set of known valid characters. "blacklist" validation, which evaluates input against a set of known malicious characters or strings, is also a common validation practice. We recommend the use of whitelist validation because new attacks are continually created and may make use of character combinations not publicly known at present. </li>
    <li>In addition to input validation, we recommend the use of data output validation to add additional protection against malicious input attacks that execute during presentation.</li>
  </ul>
  <hr />
  <p>Adapted from Microsoft patterns &amp; practices guidance.</p>