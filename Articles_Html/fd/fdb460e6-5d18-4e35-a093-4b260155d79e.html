<h2>Applies To</h2><ul><li> HTML5</li>
</ul><h2>What to Do</h2><p>When performing sensitive operations, include unique tokens in HTTP requests to prevent cross-site request forgery (CSRF).
</p><h2>Why</h2><p>CSRF may occur when an attacker can form a URL which performs an action on behalf of an authenticated user. Forming such URLs becomes much more difficult if unique tokens are included in HTTP requests. Including difficult-to-predict tokens in HTTP requests is an effective defense against CSRF attacks.
</p><h2>How</h2><p>To include unique tokens in HTTP requests:
</p><ol>
<li> <strong>Identify sensitive operations.</strong> Review application design and code to identify all operations that require authorization.</li>
<li> <strong>Identify code that performs sensitive operations.</strong> Identify all pages that are involved in performing sensitive operations. This includes both the pages that link to sensitive operations and the code that actually carries out the sensitive operations.</li>
<li> <strong>Choose a method for generating unique tokens.</strong> There are different ways to generate unique tokens. One approach is to use the uniqid function combined with a hash based on current time.</li>
<li> <strong>Add the unique token to the session.</strong> On each page that links to sensitive operations, add code that generates unique tokens and stores them in session variables.</li>
<li> <strong>Add unique tokens to HTTP requests.</strong> On each page that links to sensitive operations, add code that sends the generated unique tokens in HTTP requests. One of the simplest ways to do this is to include the tokens in hidden fields in forms.</li>
<li> <strong>Add token validation code.</strong> On each page that carries out sensitive operations, add code that compares the tokens sent in HTTP requests to the tokens stored in session variables. This ensures that the tokens are generated by the server as a part of normal application workflow and therefore the requested action is being performed by a legitimate user.</li>
</ol><h2>Essential Server-side Security Guidelines</h2><ul><li> <a href="e2c5d605-2b34-4e1c-80aa-211a0ad7b64f">Validate All Input</a></li>
<li> <a href="397488da-ce91-4768-9ad9-1e6928980d72">Use Prepared Statements for SQL Queries</a></li>
<li> <a href="496b6306-dca6-48b6-920e-67e768dbe334">Encode Input Included in Output</a></li>
<li> <a href="45d61f0a-c4d3-44f0-93b1-d8205cd13fbe">Force Reauthentication when Executing Critical Functionality</a></li>
<li> <a href="fdb460e6-5d18-4e35-a093-4b260155d79e">Include Unique Tokens in HTTP Requests</a></li>
<li> <a href="00000000-0000-0000-0000-0000007ecacc">Use Role-based Authorization</a></li>
<li> <a href="1445abaf-4bb9-474c-b7e4-7bf58fe80f39">URL-Encode Data in HTTP Response Headers</a></li>
</ul><h2>Essential Server-side Security Checklist Items</h2><ul><li> <a href="8dfa8088-a6cb-4062-8a44-0df8f2bc1cc4">All Input Is Validated</a></li>
<li> <a href="b5fb44c5-1702-42cf-b6be-894c511af7ac">Prepared Statements Are Used for SQL Queries</a></li>
<li> <a href="0ee9bc9f-c363-4a2d-be89-f84c069bda65">Input Included in Output Is Encoded</a></li>
<li> <a href="1c2b0859-c898-4f1c-b826-21392a7fc773">Reauthentication Is Enforced When Executing Critical Functionality</a></li>
<li> <a href="a2ef2a76-e562-4dd0-af9e-a6eb2b76c0d3">Unique Tokens Are Included in HTTP Requests</a></li>
<li> <a href="00000000-0000-0000-0000-0000008495ec">Role-based Authorization Is Used</a></li>
<li> <a href="3eb26600-9126-493a-a3cf-9d4b9815efc9">Data in HTTP Response Headers Is URL-Encoded</a></li>
</ul>