<h1>What to Do</h1>
  <p>Force users to renew their passwords after a given period of time.</p>
  <h1>Why</h1>
  <p>Forcing users to renew their passwords reduces the risk of valid credentials becoming exposed. While this technique can prevent attackers from obtaining the valid credentials through the use of a <a href="/article/d72d0706-99df-4a65-a19d-6a83ec868a7b">Credentials Brute Force Attack</a> or a <a href="/article/e8b05112-2416-436a-9679-07d9e5626bca">Credentials Dictionary Attack</a>, it can also reduce the business risk associated with any instances of “discovered” or “leaked” valid credentials.</p>
  <h1>When</h1>
  <p>Your application should always force its users to change their passwords.</p>
  <h1>How</h1>
  <p>Use the following steps to force users to change their passwords:</p>
  <ol>
    <li>
      <p>
        <strong>Define a password change policy. </strong>Establish a maximum password age for your application's users. Determining the maximum password age depends on the level of security required for your application as well as the likelihood of attack. Recognize that there is a tradeoff to be considered when defining any password policy; if the policy is too strict, then users tend to just write passwords down which can hurt the overall security of the application. A good baseline for password renewal is every 90 days.</p>
      <p>You may also consider defining different frequencies for various user groups within your application. For instance, it might make sense to require more frequent changes for the system administrator passwords as this class of users typically has more privileges and is therefore a bigger target for attack.</p>
    </li>
    <li>
      <p>
        <strong>Design a password change mechanism.</strong> Track the password age and prompt the user to change their password when the password is expiring. If your application uses ASP.NET membership providers, use MembershipUser.LastPasswordChangedDate property to track the last update of the user's password. Example:</p>
      <pre>MembershipUser user = membershipProvider.GetUser(username, true);<br />TimeSpan diff = DateTime.Now - user.LastPasswordChangedDate;</pre>
    </li>
    <li>
      <p>
        <strong>Enforce the password change policy.</strong> Embed the change of password mechanism into the authentication routine. If your application uses ASP.NET membership providers, use the ASP.NET RoleManager to identify the appropriate password change interval and prompt the user to change their password if necessary. It is recommended to place such functionality immediately after the authentication procedure. Example:</p>
      <pre>bool changePass = false;<br />string username = HttpContext.Current.User.Identity.Name;<br />MembershipProvider membershipProvider = Membership.Provider;<br />MembershipUser user = membershipProvider.GetUser(username, true); <br />TimeSpan diff = DateTime.Now - user.LastPasswordChangedDate;<br />if (Roles.IsUserInRole("Admin") &amp;&amp; diff.Days &gt;= 30)<br />{    <br />  changePass = true;<br />} <br />if (Roles.IsUserInRole("Users") &amp;&amp; diff.Days &gt;= 90)<br />{    <br />  changePass = true;<br />} <br />if (changePass)<br />{    <br />  HttpContext.Current.Response.Redirect("ChangePass.aspx", true);<br />}</pre>
    </li>
  </ol>
  <h1>Problem Example</h1>
  <p>The following code is part of the application's authentication routine. Because the application fails to force the user to renew their password, it allows more time for an attacker to guess the user's password.</p>
  <blockquote>
    <pre>&lt;!-- The application's login control --&gt;<br />&lt;asp:Login ID="Login1" runat="server" DestinationPageUrl="~/Protected.aspx" /&gt;<br /> // The Page_Load method of Protected.aspxprotected <br />void Page_Load(object sender, EventArgs e){}</pre>
  </blockquote>
  <h1>Solution Example</h1>
  <p>The following code is part of the application's authentication routine. Because the application forces its users to renew their passwords, there is limited time for an attacker to guess the user's password.</p>
  <blockquote>
    <pre>&lt;!-- The application's login control --&gt;<br />&lt;asp:Login ID="Login1" runat="server" DestinationPageUrl="~/Protected.aspx" /&gt; <br />// The Page_Load method of Protected.aspxprotected <br />void Page_Load(object sender, EventArgs e)<br />{    <br />  CheckPasswordMaturity();<br />} </pre>
    <pre>void CheckPasswordMaturity()<br />{    <br />  bool changePass = false;    <br />  string username = HttpContext.Current.User.Identity.Name;    <br />  MembershipProvider membershipProvider = Membership.Provider;    <br />  MembershipUser user = membershipProvider.GetUser(username, true);     <br />  TimeSpan diff = DateTime.Now - user.LastPasswordChangedDate;    <br />  if (Roles.IsUserInRole("Admin") &amp;&amp; diff.Days &gt;= 30)    <br />  {        <br />    changePass = true;    <br />  }     <br />  if (Roles.IsUserInRole("Users") &amp;&amp; diff.Days &gt;= 90)    <br />  {        <br />    changePass = true;    <br />  }     <br />  if (changePass)    <br />  {        <br />    HttpContext.Current.Response.Redirect("ChangePass.aspx", true);    <br />  }<br />}</pre>
  </blockquote>
  <hr />
  <p>Adapted from Microsoft patterns &amp; practices guidance. </p>