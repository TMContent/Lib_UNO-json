<h1>Applies to</h1>
  <ul>
    <li>C#</li>
  </ul>
  <h1>Summary</h1>
  <p>The purpose of this code snippet is to illustrate how the recipient of an XML file containing containing an RSA public key can read the file and encrypt a message for the sender using this key.</p>
  <h1>Objectives</h1>
  <ul>
    <li>Securely generate a message from an RSA key that only the owner of the key can decrypt and read. </li>
  </ul>
  <h1>Scenarios</h1>
  <ul>
    <li>Distributed client-server architecture where clients need to send confidential encrypted messages to the server but don't need to ever read those messages <li>Application does not want to maintain a dedicated key store for encryption purposes</li></li>
  </ul>
  <h1>Solution Example</h1>
  <pre>public static byte&#91;&#93; ReadRSAPublicKeyAndEncryptMessage(string xmlKeyData, string fileName)&#123;<br />     // Create a new RSA CSP in which to load the public key data from file<br />     RSACryptoServiceProvider yourRSA = new RSACryptoServiceProvider();<br />     yourRSA.FromXmlString(xmlKeyData);<br />     // Encrypt a message and return<br />     byte&#91;&#93; original = Encoding.ASCII.GetBytes("The quick brown fox jumped over the lazy dog");<br />     return(yourRSA.Encrypt(original, false));<br />&#125;</pre>
  <h1>Problem Example</h1>
  <p>In this example, the problem example assumes that the user simply does not use any means of encryption to transmit messages to the owner of the public key. </p>
  <ul>
    <li>Wherever an attacker can gain access to the data stream between the sender and the recipient of a message, the confidentiality of that message data could be compromised in transit. <li>Unsecured wireless networks, management consoles for networking devices, ARP-spoof and poisoning attacks are all examples of mechanisms that a malcious inidividual might used to compromise clear text traffic. </li></li>
  </ul>
  <h1>Test Case</h1>
  <p>The following classes must be included in any project making use of the sample code provided above:</p>
  <pre>using System.IO;<br />using System.Security;<br />using System.Security.AccessControl;<br />using System.Security.Cryptography;<br />using System.Text;<br />using Microsoft.Win32;</pre>
  <p>Execute the following code to see a plaintext message and then an encrypted version of that message created using the public key.</p>
  <pre>static void Main(string&#91;&#93; args)&#123;<br />        // Read public key into a string<br />        string publicKeyXml = "&lt;RSAKeyValue&gt;" &#43;<br />    "&lt;Modulus&gt;tnLAgAJwXXxYj&#43;2QPX6q/mHZZf23xSvvovoBlZ1Y7RbTlkY4N2nlcGxfR<br />6mQcTTWKfWShQ7yEaX6rVfhhRhdaHLCsg7g3AmW2BsoBxWUijD81ZeNKyWrw8t0gjnigNR4<br /><br /><br />6&#43;PqO1Xi7R9aA&#43;PgaluhuZBBgJK2wIAlRJSPlTr5OjDr4vJlZiAG/VqmJVXioPfv1QI2hfL<br />M86JgIcrD47L0K44tKwyhAj4PN1nsomjPeb0P9m9t3od/c&#43;yZGKk&#43;iJ1nwQwG02H/EXROaO<br />6YFKb3xijNv69gv&#43;ZLGc&#43;qssXs7Bs7CdzqmQvSylxuXkYz5bQG&#43;&#43;raYWm4l056WhtIRG8mqQ==&lt;/Modulus&gt;" &#43;<br />    "&lt;Exponent&gt;AQAB&lt;/Exponent&gt;" &#43;    "&lt;/RSAKeyValue&gt;";<br />        // Encrypt a message using our key and write out the results<br />        string msg = "The quick brown fox jumped over the lazy dog";<br />        byte&#91;&#93; encrypted = ReadRSAPublicKeyAndEncryptMessage(publicKeyXml, msg);<br />        Console.WriteLine("Original:");<br />        Console.WriteLine(msg);<br />        Console.WriteLine("\nEncrypted:");<br />        Console.WriteLine(Convert.ToBase64String(encrypted));<br />&#125;</pre>
  <h1>Expected Result</h1>
  <p>Original:</p>
  <pre>        The quick brown fox jumped over the lazy dog</pre>
  <p>Encrypted:</p>
  <pre>EPiXscCwYg7R/o35sNWqEKsJrdKNx7I6x3RA59IMelpFP8HOhD5qi2XLvuMPpran&#43;&#43;4SmRvE69RRLwF1<br />9NbIWv2KUx9FUFa3qWfkAKD1jk/PtgnOWBLM8po3eibs1VkwWxMbcEJrGKEp5eFBle7v66jzmAsxJDlA<br />MNoFfj/U/4CgzalMB09/ZnpBcoCq07NipwHYQxKfanyUfMDUyvfN69sYtdOKodMon6VwA2GRkCv4rN4V<br />rHO&#43;dloWL0hJlxgTVp19/X5oMigr3ZhqFURCETGppCS4KZ3uqwpO3LC5smSwLzNBZtdnjUm57OqWaeLo<br />D2GHhhvBdKvAcmYAABFYJw==</pre>
  <h1>More Information</h1>
  <p>RSA is an algorithm for public key (also knows as asymmetric) cryptography in which distinct public and private keys are created. Encryption operations makes use of the public key while decryption requires the private key. This offers an advantage over symmetric cryptography because the secret key used to decrypt a message does not need to be shared in order to support encryption of messages to a recipient. </p>
  <p>The RSA private key must be securely stored in order to maintain the confidentiality of data encrypted using an individual's public RSA key. However, the public key can be freely distributed by the owner of the key pair to anyone who wishes to send an encrypted message to that owner. </p>
  <h1>Additional Resources</h1>
  <ul>
    <li>RSACryptoServiceProvider (.NET): <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cpref/html/frlrfsystemsecuritycryptographyrsacryptoserviceproviderclassctortopic.asp">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cpref/html/frlrfsystemsecuritycryptographyrsacryptoserviceproviderclassctortopic.asp</a></li>
  </ul>
  <hr />
  <p>Adapted from Microsoft patterns & practices guidance.</p>