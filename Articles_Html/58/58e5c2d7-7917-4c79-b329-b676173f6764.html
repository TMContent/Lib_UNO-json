<h1>Applies to</h1>
  <ul>
    <li>Java web-based applications.</li>
  </ul>
  <h1>Summary</h1>
  <span>
    <p>Use the ESAPI library to override the <em>HttpServletResponse.sendRedirect() </em>method.</p>
  </span>
  <h1>Objectives</h1>
  <span>
    <p>The ESAPI library provides a replacement method for the <em>HttpServletResponse.sendRedirect()</em> method that validates the redirect location to ensure it is a relative url within the application. This prevents unvalidated redirects, which can lead users to dangerous sites that may install malware or perform other harmful activities.</p>
  </span>
  <h1>Scenarios</h1>
  <span>
    <p>Applications that perform redirects are very common. It is also common to use dynamic data to construct a portion of the redirect. When this occurs, validation is necessary in order to prevent an attacker from using the dynamic portion of the redirect to lead a user to a dangerous external site. The following shows 2 examples. The first example uses the standard <em>sendRedirect()</em> method which allows an attacker to manipulate the redirect location possibly taking a user to a dangerous external site. The second example resolves this issue by using the <em>HTTPUtilities.sendRedirect()</em> method which performs a validation on the incoming location, and throws an <em>AccessControlException</em> if the location is not pointing to an expected internal resource.</p>
  </span>
  <h1>Solution Example</h1>
  <span>
    <p>An example of an insecure redirect is shown below:</p>
    <pre>
      <p>HttpServletRequest request = ...;</p>
      <p>HttpServletResponse response = ...;</p>
      <p>String location = request.getParameter("loc") &#43; "/other/url";</p>
      <p>response.sendRedirect(location);</p>
    </pre>
    <p>A more secure example using ESAPI is shown below:</p>
    <pre>
      <p>HttpServletRequest request = ...;</p>
      <p>HttpServletResponse response = ...;</p>
      <p>String location = request.getParameter("loc") &#43; "/other/url";</p>
      <p>try &#123;</p>
      <p>&#9;ESAPI.httpUtilities().sendRedirect(response,location);</p>
      <p>&#125; catch (AccessControlException ace) &#123;</p>
      <p>&#9;//a bad location was attempted ... handle exception here</p>
      <p>&#125;</p>
    </pre>
    <p>(Note that additional protections should be added, such as whitelist validation, but the example above is for simplicity.)</p>
    <p>In addition to using this function, you'll need to update the <em>ESAPI.properties</em> file for your application to inform ESAPI what your application name is so it knows the expected relative path. An example of the snippet you need to update is below:</p>
    <pre>Validator.Redirect=&#94;\\/myapp.&#42;&#36;</pre>
  </span>
  <h1>See Also</h1>
  <span>
    <ul>
      <li>For more information about unvalidated redirects and forwards, please see <a href="https://www.owasp.org/index.php/Top_10_2010-A10">https://www.owasp.org/index.php/Top_10_2010-A10</a><li>For more information about ESAPI, please see <a href="https://www.owasp.org/index.php/Category:OWASP_Enterprise_Security_API">https://www.owasp.org/index.php/Category:OWASP_Enterprise_Security_API</a></li></li>
    </ul>
  </span>
  <h1>Redirects and Forwards Guidelines</h1>
  <ul>
    <li>
      <a href="/article/0ed7310a-a0fd-4074-9c0f-37f48cf2bf4f">Don't Use Redirects or Forwards if Possible</a>
      <li>
        <a href="/article/be525e05-0785-4b0c-8266-1ab4a0be08ea">Calculate Destinations of Redirects and Forwards Without User Input</a>
        <li>
          <a href="/article/8a8fe651-2168-4c88-b89a-0b6b442da2f8">Use Mapping Values When Redirecting on User Input</a>
          <li>
            <a href="/article/e7a1c675-9cae-4c12-85f3-4eb4269c197d">Validate Destinations of Redirects and Forwards</a>
          </li>
        </li>
      </li>
    </li>
  </ul>
  <h1>Redirects and Forwards Checklists</h1>
  <ul>
    <li>
      <a href="/article/11e960d3-09c4-4b40-9e20-a17fbe3116e7">Redirects and Forwards Are Not Used Unless Necessary</a>
      <li>
        <a href="/article/b77c82d9-0a87-4f01-9943-f3a9fc52b561">Destinations of Redirects and Forwards Are Calculated Without User Input</a>
        <li>
          <a href="/article/7bef867d-4dcb-47ea-ac58-651b9552cc1c">Mapping Values Are Used for Redirects and Forwards</a>
          <li>
            <a href="/article/346a9c98-e2ce-4551-85b4-ba8f4acdd9dc">Destinations of Redirects and Forwards Are Validated</a>
          </li>
        </li>
      </li>
    </li>
  </ul>
  <h1>Redirects and Forwards Code Example</h1>
  <ul>
    <li>
      <a href="/article/58e5c2d7-7917-4c79-b329-b676173f6764">Use ESAPI to Override the sendRedirect() Method</a>
    </li>
  </ul>