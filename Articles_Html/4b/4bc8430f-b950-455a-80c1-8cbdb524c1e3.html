<h1>What to Check For</h1>
  <p>Ensure all policy and configuration files associated with Java Authentication and Authorization Services (JAAS) are protected. </p>
  <h1>Why</h1>
  <p>JAAS configuration and policy files are an essential part of Java's security model. If they are not protected, then an attacker can modify the files and reconfigure the application's access controls.</p>
  <h1>How to Check</h1>
  <p>Follow these steps to ensure the JAAS policy and configuration files are protected:</p>
  <ol>
    <li>
      <p>
        <strong>Identify JAAS related files that are used by your application. </strong>Check the following locations to identify your application's JAAS configuration and policy files:</p>
      <ul>
        <li>
          <p>
            <strong>flags</strong>: All JAAS related files are loaded through the <em>-Djava.security.auth.login.config</em> and <em>-Djava.security.auth.policy</em> flags.</p>
        </li>
        <li>
          <p>
            <strong>JRE configuration</strong>: Identify the appropriate JRE installation that your application uses. Locate the JAAS related entries inside the JRE's master security properties, located at <em>{java.home}/lib/security/java.security</em>.</p>
          <ul>
            <li>
              <p>
                <strong>JAAS configuration</strong>: JAAS configuration is specified by a <em>login.config.url.n</em> entry. Example:</p>
              <pre>login.config.url.2=file:/usr/myapp/.java.login.config</pre>
            </li>
            <li>
              <p>
                <strong>JAAS policy</strong>: JAAS policies are specified by <em>policy.url.n</em> entries. Example:</p>
              <pre>policy.url.2=file:/usr/myapp/.java.policy</pre>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li>
      <p>
        <strong>Check the file permissions of the JAAS policy and configuration files. </strong>Verify that the JAAS policy and configuration files are set with the appropriate filesystem permissions. Verify that they are stored in a directory that is not web accessible. Verify that all entities, excluding your application and its administrators/developers, must be prohibited access to these files.</p>
    </li>
  </ol>
  <h1>How to Fix</h1>
  <p>To protect the policy and configuration files associated with JAAS:</p>
  <ol>
    <li>
      <p>
        <strong>Identify the files associated with JAAS. </strong>The two types of files you are concerned with here are the JAAS configuration file and the JAAS policy file.</p>
      <ul>
        <li>
          <p>
            <strong>JAAS configuration</strong>: The JAAS configuration assists the Java Virtual Machine (JVM) in using the appropriate LoginModule to handle authentication. It is loaded through the <strong>-Djava.security.auth.login.config</strong> flag when loading the JVM instance that hosts the application.</p>
          <pre>/** Login config for JAAS **/AppLoginConfig<br />{<br />      application.auth.LoginMod required;<br />};</pre>
        </li>
        <li>
          <p>
            <strong>JAAS policy</strong>: The JAAS policy stores the rights associated with the different types of users. It is loaded into the Java Virtual Machine (JVM) by using the <strong>-Djava.security.auth.policy</strong> flag when loading the JVM instance that hosts the application.</p>
          <pre>grant Principal application.auth.UserToken "joe" <br />{</pre>
          <pre>      permission java.security.SecurityPermission "AccessApp";<br />};</pre>
        </li>
      </ul>
    </li>
    <li>
      <p>
        <strong>Choose a configuration directory. </strong>Dedicate a directory for storing your application's configuration files. Make sure the directory is not web-accessible.</p>
    </li>
    <li>
      <p>
        <strong>Set appropriate file permissions. </strong>Apply filesystem permissions such that the configuration files can only&nbsp;be accessed by your application and its administrators.</p>
    </li>
  </ol>
  <h1>Problem Example</h1>
  <p>The following segment shows the directory where the JAAS associated files are located. Unfortunately, the file permissions are not set properly; therefore, it is possible for an attacker to overwrite the existing JAAS policy and configuration. The new policy and configuration will take effect once the application is restarted.</p>
  <pre>myapp@server jaas$ ls -la<br />drwxrwxrwx   2 myapp users    80 2013-10-06 15:20 .<br />drwxr-xr-x  63 myapp users  4808 2013-10-06 15:20 ..<br />-rw-rw-rw-   1 myapp users 16384 2013-10-06 15:20 jaas.config<br />-rw-rw-rw-   1 myapp users 16384 2013-10-06 15:20 jaas.policy</pre>
  <h1>Solution Example</h1>
  <p>The following segment shows the directory where the JAAS associated files are located. Because the file permissions are set properly, it is impossible for an attacker to overwrite the existing JAAS policy and configuration.</p>
  <pre>myapp@server jaas$ ls -la<br />drwx------   2 myapp users    80 2013-10-06 15:20 .<br />drwxr-xr-x  63 myapp users  4808 2013-10-06 15:20 ..<br />-r--------   1 myapp users 16384 2013-10-06 15:20 jaas.config<br />-r--------   1 myapp users 16384 2013-10-06 15:20 jaas.policy</pre>
  <h1>Java Deployment Guidelines</h1>
  <ul>
    <li>
      <a href="/article/f21f5350-826d-44dd-b758-fd824d52f592">Remove Test Accounts</a>
    </li>
    <li>
      <a href="/article/df860f3d-2185-4939-be4b-ef26d8891855">Remove Test Interfaces</a>
    </li>
    <li>
      <a href="/article/fd675679-e8ad-40fc-bac4-d56fc440bc00">Disable Directory Browsing</a>
    </li>
    <li>
      <a href="/article/aebb10ce-aeb6-45e5-b159-e2bc76b012bf">Use a Least-Privileged Account for Running Applications</a>
    </li>
    <li>
      <a href="/article/47e80747-3e12-4dd1-a522-ea5c33154a86">Protect the JAAS Policy and Configuration Files</a>
    </li>
    <li>
      <a href="/article/3f301ff9-098d-46cb-ac53-cb3fa6897cdf">Protect Sensitive Data Inside Configuration Files</a>
    </li>
  </ul>
  <h1>Java Deployment Checklists</h1>
  <ul>
    <li>
      <a href="/article/256b4884-9ff0-4a33-960c-305b824bab68">Test Accounts Are Removed</a>
    </li>
    <li>
      <a href="/article/fe7941bc-b986-48f9-9fa3-422c34db36bd">Test Interfaces Are Removed</a>
    </li>
    <li>
      <a href="/article/65e70f79-645d-415c-9e71-9cff045cc1c4">Directory Browsing Is Disabled</a>
    </li>
    <li>
      <a href="/article/a2000bc9-7e22-4d0c-91b8-a9ec623985d3">A Least Privileged Account Is Used for Running Applications</a>
    </li>
    <li>
      <a href="/article/4bc8430f-b950-455a-80c1-8cbdb524c1e3">JAAS Policy and Configuration Files Are Protected</a>
    </li>
    <li>
      <a href="/article/f9c1e6b0-1bc4-4108-9c9a-55dca84749ac">Sensitive Data Inside Configuration Files Is Protected</a>
    </li>
  </ul>