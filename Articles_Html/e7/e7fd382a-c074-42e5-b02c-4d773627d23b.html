<h2>Applies To</h2>
<ul>
<li>C and C++</li>
</ul>
<h2>What to Do</h2>
<p>Don't use user input in format strings. Use C++ stream functions to avoid using formatted input-output functions, if possible. (Re-)Write code to guarantee that user input is never used in format strings.</p>
<h2>Why</h2>
<p>An attacker that can control the contents of a format string may be able to execute arbitrary code.</p>
<h2>When</h2>
<p>Avoid using user input in format strings when using formatted input-output functions.</p>
<h2>How</h2>
<p>Perform the following actions to assure that user input is not used in format strings:</p>
<ol>
<li>
<p><strong>Identify code that uses formatted input-output functions.</strong> The following is a list of formatted input-output functions:</p>
<pre><code> sprintf
 _snprintf
 printf
 fprintf
 scanf 
 fscanf
 sscanf
 swprintf
 wsprintfA
 wsprintfW
 vsprintf
 vswprintf
 _snwprintf
 _vsnprintf
 _vsnwprintf
 vprintf
 vwprintf
 vfprintf
 vwfprintf
 fwscanf
 wscanf
 swscanf
</code></pre>
</li>
<li>
<p><strong>Avoid using formatted functions.</strong> Consider replacing formatted input-output functions with iostream C++ functions, which are not prone to format string vulnerabilities.</p>
</li>
<li>
<p><strong>(Re-)Write code to exclude user input from format strings.</strong> Use static format strings with formatted I/O functions or avoid using formatted I/O functions altogether.</p>
</li>
</ol>
<h2>Problem Example</h2>
<p>A classic format string vulnerability example:</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

int main(int argc, char* argv[]) {
if (argc != 2) return 0;

printf(argv[1]);
return 1;
}
</code></pre>
<p>Compilers can often detect such vulnerabilities and produce warnings like this:</p>
<p>format_string_vuln.c:7:1: warning: format not a string literal and no format arguments [-Wformat-security]</p>
<h2>Solution Example</h2>
<p>Make sure that user input is not processed as a format string by specifying a static format string and then passing user input as data to it:</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

int main(int argc, char* argv[]) {
if (argc != 2) return 0;

printf(&quot;%s&quot;, argv[1]);
return 1;
}
</code></pre>
<h2>Additional Resources</h2>
<p>For more information about excluding user input from format strings, see <a href="https://www.securecoding.cert.org/confluence/display/c/FIO30-C.+Exclude+user+input+from+format+strings">https://www.securecoding.cert.org/confluence/display/c/FIO30-C.+Exclude+user+input+from+format+strings</a></p>
