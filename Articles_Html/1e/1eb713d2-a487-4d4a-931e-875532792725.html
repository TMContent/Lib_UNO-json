<h1>Summary</h1>
  <p>This How to shows you how to use the ASP.NET membership feature with multiple Active Directory domains. It shows you how to configure an <b>ActiveDirectoryMembershipProvider</b> for each domain and the corresponding connection strings. It also shows how to get an instance of <b>MembershipProvider</b> corresponding to a specific domain and how to call membership APIs, such as <b>ValidateUser</b>, through the relevant provider.</p>
  <h1>Contents</h1>
  <ul>
    <li>
      <div>Objectives</div>
      <li>
        <div>Overview</div>
        <li>
          <div>Summary of Steps</div>
          <li>
            <div>Step 1. Create a Web Application with a Login Page</div>
            <li>
              <div>Step 2. Configure the Web Application for Forms Authentication</div>
              <li>
                <div>Step 3. Configure the Web Application to Use ActiveDirectoryMembershipProvider</div>
                <li>
                  <div>Step 4. Use Membership APIs for Authentication</div>
                  <li>
                    <div>Security Considerations</div>
                    <li>
                      <div>Additional Considerations</div>
                      <li>
                        <div>Additional Resources</div>
                      </li>
                    </li>
                  </li>
                </li>
              </li>
            </li>
          </li>
        </li>
      </li>
    </li>
  </ul>
  <h1>Objectives</h1>
  <ul>
    <li>Use the <b>ActiveDirectoryMembershipProvider</b> with forms authentication. <li>Learn how to configure the <b>ActiveDirectoryMembershipProvider</b> when using multiple domains. <li>Learn key production considerations when using membership and forms authentication. <li>Learn key security considerations when using membership and forms authentication. </li></li></li></li>
  </ul>
  <h1>Overview</h1>
  <p>The ASP.NET membership feature provides an abstraction for the underlying data store used to maintain user credentials, such as user names and passwords, and provides an API that enables you to validate user credentials and manage the user database. Supported membership providers include <b>SqlServerMembershipProvider</b> for SQL Server user store databases and <b>ActiveDirectoryMembershipProvider</b> for Active Directory and Active Directory Application Mode (ADAM) user stores.</p>
  <p>This How to shows you how to develop a simple Web site that uses forms authentication against Active Directory in a multiple domain scenario. It shows you how to configure the <b>ActiveDirectoryMembershipProvider </b>when using multiple domains and how to authenticate users against the relevant domain controller. </p>
  <h1>Summary of Steps</h1>
  <p>To develop a simple application that uses forms authentication with the Active Directory membership provider in a multiple domain scenario, perform the following steps: </p>
  <ul>
    <li>Step 1. Create a Web application with a login page. <li>Step 2. Configure the Web application for forms authentication. <li>Step 3. Configure the Web application to use ActiveDirectoryMembershipProvider. <li>Step 4. Use Membership APIs for Authentication. </li></li></li></li>
  </ul>
  <h1>Step 1. Create a Web Application with a Login page </h1>
  <p>When implementing forms authentication with membership in a multiple domain scenario, you cannot use the login controls provided in ASP.NET. Instead, you must directly call the membership APIs. You must create your own custom login page using the server controls like <b>TextBox</b> and <b>Button</b>. The login page enables the existing user to login and new users to register by creating new accounts.</p>
  <h3>To create a Web application with a login page </h3>
  <ol>
    <li>Start Microsoft Visual Studio .NET development system, and then create a new ASP.NET Web site named FormsAuthAD. <li>Use Solution Explorer to add a new Web form named Login.aspx to the site. <li>Add a <b>Label</b> and a <b>TextBox</b> server control to accept the user ID. <li>Add a <b>Label</b> and a <b>TextBox</b> server control to accept the password. Make sure that you set the <b>TextMode</b> property of the <b>TextBox</b> to <b>Password</b>. <li>Add a <b>Button</b> server control and set its <b>Text</b> property to <b>Login</b>. </li></li></li></li></li>
  </ol>
  <h1>Step 2. Configure the Web application for Forms Authentication</h1>
  <p>In this step, you configure your ASP.NET application to use forms authentication. </p>
  <h3>To configure the Web application for forms authentication </h3>
  <ol>
    <li>Use Solution Explorer to add a Web.config file to your project. <li>Locate the &lt;<b>authentication</b>&gt; element and change the mode attribute to <b>Forms</b>. <li>Add the following &lt;<b>forms</b>&gt; element as a child of the &lt;<b>authentication</b>&gt; element and set the name and timeout attributes as follows. <div><pre>&lt;authentication mode="Forms"&gt;<br />&amp;nbsp; &lt;forms<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; name=".ADAuthCookie"&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; timeout="10" /&gt;<br />&lt;/authentication&gt;  </pre></div><p>If you only set the <b>mode</b> attribute on the &lt;<b>authentication</b>&gt; element and omit setting the attribute on the &lt;<b>forms</b>&gt; element, default settings are used for the &lt;<b>forms</b>&gt; configuration. You should configure only those attributes that you want to overwrite. The default settings for forms authentication as defined in the Machine.config.comments file are shown here. </p><div><pre>&lt;forms name=".ASPXAUTH" loginUrl="login.aspx" <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; defaultUrl="default.aspx" protection="All" timeout="30" path="/" <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; requireSSL="false" slidingExpiration="true"<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; cookieless="UseDeviceProfile" domain="" <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; enableCrossAppRedirects="false"&gt;<br />&amp;nbsp; &lt;credentials passwordFormat="SHA1" /&gt;<br />&lt;/forms&gt;  </pre></div><li>Add the following &lt;<b>authorization</b>&gt; element beneath the &lt;<b>authentication</b>&gt; element in your Web.config file, which allows all authenticated users to access the Web page. <div><pre>&lt;authorization&gt; <br />&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;deny users="?" /&gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;allow users="&amp;#42;" /&gt;<br />&lt;/authorization&gt;  </pre></div><p>This configuration allows only authenticated users to access the application. The "<b>?</b>" indicates unauthenticated users and the "<b>&amp;#42;</b>" indicates all users. By denying unauthenticated users, any requests made by unauthenticated users are redirected to your login page. The <b>loginUrl</b> attribute on the &lt;<b>forms</b>&gt; element determines the name of the login page. The default setting of this attribute in Machine.config.comments is <b>Login.aspx</b>. </p></li></li></li></li>
  </ol>
  <h1>Step 3. Configure the Web Application to Use ActiveDirectoryMembershipProvider</h1>
  <p>Identify all the domains that your application supports in your Active Directory forest and then configure <b>ActiveDirectoryMembershipProvider</b> instances for each domain.</p>
  <h3>To configure ASP.NET Membership providers for multiple domains </h3>
  <ol>
    <li>In the Web.config file, add connection strings similar to those shown in the following example that point to your Active Directory user database for each domain. <div><pre>&lt;connectionStrings&gt;<br />&amp;nbsp; &lt;add name="TestDomain1ConnectionString" connectionString="<a href="ldap://testdomain1.test.com/CN=Users,DC=testdomain1,DC=test,DC=com">LDAP://testdomain1.test.com/CN=Users,DC=testdomain1,DC=test,DC=com</a>" /&gt;<br />&amp;nbsp; &lt;add name="TestDomain2ConnectionString" connectionString="<a href="ldap://testdomain2.test.com/CN=Users,DC=testdomain2,DC=test,DC=com">LDAP://testdomain2.test.com/CN=Users,DC=testdomain2,DC=test,DC=com</a>" /&gt;<br />&amp;nbsp; &lt;add name="TestDomain3ConnectionString" connectionString="<a href="ldap://testdomain3.test.com/CN=Users,DC=testdomain3,DC=test,DC=com">LDAP://testdomain3.test.com/CN=Users,DC=testdomain3,DC=test,DC=com</a>" /&gt;<br />&lt;/connectionStrings&gt;  </pre></div><li><blockquote><b>Note</b>&amp;nbsp;&amp;nbsp;&amp;nbsp;The connection strings shown here connect to the <b>Users</b> container within three test domains. Update these strings to point to the relevant <b>Users</b> container within your domains.<b></b></blockquote><li>In the Web.config file, configure the &lt;<b>membership</b>&gt; element with <b>ActiveDirectoryMembershipProvider</b> instances pointing to each domain as shown here. <div><pre>&lt;membership &gt;<br />&amp;nbsp; &lt;providers&gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;add<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; name="TestDomain1ADMembershipProvider"<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; type="System.Web.Security.ActiveDirectoryMembershipProvider, System.Web, Version=2.0.0.0, <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connectionStringName="TestDomain1ConnectionString"<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connectionUsername="testdomain1\administrator" <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connectionPassword="password"/&gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;add<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; name="TestDomain2ADMembershipProvider"<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; type="System.Web.Security.ActiveDirectoryMembershipProvider, System.Web, Version=2.0.0.0, <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connectionStringName="TestDomain2ConnectionString"&amp;nbsp; <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connectionUsername="testdomain2\administrator" <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connectionPassword="password"/&gt;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;add<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; name="TestDomain3ADMembershipProvider"<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; type="System.Web.Security.ActiveDirectoryMembershipProvider, System.Web, Version=2.0.0.0, <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connectionStringName="TestDomain3ConnectionString"<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connectionUsername="testdomain3\administrator" <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; connectionPassword="password"/&gt;<br />&amp;nbsp; &lt;/providers&gt;<br />&lt;/membership&gt;  </pre></div><p>Make sure you set the <b>connectionStringName</b> attribute to the correct connection string name specified earlier in your &lt;<b>connectionStrings</b>&gt; section. </p></li></li></li>
  </ol>
  <blockquote>
    <b>Note</b>&amp;nbsp;&amp;nbsp;&amp;nbsp;In the preceding example, it is assumed that you are working in a test domain and have the password of an administrator account capable of creating new accounts. The domain administrator name and password have to be supplied in plaintext. As a result, you should encrypt this configuration section along with the &lt;<b>connectionStrings</b>&gt; section. </blockquote>
  <h2>Connecting to Active Directory</h2>
  <p>When the <b>ActiveDirectoryMembership</b> provider connects to Active Directory, it uses the account whose credentials are specified on the <b>connectionUsername</b> property (note the lower-case <i>n</i>, which is different from the <b>connectionStringName</b> property). If you specify the <b>connectionUsername</b> property, you must also specify the <b>connectionPassword</b> property, otherwise an exception is thrown. </p>
  <p>If you do not specify account credentials, Active Directory uses your ASP.NET Web application's process account.</p>
  <blockquote>
    <b>Note</b>&amp;nbsp;&amp;nbsp;&amp;nbsp;The service account that you use to connect to Active Directory must have sufficient permissions in Active Directory. If you place your user accounts in an Active Directory organizational unit (OU), you can create and use a service account that has only read, write, and delete access on that OU (and, optionally, reset password privilege).<b></b></blockquote>
  <h1>Step 4. Use Membership APIs for Authentication</h1>
  <p>The format of the user name you use when validating users depends on the <b>attributeMapUsername</b> attribute of the &lt;<b>membership</b>&gt; element. The default configuration for the <b>ActiveDirectoryMembershipProvider</b> uses user principal names (UPNs) for name mapping as shown here.</p>
  <div>
    <pre>attributeMapUsername="userPrincipalName"  </pre>
  </div>
  <p>Because of this, all user names must have the format <i>UserName&amp;#64;DomainName</i>; for example, <i>mary&amp;#64;testdomain.com</i> or <i>steve&amp;#64;testdomain.com</i>.</p>
  <p>You can change the name mapping so that it uses simple user name format by setting the following attribute in the membership provider configuration in the Web.config file.</p>
  <div>
    <pre>attributeMapUsername="sAMAccountName"  </pre>
  </div>
  <p>With this configuration, you can use simple user names; for example, Mary or Steve.</p>
  <h3>To extract username and domain from a UPN</h3>
  <p>This procedure assumes you want to capture usernames of the format <i>username&amp;#64;domainname</i>. </p>
  <ol>
    <li>Add code to your login form to validate input and ensure that the user name is entered in the format <i>username&amp;#64;domainName</i>. For example, you could use a <b>RegularExpressionValidator</b> control like the one shown here. <div><pre>&lt;asp:RegularExpressionValidator id="unameRegex" runat="server" <br />&amp;nbsp;&amp;nbsp; ErrorMessage="Invalid user name. Format: <a href="mailto:username&amp;#64;domainName">username&amp;#64;domainName</a>" <br />&amp;nbsp;&amp;nbsp; ValidationExpression="&amp;#94;&amp;#91;\w-&amp;#93;&amp;#43;(&amp;#91;\. &amp;#93;&amp;#91;\w-&amp;#93;&amp;#43;)&amp;#42;&amp;#64;\w&amp;#43;(&amp;#91;-.&amp;#93;\w&amp;#43;)&amp;#42;\.\w&amp;#43;(&amp;#91;-.&amp;#93;\w&amp;#43;)&amp;#42;"<br />&amp;nbsp;&amp;nbsp; ControlToValidate="UserNameTextBox"&gt;<br />&lt;/asp:RegularExpressionValidator&gt;  </pre></div><li>Add code similar to the following to your login button click event handler. <div><pre>string&amp;#91;&amp;#93; partsOfUserName = UserNameTextBox.Text.Split("&amp;#64;".ToCharArray());string domainName = partsOfUserName&amp;#91;1&amp;#93;;  </pre></div></li></li>
  </ol>
  <h3>To extract username and domain from a simple user name</h3>
  <p>This procedure assumes you want to capture user names of the format <i>doma</i>i<i>nName\userName</i>. You only need a simple user name to perform authentication, but you must still know the correct domain for the user so that you can select the correct <b>ActiveDirectoryMembershipProvider</b> instance with which to validate. There are two ways you can do this: </p>
  <ul>
    <li>Add another <b>TextBox</b> with a suitable prompt <b>Label</b> to the login form where the user enters the domain <li>Require the user to enter his or her user name using the format <i>domainName\userName</i>. </li></li>
  </ul>
  <p>The next steps assume the second approach. </p>
  <ol>
    <li>Add code to your login form to validate input and ensure that the user name is entered in the format <i>domainName\userName</i>. For example, you can use a <b>RegularExpressionValidator</b> control like the one shown here. <div><pre>&lt;asp:RegularExpressionValidator id="unameRegex" runat="server" <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ErrorMessage="Invalid user name. Format: domainName\username" <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ValidationExpression="&amp;#94;\w&amp;#43;(&amp;#91;-.&amp;#93;\w&amp;#43;)&amp;#42;\\&amp;#91;\w-&amp;#93;&amp;#43;(&amp;#91;\. &amp;#93;&amp;#91;\w-&amp;#93;&amp;#43;)&amp;#42;"<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ControlToValidate="UserNameTextBox"&gt;<br />&amp;nbsp; &lt;/asp:RegularExpressionValidator&gt;  </pre></div><li>Add code similar to the following to your login button click event handler. <div><pre>string&amp;#91;&amp;#93; partsOfUserName = UserNameTextBox.Text.Split("<a href="file://\\&quot;.ToCharArray">\\".ToCharArray</a>());<br />string domainName = partsOfUserName&amp;#91;0&amp;#93;;<br />string userName = partsofUserName&amp;#91;1&amp;#93;;  </pre></div></li></li>
  </ol>
  <h3>To authenticate users </h3>
  <ol>
    <li>Add code to your login form to validate input and ensure that the user name is entered in the format <i>username&amp;#64;domainName</i>. For example, use a <b>RegularExpressionValidator</b> control. <li>After the code you just entered to extract the username and domain, add code similar to the following to your login button click event handler. <div><pre>MembershipProvider domainProvider;<br />switch (domainName)<br />&amp;#123;<br />&amp;nbsp; case "TestDomain1.test.com":<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; domainProvider = Membership.Providers&amp;#91;"TestDomain1ADMembershipProvider"&amp;#93;;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; break;<br />&amp;nbsp; case "TestDomain2.test.com":<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; domainProvider = Membership.Providers&amp;#91;"TestDomain2ADMembershipProvider"&amp;#93;;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; break;<br />&amp;nbsp; case "TestDomain3.test.com":<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; domainProvider = Membership.Providers&amp;#91;"TestDomain3ADMembershipProvider"&amp;#93;;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; break;<br />&amp;nbsp; default:<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; throw(new Exception("This domain is not supported"));<br />&amp;#125;</pre></div><li><div><pre>// Validate the user with the membership system.<br />if(domainProvider.ValidateUser(UserNameTextBox.Text, PasswordTextBox.Text))<br />&amp;#123;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; // If there is a RequestUrl query string attribute, the user has<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; // been redirected to the login page by forms authentication after<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; // requesting another page while not authenticated.<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; if (Request.QueryString&amp;#91;"ReturnUrl"&amp;#93; &amp;#33;= null)<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;#123;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // RedirectFromLoginPage sets the authorization cookie and then<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // redirects to the page the user originally requested.<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Set second parameter to false so cookie is not persistent<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // across sessions.<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; FormsAuthentication.RedirectFromLoginPage(<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; UserNameTextBox.Text, false);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;#125;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; else<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;#123;<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // If there is no RequestUrl query string attribute, just set<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // the authentication cookie. Provide navigation on the login page<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // to pages that require authentication, or user can use browser<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // to navigate to protected pages. <br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // Set second parameter to false so cookie is not persistent<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; // across sessions.<br />&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; FormsAuthentication.SetAuthCookie(UserNameTextBox.Text, false);<br />&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;#125;<br />&amp;#125;<br />else<br />&amp;#123;<br />&amp;nbsp; Response.Write("Invalid UserID and Password");<br />&amp;#125;  </pre></div></li></li></li>
  </ol>
  <h1>Security Considerations</h1>
  <p>Failing to protect authentication tickets is a common vulnerability that can lead to unauthorized spoofing and impersonation, session hijacking, and elevation of privilege. When you use forms authentication, consider the following recommendations to help ensure a secure authentication approach: </p>
  <ul>
    <li>
      <b>Restrict the authentication cookie to HTTPS connections.</b> To prevent forms authentication cookies from being captured and tampered with while crossing the network, ensure that you use Secure Sockets Layer (SSL) with all pages that require authenticated access and restrict forms authentication tickets to SSL channels. <li><b>Partition the site for SSL.</b> This allows you to avoid using SSL for the entire site.<b></b><li><b>Do not persist forms authentication cookies. </b>Do not persist authentication cookies because they are stored in the user's profile on the client computer and can be stolen if an attacker gets physical access to the user's computer <li><b>Consider reducing ticket lifetime. </b>Consider reducing the cookie lifetime to reduce the time window in which an attacker can use a captured cookie to gain access to your application with a spoofed identity. <li><b>Consider using a fixed expiration.</b> In scenarios where you cannot use SSL, consider setting <b>slidingExpiration="false"</b>. <li><b>Enforce strong user management policies.</b> Use and enforce strong passwords for all user accounts to ensure that people cannot guess one another's passwords and to mitigate the risk posed by dictionary attacks. <li><b>Enforce password complexity rules.</b> Validate passwords entered through the <b>CreateUserWizard</b> control, by setting its <b>PasswordRegularExpression</b> property to an appropriate regular expression. Also configure the membership provider on the server to use the same regular expression.<b></b><li><b>Perform effective data validation on all requests.</b> Perform strict data validation to minimize the possibilities of SQL injection and cross-site scripting. <li><b>Use distinct cookie names and paths.</b> By ensuring unique cookie names and paths, you prevent possible problems that can occur when hosting multiple applications on the same server. <li><b>Keep authentication and personalization cookies separate.</b> Keep personalization cookies that contain user-specific preferences and non-sensitive data separate from authentication cookies. <li><b>Use absolute URLs for navigation. </b>This is to avoid potential issues caused by redirecting from HTTP to HTTPS pages. </li></li></li></li></li></li></li></li></li></li></li>
  </ul>
  <h1>Additional Considerations</h1>
  <p>The <b>ActiveDirectoryMembershipProvider</b> supports many more attributes than those described in this How to. </p>
  <hr />
  <p>Adapted from Microsoft patterns &amp; practices guidance.</p>