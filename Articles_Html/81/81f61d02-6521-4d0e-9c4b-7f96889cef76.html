<h1>Applies to</h1>
  <ul>
    <li>C&#43;&#43;</li>
    <li>Windows</li>
  </ul>
  <h1>What to Do</h1>
  <p>Create files safely.</p>
  <h1>Why</h1>
  <p>Allowing user input in the lpFileName parameter of CreateFile() can lead to the creation or opening of unexpected objects.</p>
  <h1>When</h1>
  <p>Apply this guideline whenever creating files programmatically on Windows systems.</p>
  <h1>How</h1>
  <p>Perform the following actions to assure that files are created safely on Windows:</p>
  <ol>
    <li>
      <p>
        <strong>Review code.</strong> Search for all calls to the CreateFile() function.</p>
    </li>
    <li>
      <p>
        <strong>Validate file handles.</strong> Use GetFileType() to ensure that you are creating a file instead of some other unexpected object. By calling GetFileType on hfile (the return value of CreateFile()), you can ensure that only a file is created.</p>
    </li>
  </ol>
  <h1>Problem Example</h1>
  <p>In the code example below, the code is calling CreateFile and passing a command line argument (argv&#91;1&#93;) into the lpFileName parameter. A malicious attacker can exploit this code to force your application to open an unexpected object other than a file.</p>
  <pre>int main(int argc, char &#42;argv&#91;&#93;)<br />&#123;<br />&nbsp;&nbsp;&nbsp; HANDLE hFile = CreateFile(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; argv&#91;1&#93;,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GENERIC_READ &#124; GENERIC_WRITE,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NULL,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NULL,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CREATE_ALWAYS,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FILE_ATTRIBUTE_NORMAL,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NULL);<br />&#125;</pre>
  <h1>Solution Example</h1>
  <p>Use GetFileType() to ensure that you are creating a file instead of some other unexpected object.</p>
  <pre>int main(int argc, char &#42;argv&#91;&#93;)<br />&#123;<br />&nbsp;&nbsp;&nbsp; HANDLE hFile = CreateFile(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; argv&#91;1&#93;,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GENERIC_READ &#124; GENERIC_WRITE,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NULL,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NULL,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CREATE_ALWAYS,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FILE_ATTRIBUTE_NORMAL,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NULL);<br />&nbsp;&nbsp; if (GetFileType(hFile) &#33;= FILE_TYPE_DISK)<br />&nbsp;&nbsp; &#123;<br />&nbsp;&nbsp;// Error Handling<br />&nbsp;&nbsp;CloseHandle(hFile);<br />&nbsp;&nbsp; &#125;<br />&#125;</pre>