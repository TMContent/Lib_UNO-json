<h1>Applies to</h1>
  <ul>
    <li>Microsoft&#174; Windows Communication Foundation (WCF) 3.5 <li>Microsoft Visual Studio&#174; 2008</li></li>
  </ul>
  <h1>Description</h1>
  <p>Use the following steps to impersonate the original caller using S4U Kerberos extensions:</p>
  <ol>
    <li>Grant your WCF process account the <strong>Act as part of the operating system</strong> user right. If you are running using the network service account - by default it has this right. <li>Get the user name for the original caller and create a UPN for the user like the following format <strong>username&#64;FullyQualifiedDomainName.com</strong><li>Use the WindowsIdentity constructor and pass the UPN string as the parameter and get the <strong>WindowsIdentity</strong> token and impersonate the original caller.<ol><pre>   String username = &#8220;username&#64;FullyQualifiedDomainName.com&#8221;;<br />   WindowsIdentity winId = new WindowsIdentity(userName);<br />   using (winId.Impersonate())<br />   &#123;<br />       // access the local resources on behalf of the original callers       <br />   &#125;</pre></ol><li>Make sure to revert the impersonation, in the above example the using statement does it automatically for you.</li></li></li></li>
  </ol>
  <h1>Additional Resources</h1>
  <ul>
    <li>For more information, see &#8220;Delegation and Impersonation with WCF&#8221; at <a href="http://msdn2.microsoft.com/en-us/library/ms730088.aspx">http://msdn2.microsoft.com/en-us/library/ms730088.aspx</a><li>For more information, see &#8220;How to Use Protocol Transition for Impersonating and Delegating Original Caller in WCF&#8221;.</li></li>
  </ul>
  <hr />
  <p>Adapted from Microsoft patterns & practices guidance.</p>