{
  "id": "e7d2ddf8-f907-4c01-b901-99436f19c4c2",
  "checksum": "9ca2ada54dac85d61d0bb159588babd1cb272ebd",
  "words": {
    "what": [
      "h1"
    ],
    "to": [
      "h1",
      "p",
      "p",
      "h1",
      "p",
      "p",
      "p",
      "p",
      "p",
      "div",
      "title"
    ],
    "check": [
      "h1",
      "p"
    ],
    "for": [
      "h1"
    ],
    "ensure": [
      "p",
      "p",
      "div"
    ],
    "that": [
      "p",
      "p",
      "p",
      "div",
      "div"
    ],
    "code": [
      "p",
      "p",
      "p",
      "p",
      "p",
      "p",
      "p",
      "p",
      "p",
      "div",
      "title",
      "title"
    ],
    "in": [
      "p",
      "p",
      "p",
      "p",
      "p",
      "p",
      "p",
      "div",
      "title",
      "title"
    ],
    "your": [
      "p",
      "p",
      "p",
      "p",
      "p",
      "p",
      "p"
    ],
    "application": [
      "p"
    ],
    "is": [
      "p",
      "p",
      "p",
      "p",
      "div",
      "div",
      "title"
    ],
    "not": [
      "p",
      "p",
      "pre",
      "div",
      "title"
    ],
    "subject": [
      "p",
      "title"
    ],
    "exception": [
      "p",
      "p",
      "p",
      "p",
      "p",
      "pre",
      "div",
      "div",
      "div",
      "title"
    ],
    "filter": [
      "p",
      "p",
      "div",
      "title",
      "title"
    ],
    "issues": [
      "p",
      "title"
    ],
    "where": [
      "p",
      "title"
    ],
    "the": [
      "p",
      "p",
      "p",
      "p",
      "p",
      "p",
      "p",
      "p",
      "p",
      "pre",
      "div",
      "div",
      "div",
      "div",
      "div",
      "div",
      "title",
      "title"
    ],
    "higher": [
      "p",
      "p",
      "div",
      "title"
    ],
    "call": [
      "p",
      "p",
      "div",
      "title"
    ],
    "stack": [
      "p",
      "p",
      "div",
      "title"
    ],
    "executes": [
      "p",
      "title"
    ],
    "before": [
      "p",
      "p",
      "title"
    ],
    "a": [
      "p",
      "p",
      "p",
      "p",
      "p",
      "div",
      "title"
    ],
    "finally": [
      "p",
      "p",
      "p",
      "b",
      "b",
      "p",
      "b",
      "div",
      "b",
      "title"
    ],
    "block": [
      "p",
      "p",
      "p",
      "p",
      "p",
      "div",
      "div",
      "title"
    ],
    "how": [
      "h1"
    ],
    "fix": [
      "h1"
    ],
    "if": [
      "p",
      "p",
      "p",
      "p",
      "p",
      "div"
    ],
    "fails": [
      "p"
    ],
    "catch": [
      "p",
      "p",
      "p",
      "b",
      "pre",
      "div",
      "b"
    ],
    "exceptions": [
      "p",
      "p",
      "p"
    ],
    "and": [
      "p",
      "p",
      "p",
      "blockquote"
    ],
    "uses": [
      "p"
    ],
    "impersonation": [
      "p",
      "p",
      "p",
      "p",
      "p",
      "div",
      "div"
    ],
    "malicious": [
      "p"
    ],
    "user": [
      "p"
    ],
    "could": [
      "p"
    ],
    "use": [
      "p",
      "p",
      "p",
      "p",
      "p"
    ],
    "filters": [
      "p",
      "p",
      "blockquote"
    ],
    "execute": [
      "p",
      "div"
    ],
    "runs": [
      "p"
    ],
    "under": [
      "p"
    ],
    "impersonated": [
      "p"
    ],
    "security": [
      "p"
    ],
    "context": [
      "p"
    ],
    "even": [
      "p",
      "div"
    ],
    "you": [
      "p",
      "p",
      "div",
      "div"
    ],
    "are": [
      "p",
      "blockquote"
    ],
    "reverting": [
      "p"
    ],
    "this": [
      "p"
    ],
    "particularly": [
      "p"
    ],
    "serious": [
      "p"
    ],
    "impersonates": [
      "p"
    ],
    "privileged": [
      "p"
    ],
    "account": [
      "p"
    ],
    "does": [
      "p",
      "div"
    ],
    "can": [
      "p"
    ],
    "be": [
      "p"
    ],
    "executed": [
      "p",
      "p"
    ],
    "programmatic": [
      "p"
    ],
    "structured": [
      "p"
    ],
    "handling": [
      "p"
    ],
    "put": [
      "p"
    ],
    "inside": [
      "p"
    ],
    "try": [
      "p",
      "b"
    ],
    "blocks": [
      "p"
    ],
    "handle": [
      "p"
    ],
    "prevent": [
      "p"
    ],
    "propagating": [
      "p",
      "div"
    ],
    "reverted": [
      "p"
    ],
    "as": [
      "p"
    ],
    "shown": [
      "p"
    ],
    "following": [
      "p"
    ],
    "example": [
      "p"
    ],
    "using": [
      "pre",
      "div"
    ],
    "systemsecurity.principal;.": [
      "pre"
    ],
    "windowsidentity": [
      "pre"
    ],
    "winidentity": [
      "pre"
    ],
    "=": [
      "pre",
      "pre",
      "pre"
    ],
    "new": [
      "pre"
    ],
    "windowsidentity\"username@domainname\");windowsimpersonationcontext": [
      "pre"
    ],
    "ctx": [
      "pre",
      "pre"
    ],
    "nulltry{": [
      "pre"
    ],
    "winidentityimpersonate();": [
      "pre"
    ],
    "//": [
      "pre",
      "pre"
    ],
    "do": [
      "pre",
      "pre"
    ],
    "work": [
      "pre"
    ],
    "..}//": [
      "pre"
    ],
    "let": [
      "pre"
    ],
    "propagate": [
      "pre"
    ],
    "it": [
      "pre",
      "div"
    ],
    "herecatch(exception": [
      "pre"
    ],
    "ex{": [
      "pre"
    ],
    "..}finally{": [
      "pre"
    ],
    "stop": [
      "pre"
    ],
    "impersonating": [
      "pre"
    ],
    "ctxundo();}": [
      "pre"
    ],
    "by": [
      "div",
      "div",
      "blockquote"
    ],
    "make": [
      "div",
      "div"
    ],
    "token": [
      "div",
      "div"
    ],
    "removed": [
      "div"
    ],
    "from": [
      "div",
      "div",
      "div",
      "p"
    ],
    "current": [
      "div"
    ],
    "thread": [
      "div",
      "div"
    ],
    "an": [
      "div",
      "div"
    ],
    "generated": [
      "div"
    ],
    "preventing": [
      "div"
    ],
    "sure": [
      "div"
    ],
    "while": [
      "div"
    ],
    "still": [
      "div"
    ],
    "has": [
      "div"
    ],
    "attatched": [
      "div"
    ],
    "note   exception": [
      "blockquote"
    ],
    "supported": [
      "blockquote"
    ],
    "microsoft": [
      "blockquote",
      "p"
    ],
    "intermediate": [
      "blockquote"
    ],
    "language": [
      "blockquote"
    ],
    "msil)": [
      "blockquote"
    ],
    "visual": [
      "blockquote"
    ],
    "basic": [
      "blockquote"
    ],
    "net": [
      "blockquote"
    ],
    "note": [
      "b"
    ],
    "adapted": [
      "p"
    ],
    "patterns": [
      "p"
    ],
    "&": [
      "p"
    ],
    "practices": [
      "p"
    ],
    "guidance": [
      "p"
    ]
  },
  "tags": {
    "h1": [
      "What to Check For",
      "How to Fix"
    ],
    "p": [
      "Check to ensure that code in your application is not subject to exception filter issues where the filter higher in the call stack executes before code in a finally block.",
      "",
      "If your code fails to catch exceptions and your code uses impersonation, a malicious user could use exception filters to execute code that runs under the impersonated security context, even if you are reverting the impersonation in your finally block. This is particularly serious if your code impersonates a privileged account. If your code does not catch the exception, exception filters higher in the call stack can be executed before code in your finally block is executed.",
      "If you use programmatic impersonation, use structured exception handling and put the impersonation code inside try blocks. Use a catch block to handle exceptions and to prevent exceptions propagating. Use a finally block to ensure that the impersonation is reverted, as shown in the following example.",
      "Adapted from Microsoft patterns & practices guidance."
    ],
    "b": [
      "finally",
      "finally",
      "try",
      "catch",
      "finally",
      "finally",
      "catch",
      "Note"
    ],
    "pre": [
      "using System.Security.Principal;. . .WindowsIdentity winIdentity = new WindowsIdentity(\"username@domainName\");WindowsImpersonationContext ctx = null;try{  ctx = winIdentity.Impersonate();  // Do work.  ...}// Do not let the exception propagate. Catch it here.catch(Exception ex){  ...}finally{  // Stop impersonating.  ctx.Undo();}"
    ],
    "br": [
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      ""
    ],
    "div": [
      "",
      "By using a finally block, you make ensure that the impersonation token is removed from the current thread, even if an exception is generated. By preventing the exception from propagating from the catch block, you make sure that exception filter code higher in the call stack does not execute while the thread still has an impersonation token attatched to it."
    ],
    "blockquote": [
      "Note   Exception filters are supported by Microsoft Intermediate Language (MSIL) and Visual Basic .NET"
    ],
    "hr": [
      ""
    ]
  },
  "links": [],
  "html": "<h1>What to Check For</h1>\r\n  <p>Check to ensure that code in your application is not subject to exception filter issues where the filter higher in the call stack executes before code in a finally block.</p>\r\n  <p />\r\n  <h1>How to Fix</h1>\r\n  <p>If your code fails to catch exceptions and your code uses impersonation, a malicious user could use exception filters to execute code that runs under the impersonated security context, even if you are reverting the impersonation in your <b>finally</b> block. This is particularly serious if your code impersonates a privileged account. If your code does not catch the exception, exception filters higher in the call stack can be executed before code in your <b>finally</b> block is executed.</p>\r\n  <p>If you use programmatic impersonation, use structured exception handling and put the impersonation code inside <b>try</b> blocks. Use a <b>catch</b> block to handle exceptions and to prevent exceptions propagating. Use a <b>finally</b> block to ensure that the impersonation is reverted, as shown in the following example.</p>\r\n  <pre>using System.Security.Principal;<br />. . .<br />WindowsIdentity winIdentity = new WindowsIdentity(\"username&#64;domainName\");<br />WindowsImpersonationContext ctx = null;<br />try<br />&#123;<br /><br />&nbsp; ctx = winIdentity.Impersonate();<br />&nbsp; // Do work.<br />&nbsp; ...<br />&#125;<br />// Do not let the exception propagate. Catch it here.<br />catch(Exception ex)<br />&#123;<br />&nbsp; ...<br />&#125;<br />finally<br />&#123;<br />&nbsp; // Stop impersonating.<br />&nbsp; ctx.Undo();<br />&#125;</pre>\r\n  <div>&nbsp;</div>\r\n  <div>By using a <b>finally</b> block, you make ensure that the impersonation token is removed from the current thread, even if an exception is generated. By preventing the exception from propagating from the <b>catch</b> block, you make sure that exception filter code higher in the call stack does not execute while the thread still has an impersonation token attatched to it.</div>\r\n  <blockquote>\r\n    <b>Note</b>&nbsp;&nbsp;&nbsp;Exception filters are supported by Microsoft Intermediate Language (MSIL) and Visual Basic .NET</blockquote>\r\n  <hr />\r\n  <p>Adapted from Microsoft patterns & practices guidance.</p>"
}