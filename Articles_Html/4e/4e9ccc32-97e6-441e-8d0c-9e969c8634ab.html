<h2>Applies To</h2><ul><li> Java</li>
</ul><h2>What to Check For</h2><p>Verify that all file name and path input is canonicalized before being validated.
</p><h2>Why</h2><p>When input validation is applied to file paths and names, it only works properly when file paths and names are canonicalized. If file names and paths are not canonicalized before validation, a number of vulnerabilities may be introduced as a result. The possible vulnerabilities range from reading arbitrary files to uploading web shells. 
</p><h2>How to Check</h2><p>To verify that all file name and path input is canonicalized before being validated:
</p><ol>
<li> <strong>Identify all file path and name input.</strong> Examine the application and find all cases where the user may specify file names or paths.</li>
<li> <strong>Find code that handles file path and name input.</strong> Review application code and find all functions that handle user supplied file names or paths.</li>
<li> <strong>Determine whether file path and name input is necessary.</strong> If possible, don't accept file names and/or paths from users.</li>
<li> <strong>Verify that file name and path input is canonicalized.</strong> If it is necessary to use file names and/or paths provided by users, then make sure that the getCanonicalPath() function is used to canonicalize them before validation.</li>
<li> <strong>Verify that file name and path input is validated.</strong> Review code that handles user-supplied file name and/or path input and make sure that file names and paths are validated after being canonicalized. The canonicalized forms of file names and paths should be passed to validation routines.</li>
</ol><h2>How to Fix</h2><p>To canonicalize all file path and name input:
</p><ol>
<li> <strong>Identify all file path and name input.</strong> Examine the application and find all cases where the user may specify file names or paths.</li>
<li> <strong>Find code that handles file path and name input.</strong> Review application code and find all functions that handle user supplied file names or paths.</li>
<li> <strong>Avoid file path and name input if possible.</strong> If possible, remove or replace the code that allows users to enter file names or paths.</li>
<li> <strong>Canonicalize file path and name input.</strong> Examine each function that handles user supplied file names or paths. Re-write these functions as necessary to use getCanonicalPath() to canonicalize file names and paths.</li>
<li> <strong>Validate file path and name input.</strong> Examine each function that handles user supplied file names or paths. Re-write these functions as necessary to use positive validation on canonicalized file names and paths. Ensure that the validation routines validate that the user has sufficient rights to access the requested resource.</li>
</ol><h2>Additional Resources</h2><ul><li> For more information about canonicalizing file paths in Java, see <a href="https://www.securecoding.cert.org/confluence/display/java/IDS02-J.+Canonicalize+path+names+before+validating+them">https://www.securecoding.cert.org/confluence/display/java/IDS02-J.+Canonicalize+path+names+before+validating+them</a></li>
</ul>