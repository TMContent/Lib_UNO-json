{
  "id": "4b8c979b-c587-495a-a233-83b6953869c8",
  "checksum": "6e73bead614ad248b11ec92c31dae058b207ba3a",
  "words": {
    "0": [
      "pre"
    ],
    "35": [
      "ul",
      "li"
    ],
    "2008": [
      "ul",
      "li"
    ],
    "applies": [
      "h1"
    ],
    "to": [
      "h1",
      "p",
      "p",
      "p",
      "pre",
      "ul",
      "li",
      "title",
      "title"
    ],
    "microsoft®": [
      "ul",
      "li"
    ],
    "windows": [
      "ul",
      "li"
    ],
    "communication": [
      "ul",
      "li"
    ],
    "foundation": [
      "ul",
      "li"
    ],
    "wcf)": [
      "ul",
      "li"
    ],
    "microsoft": [
      "ul",
      "li",
      "p"
    ],
    "visual": [
      "ul",
      "li"
    ],
    "studio®": [
      "ul",
      "li"
    ],
    "description": [
      "h1"
    ],
    "if": [
      "p",
      "pre",
      "pre",
      "pre"
    ],
    "your": [
      "p"
    ],
    "application": [
      "p"
    ],
    "uses": [
      "p"
    ],
    "a": [
      "p",
      "p",
      "pre",
      "ul",
      "li"
    ],
    "custom": [
      "p",
      "p",
      "p",
      "pre",
      "ul",
      "ul",
      "li",
      "li",
      "title"
    ],
    "authentication": [
      "p",
      "p",
      "title"
    ],
    "you": [
      "p",
      "p",
      "p",
      "p"
    ],
    "will": [
      "p",
      "p"
    ],
    "need": [
      "p"
    ],
    "create": [
      "p",
      "ul",
      "li"
    ],
    "class": [
      "p",
      "p",
      "pre"
    ],
    "that": [
      "p",
      "p"
    ],
    "derives": [
      "p"
    ],
    "from": [
      "p",
      "p",
      "p",
      "pre",
      "p"
    ],
    "iauthorizationpolicy": [
      "p",
      "pre",
      "title"
    ],
    "in": [
      "p",
      "p",
      "p",
      "p",
      "p"
    ],
    "this": [
      "p"
    ],
    "retrieve": [
      "p"
    ],
    "the": [
      "p",
      "p",
      "p",
      "p",
      "p",
      "p",
      "p",
      "p",
      "p",
      "pre",
      "pre",
      "p",
      "p",
      "p",
      "p",
      "p",
      "p",
      "p",
      "pre",
      "title"
    ],
    "principal": [
      "p",
      "p",
      "pre",
      "pre",
      "pre",
      "pre",
      "pre",
      "title"
    ],
    "cache": [
      "p",
      "pre"
    ],
    "was": [
      "p"
    ],
    "created": [
      "p"
    ],
    "by": [
      "p"
    ],
    "or": [
      "p",
      "pre",
      "p",
      "p"
    ],
    "store": [
      "p"
    ],
    "based": [
      "p"
    ],
    "on": [
      "p",
      "ul",
      "ul",
      "li",
      "li"
    ],
    "user": [
      "p",
      "p"
    ],
    "name": [
      "p"
    ],
    "so": [
      "p"
    ],
    "wcf": [
      "p"
    ],
    "can": [
      "p"
    ],
    "authorize": [
      "p"
    ],
    "after": [
      "p"
    ],
    "get": [
      "p",
      "pre",
      "pre"
    ],
    "assign": [
      "p",
      "title"
    ],
    "it": [
      "p"
    ],
    "evaluationcontextproperties[“principal”]": [
      "p"
    ],
    "and": [
      "p"
    ],
    "identity": [
      "p",
      "pre"
    ],
    "evaluationcontextproperties[\"identities\"].": [
      "p"
    ],
    "using": [
      "pre",
      "title"
    ],
    "systemusing": [
      "pre"
    ],
    "systemcollections.generic;using": [
      "pre"
    ],
    "systemlinq;using": [
      "pre"
    ],
    "systemtext;using": [
      "pre"
    ],
    "systemidentitymodel.claims;using": [
      "pre"
    ],
    "systemidentitymodel.policy;using": [
      "pre"
    ],
    "systemweb;using": [
      "pre"
    ],
    "systemsecurity.principal;using": [
      "pre"
    ],
    "customauthenticator": [
      "pre"
    ],
    "namespace": [
      "pre"
    ],
    "authorizationpolicy{": [
      "pre"
    ],
    "public": [
      "pre",
      "pre",
      "pre",
      "pre"
    ],
    "authorizationprincipalpolicy": [
      "pre"
    ],
    "{": [
      "pre",
      "pre",
      "pre",
      "pre",
      "pre",
      "pre",
      "pre",
      "pre"
    ],
    "bool": [
      "pre"
    ],
    "evaluateevaluationcontext": [
      "pre"
    ],
    "evaluationcontext": [
      "pre"
    ],
    "ref": [
      "pre"
    ],
    "object": [
      "pre",
      "pre"
    ],
    "state": [
      "pre"
    ],
    "obj": [
      "pre",
      "pre"
    ],
    "!evaluationcontext.properties.trygetvalue(\"identities\",": [
      "pre"
    ],
    "out": [
      "pre"
    ],
    "obj)": [
      "pre"
    ],
    "return": [
      "pre",
      "pre",
      "pre",
      "pre",
      "pre"
    ],
    "false": [
      "pre",
      "pre"
    ],
    "ilistiidentity>": [
      "pre"
    ],
    "identities": [
      "pre",
      "pre"
    ],
    "=": [
      "pre",
      "pre",
      "pre",
      "pre",
      "pre",
      "pre",
      "pre",
      "pre"
    ],
    "as": [
      "pre"
    ],
    "ilistiidentity>;": [
      "pre"
    ],
    "//": [
      "pre"
    ],
    "make": [
      "pre"
    ],
    "sure": [
      "pre"
    ],
    "there": [
      "pre"
    ],
    "is": [
      "pre",
      "p"
    ],
    "already": [
      "pre"
    ],
    "default": [
      "pre"
    ],
    "==": [
      "pre",
      "pre"
    ],
    "null": [
      "pre",
      "pre"
    ],
    "||": [
      "pre"
    ],
    "identitiescount": [
      "pre"
    ],
    "string": [
      "pre",
      "pre"
    ],
    "username": [
      "pre"
    ],
    "identities0].name;": [
      "pre"
    ],
    "//get": [
      "pre"
    ],
    "build": [
      "pre"
    ],
    "another": [
      "pre"
    ],
    "one": [
      "pre",
      "pre"
    ],
    "iprincipal": [
      "pre"
    ],
    "usernameauthenticatorgetuser(username);": [
      "pre"
    ],
    "string]": [
      "pre"
    ],
    "roles": [
      "pre"
    ],
    "usernameauthenticatorgetrolesforuser(username);": [
      "pre"
    ],
    "new": [
      "pre",
      "pre"
    ],
    "genericprincipalnew": [
      "pre"
    ],
    "genericidentityusername,": [
      "pre"
    ],
    "\"custom": [
      "pre"
    ],
    "provider\",": [
      "pre"
    ],
    "roles;": [
      "pre"
    ],
    "}": [
      "pre",
      "pre",
      "pre",
      "pre",
      "pre",
      "pre",
      "pre"
    ],
    "evaluationcontextproperties[\"principal\"]": [
      "pre"
    ],
    "evaluationcontextproperties[\"identities\"]": [
      "pre"
    ],
    "listiidentity>()": [
      "pre"
    ],
    "principalidentity": [
      "pre"
    ],
    "true": [
      "pre"
    ],
    "systemidentitymodel.claims.claimset": [
      "pre"
    ],
    "issuer": [
      "pre"
    ],
    "claimsetsystem;": [
      "pre"
    ],
    "id": [
      "pre"
    ],
    "\"contextprincipalpolicy\"": [
      "pre"
    ],
    "}}": [
      "pre"
    ],
    "policy": [
      "p",
      "p",
      "p"
    ],
    "library": [
      "p"
    ],
    "configured": [
      "p"
    ],
    "webconfig": [
      "p"
    ],
    "appconfig": [
      "p"
    ],
    "configuration": [
      "p"
    ],
    "file": [
      "p",
      "p"
    ],
    "code": [
      "p"
    ],
    "following": [
      "p"
    ],
    "example": [
      "p"
    ],
    "configures": [
      "p"
    ],
    "location": [
      "p"
    ],
    "config": [
      "p"
    ],
    "define": [
      "p"
    ],
    "authorization": [
      "p",
      "pre",
      "ul",
      "ul",
      "ul",
      "li",
      "li",
      "li",
      "title"
    ],
    "type": [
      "p"
    ],
    "add": [
      "p",
      "strong"
    ],
    "element": [
      "p"
    ],
    "policytype": [
      "p",
      "strong"
    ],
    "attribute": [
      "p"
    ],
    "serviceauthorization": [
      "pre",
      "pre"
    ],
    "serviceauthorizationmanagertype=\"microsoftservicemodel.samples.myserviceauthorizationmanager,": [
      "pre"
    ],
    "service\"<!--": [
      "pre"
    ],
    "behavior": [
      "pre"
    ],
    "allows": [
      "pre"
    ],
    "specify": [
      "pre"
    ],
    "policies": [
      "pre",
      "ul",
      "li"
    ],
    "--<authorizationpolicies><add": [
      "pre"
    ],
    "policytype=\"microsoftservicemodel.samples.customauthorizationpolicy.myauthorizationpolicy,": [
      "pre"
    ],
    "policylibrary\"": [
      "pre"
    ],
    "/</authorizationpolicies></serviceauthorization>": [
      "pre"
    ],
    "additional": [
      "h1"
    ],
    "resources": [
      "h1"
    ],
    "for": [
      "ul",
      "li",
      "li"
    ],
    "more": [
      "ul",
      "ul",
      "li",
      "li"
    ],
    "information": [
      "ul",
      "ul",
      "li",
      "li"
    ],
    "see": [
      "ul",
      "ul",
      "li",
      "li"
    ],
    "“how": [
      "ul",
      "li"
    ],
    "policy”": [
      "ul",
      "li"
    ],
    "at": [
      "ul",
      "ul",
      "li",
      "li"
    ],
    "http//msdn.microsoft.com/en-us/library/ms729794(vs.85).aspxfor": [
      "ul"
    ],
    "“authorization”": [
      "ul",
      "li"
    ],
    "http//msdn2.microsoft.com/en-us/library/ms733071.aspx": [
      "ul",
      "li",
      "a"
    ],
    "http//msdn.microsoft.com/en-us/library/ms729794(vs.85).aspx": [
      "li",
      "a"
    ],
    "adapted": [
      "p"
    ],
    "patterns": [
      "p"
    ],
    "&": [
      "p"
    ],
    "practices": [
      "p"
    ],
    "guidance": [
      "p"
    ],
    "how": [
      "title"
    ],
    "current": [
      "title"
    ],
    "with": [
      "title"
    ],
    "allow": [
      "title"
    ]
  },
  "tags": {
    "h1": [
      "Applies to",
      "Description",
      "Additional Resources"
    ],
    "ul": [
      "Microsoft® Windows Communication Foundation (WCF) 3.5 Microsoft Visual Studio® 2008",
      "For more information on custom authorization policies, see “How to: Create a Custom Authorization Policy” at http://msdn.microsoft.com/en-us/library/ms729794(VS.85).aspxFor more information on authorization, see “Authorization” at http://msdn2.microsoft.com/en-us/library/ms733071.aspx"
    ],
    "li": [
      "Microsoft® Windows Communication Foundation (WCF) 3.5",
      "Microsoft Visual Studio® 2008",
      "For more information on custom authorization policies, see “How to: Create a Custom Authorization Policy” at http://msdn.microsoft.com/en-us/library/ms729794(VS.85).aspx",
      "For more information on authorization, see “Authorization” at http://msdn2.microsoft.com/en-us/library/ms733071.aspx"
    ],
    "p": [
      "If your application uses a custom authentication, you will need to create a class that derives from IAuthorizationPolicy. In this class you will retrieve the principal from the cache that was created by the custom authentication, or from the store based on the user name, so WCF can authorize the user. After you get the principal you assign it to EvaluationContext.Properties[“principal”] and the identity to the EvaluationContext.Properties[\"Identities\"].",
      "The Policy library is configured in the web.config or app.config configuration file or in code.  The following example configures the policy location in the config file.  Define the custom authorization policy type in the add element policyType attribute.",
      "Adapted from Microsoft patterns & practices guidance."
    ],
    "pre": [
      "using System;using System.Collections.Generic;using System.Linq;using System.Text;using System.IdentityModel.Claims;using System.IdentityModel.Policy;using System.Web;using System.Security.Principal;using CustomAuthenticator;",
      "namespace AuthorizationPolicy{    public class AuthorizationPrincipalPolicy : IAuthorizationPolicy    {        public bool Evaluate(EvaluationContext evaluationContext, ref         object state)        {",
      "object obj;            if (!evaluationContext.Properties.TryGetValue(\"Identities\",                out obj))                return false;            IList<IIdentity> identities = obj as IList<IIdentity>;",
      "// make sure there is already a default identity            if (identities == null || identities.Count <= 0)                return false;",
      "string username = identities[0].Name;",
      "//get the principal from the cache or build another one",
      "IPrincipal principal =             UserNameAuthenticator.GetUser(username);",
      "if (principal == null)            {                string[] roles =                 UserNameAuthenticator.GetRolesForUser(username);                principal = new GenericPrincipal(new                 GenericIdentity(username, \"Custom Provider\"), roles);            }            evaluationContext.Properties[\"Principal\"] = principal;            evaluationContext.Properties[\"Identities\"] =                   new List<IIdentity>() { principal.Identity };",
      "return true;        }",
      "public System.IdentityModel.Claims.ClaimSet Issuer        {            get { return ClaimSet.System; }        }",
      "public string Id        {            get { return \"ContextPrincipalPolicy\"; }        }    }}",
      "<serviceAuthorization serviceAuthorizationManagerType=\"Microsoft.ServiceModel.Samples.MyServiceAuthorizationManager, service\"><!-- The serviceAuthorization behavior allows one to specify custom authorization policies. --><authorizationPolicies><add policyType=\"Microsoft.ServiceModel.Samples.CustomAuthorizationPolicy.MyAuthorizationPolicy, PolicyLibrary\" /></authorizationPolicies></serviceAuthorization>"
    ],
    "br": [
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      "",
      ""
    ],
    "strong": [
      "add",
      "policyType"
    ],
    "a": [
      "http://msdn.microsoft.com/en-us/library/ms729794(VS.85).aspx",
      "http://msdn2.microsoft.com/en-us/library/ms733071.aspx"
    ],
    "hr": [
      ""
    ]
  },
  "links": [
    {
      "href": "http://msdn.microsoft.com/en-us/library/ms729794(VS.85).aspx",
      "text": "http://msdn.microsoft.com/en-us/library/ms729794(VS.85).aspx"
    },
    {
      "href": "http://msdn2.microsoft.com/en-us/library/ms733071.aspx",
      "text": "http://msdn2.microsoft.com/en-us/library/ms733071.aspx"
    }
  ],
  "html": "<h1>Applies to</h1>\n  <ul>\n    <li>Microsoft&#174; Windows Communication Foundation (WCF) 3.5 <li>Microsoft Visual Studio&#174; 2008</li></li>\n  </ul>\n  <h1>Description</h1>\n  <p>If your application uses a custom authentication, you will need to create a class that derives from IAuthorizationPolicy. In this class you will retrieve the principal from the cache that was created by the custom authentication, or from the store based on the user name, so WCF can authorize the user. After you get the principal you assign it to EvaluationContext.Properties&#91;&#8220;principal&#8221;&#93; and the identity to the EvaluationContext.Properties&#91;\"Identities\"&#93;. </p>\n  <pre>using System;<br />using System.Collections.Generic;<br />using System.Linq;<br />using System.Text;<br />using System.IdentityModel.Claims;<br />using System.IdentityModel.Policy;<br />using System.Web;<br />using System.Security.Principal;<br />using CustomAuthenticator;</pre>\n  <pre>namespace AuthorizationPolicy<br />&#123;<br /><br />    public class AuthorizationPrincipalPolicy : IAuthorizationPolicy<br />    &#123;<br />        public bool Evaluate(EvaluationContext evaluationContext, ref <br />        object state)<br />        &#123;</pre>\n  <pre>            object obj;<br />            if (&#33;evaluationContext.Properties.TryGetValue(\"Identities\",<br />                out obj))<br />                return false;<br />            IList&lt;IIdentity&gt; identities = obj as IList&lt;IIdentity&gt;;</pre>\n  <pre>            // make sure there is already a default identity<br />            if (identities == null &#124;&#124; identities.Count &lt;= 0)<br />                return false;</pre>\n  <pre>\n    <br />            string username = identities&#91;0&#93;.Name;</pre>\n  <pre>            //get the principal from the cache or build another one  </pre>\n  <pre>            IPrincipal principal = <br />            UserNameAuthenticator.GetUser(username);</pre>\n  <pre>            if (principal == null)<br />            &#123;<br />                string&#91;&#93; roles = <br />                UserNameAuthenticator.GetRolesForUser(username);<br />                principal = new GenericPrincipal(new <br />                GenericIdentity(username, \"Custom Provider\"), roles);<br /><br />            &#125;<br /><br />            evaluationContext.Properties&#91;\"Principal\"&#93; = principal;<br />            evaluationContext.Properties&#91;\"Identities\"&#93; =<br />                   new List&lt;IIdentity&gt;() &#123; principal.Identity &#125;;            </pre>\n  <pre>            return true;<br />        &#125;</pre>\n  <pre>        public System.IdentityModel.Claims.ClaimSet Issuer<br />        &#123;<br />            get &#123; return ClaimSet.System; &#125;<br />        &#125;</pre>\n  <pre>        public string Id<br />        &#123;<br />            get &#123; return \"ContextPrincipalPolicy\"; &#125;<br />        &#125;<br />    &#125;<br />&#125;</pre>\n  <p>The Policy library is configured in the web.config or app.config configuration file or in code.  The following example configures the policy location in the config file.  Define the custom authorization policy type in the <strong>add</strong> element <strong>policyType</strong> attribute.</p>\n  <pre>&lt;serviceAuthorization serviceAuthorizationManagerType=\"Microsoft.ServiceModel.Samples.MyServiceAuthorizationManager, service\"&gt;<br />&lt;&#33;-- The serviceAuthorization behavior allows one to specify custom authorization policies. --&gt;<br />&lt;authorizationPolicies&gt;<br />&lt;add policyType=\"Microsoft.ServiceModel.Samples.CustomAuthorizationPolicy.MyAuthorizationPolicy, PolicyLibrary\" /&gt;<br />&lt;/authorizationPolicies&gt;<br />&lt;/serviceAuthorization&gt;</pre>\n  <h1>Additional Resources</h1>\n  <ul>\n    <li>For more information on custom authorization policies, see &#8220;How to: Create a Custom Authorization Policy&#8221; at <a href=\"http://msdn.microsoft.com/en-us/library/ms729794(VS.85).aspx\">http://msdn.microsoft.com/en-us/library/ms729794(VS.85).aspx</a><li>For more information on authorization, see &#8220;Authorization&#8221; at <a href=\"http://msdn2.microsoft.com/en-us/library/ms733071.aspx\">http://msdn2.microsoft.com/en-us/library/ms733071.aspx</a></li></li>\n  </ul>\n  <hr />\n  <p>Adapted from Microsoft patterns & practices guidance.</p>"
}