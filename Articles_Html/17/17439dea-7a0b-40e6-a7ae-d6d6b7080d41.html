<h1>What to Check For</h1>
  <p>Ensure that the application connects to databases using the least-privileged account possible.</p>
  <h1>Why</h1>
  <p>Connecting to the database with a least privilege account limits the damage that can be done in the event of a SQL injection attack or in the event of an attacker obtaining your account's credentials. </p>
  <h1>How to Check</h1>
  <p>The principle of least privilege requires that users are granted enough privileges to complete their respective tasks. If your application uses a backend database server, take the following steps to ensure that your application applies the principle of least privilege:</p>
  <ol>
    <li>
      <p>
        <strong>Identify all database accounts that the application uses.</strong> List all of the application's database accounts existing on the various servers it uses. The database account information can usually be obtained from the connection strings in the web.config file. If hard-coded account details are found in the application code, they should be changed to refer to configurable connection strings.</p>
      <li>
        <p>
          <strong>Identify the roles associated with each database account.</strong> Identify the database actions that each account performs. Using a matrix, identify the minimum set of privileges that each account requires:</p>
        <ul>
          <li>
            <p>
              <strong>Identify the minimum set of privileges that each account/role requires:</strong> Determine the tables and stored procedures accessed and the actions(read, write, drop, create, etc) performed on the tables by each account/role. This can be determined from the sections of code where the application accesses the back-end database. Use this information to create a matrix:</p>
            <pre>Accounts     Actions    Stored Proc     Users Table<br />------------------------------------------------------<br />app_admin    Connect    Always          Always<br />             Read       Always          Always<br />             Use        Always          Occasionally<br />             Modify     Never           Occasionally <br />app_normal   Connect    Always          Always<br />             Read       Always          Always<br />             Use        Always          Always<br />             Modify     Never           Never</pre>
            <li>
              <strong>Identify the set of privileges that each account/role actually has.</strong> Determine the actual database access privileges granted to each database account. This information can be obtained from the database server.</li>
          </li>
        </ul>
        <li>
          <p>
            <strong>Ensure that no extra privileges are granted to an account.</strong> Compare each account's intended privileges against its actual privileges. Verify that no account is granted extra privileges.</p>
          <ul>
            <li>No direct table access is provided and access is limited to selected stored procedures only. <li>If table access is needed, only minimum access required is granted <li>A database role is used to avoid granting permissions directly to a fixed user <li>If application is complicated, privileges are separated by partitioning the database access into different accounts</li></li></li></li>
          </ul>
        </li>
      </li>
    </li>
  </ol>
  <h1>Problem Example</h1>
  <p>The following snippet shows a list of database accounts and some of their permissions. Unfortunately, the application's account (myapp) is given more privileges than necessary. If an attacker compromises the application's database account, she can drop tables from the database server.</p>
  <p />
  <pre>&#43;----------------&#43;-------&#43;-------------&#43;-----------&#43;<br />&#124; host           &#124; user  &#124; select      &#124; drop      &#124;<br />&#43;----------------&#43;-------&#43;-------------&#43;-----------&#43;<br />&#124; localhost      &#124; sa    &#124; Y           &#124; Y         &#124;<br />&#124; 192.168.10.220 &#124; myapp &#124; Y           &#124; Y         &#124;<br />&#43;----------------&#43;-------&#43;-------------&#43;-----------&#43;</pre>
  <h1>Related Guideline</h1>
  <ul>
    <li>
      <a href="/article/fab1733c-61d7-46a8-88c6-2617a643c0d9">Guideline: Use Least Privileged Accounts for Database Access</a>
    </li>
  </ul>
  <hr />
  <p>Adapted from Microsoft patterns & practices guidance. </p>