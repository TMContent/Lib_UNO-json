<h2>Applies To</h2><ul><li> Java</li>
</ul>
<h2>What to Do</h2><p>Multiple threads within a servlet session may have access to the same <em>HttpSession</em> objects. Avoid using instance and static class variables and always consider thread safety during object initialization or modification.
</p>
<h2>Why</h2><p>Improper handling of <em>HttpSession</em> objects can lead to race conditions and concurrency issues.
</p>
<h2>How</h2><p>To ensure thread safety:
</p><ol>
<li> <strong>Identify all <em>HttpSession</em> objects that may be modified by multiple threads.</strong> Find all code that modifies <em>HttpSession</em> objects, which may be accessed by multiple threads. One approach is to search code for the <em>HttpSession</em> keyword and then trace each <em>HttpSession</em> object throughout the code.</li>
<li> <strong>Use immutable objects as much as possible.</strong> Using immutable objects is a sound practice for avoiding concurrency issues and should be used as much as possible. The specifics of using immutable objects are different for different applications.</li>
<li> <strong>Use class methods and local variables data handling.</strong> For each piece of code that modifies <em>HttpSession</em> objects, use "thread-safe" class methods and local variables if possible. </li>
<li> <strong>Synchronize critical sections that must be executed as a single operation.</strong> For complex operations on <em>HttpSession</em> objects, make sure that critical sections are synchronized.</li>
</ol>
<h2>Problem Example</h2><p>A shopping cart has a Pay Now button that finalizes a purchase and charges the customerâ€™s credit card. An application that is not thread safe may allow for a user to double-click the button and charge the customer twice for the same transaction.
</p>
<h2>Solution Example</h2><p>Synchronized critical sections or immutable objects both can help prevent concurrency issues that might lead to simultaneous credit card transactions.  
</p>
<h2>Additional Resources</h2><ul><li> For more information about using immutable objects, see <a href="http://docs.oracle.com/javase/tutorial/essential/concurrency/immutable.html">http://docs.oracle.com/javase/tutorial/essential/concurrency/immutable.html</a>
&lt;/add:&gt;&lt;/replace&gt;</li></ul>