<h2>Applies To</h2><ul><li> ASP.NET</li>
</ul><h2>What to Check For</h2><p>Verify that all file paths and names obtained as user input are canonicalized before making security decisions on access to resources..
</p><h2>Why</h2><p>When input validation is applied to file paths and names, it only works properly when file paths and names are canonicalized.  If file names and paths are not canonicalized	 before validation, a number of vulnerabilities may be introduced as a result. The possible vulnerabilities range from reading arbitrary files to uploading web shells.
</p><h2>How to Check</h2><p>To make sure that all file path and name input is canonicalized:
</p><ol>
<li> <strong>Identify all file path and name input.</strong> Examine the application and find all cases where the user may specify file names or paths.</li>
<li> <strong>Find code that handles file path and name input.</strong> Review application code and find all functions that handle user supplied file names or paths.</li>
<li> <strong>Consider whether file name or path input is necessary.</strong> Examine the code that accepts file name or path input from the user and consider other ways to do the same thing or removing this functionality altogether.</li>
<li> <strong>Verify that file name and path input is canonicalized.</strong> Examine each function that handles user supplied file names or paths. Make sure user supplied input is immediately canonicalized. Make sure you use <em>System.IO.Path.GetFullPath</em> to canonicalize file names and paths before validation. Use of standard canonicalization libraries yields in consistent results and ensures coverage of all cases.</li>
<li> <strong>Verify that file name and path input is validated.</strong> Examine each function that handles user supplied file names or paths. Make sure these functions use positive validation routines on file names and paths after canonicalization.</li>
</ol><h2>How to Fix</h2><p>To canonicalize all file path and name input:
</p><ol>
<li> <strong>Identify all file path and name input.</strong> Examine the application and find all cases where the user may specify file names or paths.</li>
<li> <strong>Find code that handles file path and name input.</strong> Review application code and find all functions that handle user supplied file names or paths.</li>
<li> <strong>Avoid file path and name input if possible.</strong> If possible, remove or replace the code that allows users to enter file names or paths.</li>
<li> <strong>Canonicalize file path and name input.</strong> Examine each function that handles user supplied file names or paths. Re-write these functions as necessary to use <em>System.IO.Path.GetFullPath</em> to canonicalize file names and paths.</li>
<li> <strong>Validate file path and name input.</strong> Examine each function that handles user supplied file names or paths. Re-write these functions as necessary to use positive validation on canonicalized file names and paths.</li></ol>