<h2>Applies To</h2><ul><li> HTML5</li>
</ul><h2>What to Do</h2><p>Allow only specific trusted domains when using the <em>Access-Control-Allow-Origin</em> header.
</p><h2>Why</h2><p>Only specific trusted domains should be allowed when using the <em>Access-Control-Allow-Origin</em> header to prevent unauthorized sites from accessing the resource. 
</p><p>
It is possible to use the "*" as the wildcard that allows any site to access a resource when using the <em>Access-Control-Allow-Origin</em>. This is discouraged, because it might allow an attacker to hijack the application if the user visits a malicious page or is exposed to a XSS attack. Specifically, an attacker might cause the application to load malicious data that presents incorrect information to the user via the XMLHttpRequest API.
</p><h2>How</h2><p>To allow only specific trusted domains when using the <em>Access-Control-Allow-Origin</em> header:
</p><ol>
<li> <strong>Identify code that sends <em>Access-Control-Allow-Origin</em> headers.</strong> Search the application code for <em>Access-Control-Allow-Origin</em> to find code that sends those headers. Create a spreadsheet of all code that sends <em>Access-Control-Allow-Origin</em> headers.   Note that the functions for doing so are different on different platforms. <strong>In PHP</strong>, the <em>header</em> function is used to send custom headers, but it would be more practical to search for <em>Access-Control-Allow-Origin</em> in PHP applications. <strong>In Java</strong>, headers are added using the <em>allowedOrigins</em> HTTP filter in <em>web.xml</em> files. Technically, this is not code, but the principle is the same. In Java, it would be most practical to search for <em>allowedOrigins</em> in <em>web.xml</em> files. It is also possible to send headers using <em>response.addHeader</em> in Java, so searching the code for <em>Access-Control-Allow-Origin</em> is a good idea. <strong>In ASP.NET</strong>, the <em>Response.Headers.Add</em> method can be used to add custom headers, and again it would be more practical to search for <em>Access-Control-Allow-Origin</em>. </li>
<li> <strong>Define trusted domains.</strong> For each piece of code that sends the <em>Access-Control-Allow-Origin</em> header in the spreadsheet, define all trusted domains that are authorized to access the page that sends that header. If the application has to determine these domains at run-time, document how.</li>
<li> <strong>Specify trusted domains in <em>Access-Control-Allow-Origin</em> headers.</strong> For each piece of code that sends the <em>Access-Control-Allow-Origin</em> header, change it to specify the trusted domain(s) as documented in the spreadsheet. If multiple domains are authorized, the header needs to be sent multiple times, once for each domain. If trusted domains have to be determined at run-time by the application, add corresponding code to the application. If trusted domains have to be a configurable option, add corresponding code for that.</li>
</ol><h2>CORS Guidelines</h2><ul><li> <a href="00000000-0000-0000-0000-000000690310">Allow Only Trusted Domains in the Access-Control-Allow-Origin Header</a></li>
<li> <a href="00000000-0000-0000-0000-0000000a3746">Validate URLs Passed to XMLHttpRequest.open</a></li>
</ul><h2>CORS Checklist Items</h2><ul><li> <a href="00000000-0000-0000-0000-00000095ebe9">Only Trusted Domains Are Allowed in the Access-Control-Allow-Origin Header</a></li>
<li> <a href="00000000-0000-0000-0000-0000000be99d">URLs Passed to XMLHttpRequest.open Are Validated</a></li>
</ul>