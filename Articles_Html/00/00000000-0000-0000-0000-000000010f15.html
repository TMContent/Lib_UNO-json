<h2>Applies To</h2><p>HTML5 and Javascript
</p><h2>What to Check For</h2><p>Verify that URLs passed to the EventSource constructor are validated.
</p><h2>Why</h2><p>If you fail to validate a URL passed to the EventSource constructor, you could potentially receive messages that contain malicious or incorrect data.
</p><h2>How To Check</h2><p>To verify that URLs passed to the EventSource constructur are validated:
</p><ol>
<li> <strong>Locate the instances in your JavaScript that use the EventSource constructor</strong>. Search the application code for <tt>EventSource</tt> to find all code that uses the EventSource constructor. Create a spreadsheet to list all such code.</li>
<li> <strong>Review code that uses the EventSource constructor.</strong> Examine each piece of code that uses the EventSource constructor to make sure that the URL passed to the constructor is validated first.</li>
</ol><h2>How To Fix</h2><p>When using the EventSource object, use a regular expression (RegEx object) to make sure that no scheme is included in the URL. This will force the URL to be relative to the current web page or script, which will also ensure that the event source is not from another site. To perform this validation, follow these steps:
</p><ol>
<li> <strong>Locate the instances in your JavaScript that use the EventSource constructor.</strong> The usage of the EventSource constructor is as follows: <tt> var source = new EventSource("eventsource.php"); </tt> Pay particular attention if this code is inside a function where the URL of the source may be provided as an argument from other code. </li>
<li> <strong>Determine a policy for allowing sources.</strong> Do not allow an EventSource that includes a scheme (“http:” or “https:”) at the beginning of the value, because this means the EventSource may come from a different site. Instead, you should consider only allowing relative URLs, which will not start with the scheme.</li>
<li> <strong>Check the length of the URL before validating it.</strong> Use the length property to ensure the size of the domain is not so large that it will cause a RegEx denial of service (DoS). </li>
<li> <strong>Write a regular expression that validates the URL.</strong> Make sure that no scheme is included in the URL, and make sure it is a relative path. The following example uses a negative look-ahead group in the format <tt>(?!&lt;expression&gt;) </tt>. <tt> ^(?!https?:) </tt>
The <tt>s?</tt> part of this expression allows it to capture both HTTP and HTTPS over Secure Sockets Layer (HTTPS). The <tt>?</tt> character matches if the preceding expression(s) occurs either not at all or at most one time.</li>
<li> <strong>Include the expression to validate URLs before they are passed to the EventSource constructor.</strong> For example, the following code validates the <tt>sourceUrl</tt> variable to make sure it is valid before using it:   <br><tt> if (pattern.test(sourceUrl)) </tt></li>
<li> <strong>Test the expression thoroughly to make sure only relative URLs are allowed.</strong> Perform thorough testing using both positive and negative conditions to verify the functionality.</li>
</ol><h2>Server-sent Events Guideline</h2><ul><li> <a href="00000000-0000-0000-0000-00000069528c">Validate URLs Passed to the EventSource Constructor</a></li>
</ul><h2>Server-sent Events Checklist Item</h2><ul><li> <a href="00000000-0000-0000-0000-000000010f15">URLs Passed to the EventSource Constructor are Validated</a></li></ul>