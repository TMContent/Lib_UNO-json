<h2>What to Check For</h2><p>Verify that stored sensitive data is encrypted.
</p><h2>Why</h2><p>Sensitive data at rest should be encrypted to make it difficult for an attacker to recover this data in the event that the device is stolen or compromised.
</p><h2>How to Check</h2><p>To verify that stored sensitive data is encrypted:
</p><ol>
<li> <strong>Identify sensitive data.</strong> Make a list of types of sensitive information handled by your application. Some examples are.</li>
<li> <strong>Determine if sensitive data needs to be stored.</strong> For each type of sensitive data, determine whether it needs to be stored at all. Do not store sensitive data unless it is absolutely necessary. For data that needs to be stored, make a list of the locations where it is stored and which functions access each piece of sensitive data.</li>
<li> <strong>Review encryption requirements for sensitive data that is stored in files.</strong> Determine the level of protection that is the most appropriate for each type of sensitive data handled by the application that is stored in files.</li>
<li> <strong>Verify that stored sensitive data is encrypted.</strong> Examine the code that is responsible for storing each type of data that needs to be encrypted to make sure that it satisfies the defined encryption requirements.</li>
</ol><h2>How to Fix</h2><p>To encrypt stored sensitive data:
</p><ol>
<li> <strong>Identify sensitive data.</strong> Make a list of types of sensitive information handled by your application. Some examples are.</li>
<li> <strong>Determine if sensitive data needs to be stored.</strong> For each type of sensitive data, determine whether it needs to be stored at all. Do not store sensitive data unless it is absolutely necessary. For data that needs to be stored, make a list of the locations where it is stored and which functions access each piece of sensitive data.</li>
<li> <strong>Add an encryption subsystem to your application.</strong> Implement a centralized set of encryption functions to be used by your application. A centralized encryption subsystem is simpler to manage and to implement correctly than ad hoc code spread out throughout the application. The encryption system should provide encryption and decryption functions; functions for managing the encryption keys might also be useful.</li>
<li> <strong>Use the <em>Cipher</em> class for encryption.</strong> The Android SDK includes the <em>Cipher</em> class, which provides access to industry standard cryptographic algorithms.</li>
<li> <strong>Use a strong encryption algorithm and mode.</strong> Use the <em>getInstance</em> method of the <em>Cipher</em> class to specify an encryption algorithm and mode. One recommended algorithm and mode is <em>"AES/CBC/PKCS5Padding"</em>. </li>
<li> <strong>Use strong encryption keys.</strong> Make sure to use strong encryption keys when protecting sensitive data. The most important factor in encryption key strength is length. The recommended length of encryption keys for the AES algorithm is 256-bit. Pass the key as a byte array to the constructor of the <em>SecretKeySpec</em> class to get a <em>SecretKeySpec</em> object that can be used with the <em>Cipher</em> for encryption or decryption. The key may be generated by using the <em>KeyGenerator</em> class.</li>
<li> <strong>Explicitly specify character encoding.</strong> Make sure to explicitly specify the character encoding when encrypting and decrypting data by using the <em>Charset.forName</em> method.</li>
<li> <strong>Use <em>CipherOutputStream</em> and <em>CipherInputStream</em> classes to access encrypted streams.</strong> The <em>CipherOutputStream</em> and <em>CipherInputStream</em> classes provide cryptographic wrappers for stream objects - this might be simpler to use for cryptographic I/O than using the <em>Cipher</em> class directly for each byte.</li>
<li> <strong>Use your application's encryption subsystem to encrypt stored sensitive data.</strong> Once your encryption subsystem has been defined, use it to protect all files that store sensitive data. Encryption functions need to be called whenever sensitive data is stored and decryption functions need to be called whenever sensitive data is loaded.</li>
</ol>
<h2>Additional Resources</h2><ul><li> For more information about the <em>Cipher</em> class, see <a href="http://developer.android.com/reference/javax/crypto/Cipher.html">http://developer.android.com/reference/javax/crypto/Cipher.html</a></li>
<li> For more information about the <em>CipherOutputStream</em> class, see <a href="http://developer.android.com/reference/javax/crypto/CipherOutputStream.html">http://developer.android.com/reference/javax/crypto/CipherOutputStream.html</a></li>
<li> For more information about the <em>CipherInputStream</em> class, see <a href="http://developer.android.com/reference/javax/crypto/CipherInputStream.html">http://developer.android.com/reference/javax/crypto/CipherInputStream.html</a></li>
<li> For more information about the <em>KeyGenerator</em> class, see <a href="http://developer.android.com/reference/javax/crypto/KeyGenerator.html">http://developer.android.com/reference/javax/crypto/KeyGenerator.html</a></li>
<li> For an encryption code example, please see <a href="http://www.java2s.com/Code/Java/Security/EncryptionanddecryptionwithAESECBPKCS7Padding.htm">http://www.java2s.com/Code/Java/Security/EncryptionanddecryptionwithAESECBPKCS7Padding.htm</a></li>
</ul>