<h2>Applies To</h2><ul><li> Java</li>
</ul><h2>What to Check For</h2><p>Make sure that <em>ProcessBuilder</em> is used to execute external commands instead of <em>Runtime.exec()</em>. Verify that user data passed to external processes is validated.
</p><h2>Why</h2><p>Command injection vulnerabilities typically occur when user data is used to spawn external processes. Usually, the developers don't want the users to be able to choose which external commands are executed. The most effective way to enforce which external process is executed is to use parameterized APIs to call it. This doesn't work is the external process, which is being called, is able to spawn another process based on parameters passed to it. For example, if <em>cmd.exe</em> or <em>bash</em> is used as an external process, an attacker can pass data to it to call any command - this is a command injection vulnerability.
</p><h2>How to Check</h2><p>To make sure that <em>ProcessBuilder</em> is used to execute external commands:
</p><ol>
<li> <strong>Find all code that executes external commands.</strong> Search the application code for the following keywords to find all code that executes external commands: <em>getRuntime</em>, <em>exec</em>, <em>start</em>, <em>ProcessBuilder</em>.</li>
<li> <strong>Avoid using external processes.</strong> Review each case where an external process is called to make sure it is absolutely necessary. Command injection vulnerabilities are very dangerous, so calling external processes should be avoided as much as possible to reduce the risk of such vulnerabilities. Replace code that calls external processes with Java code that does the same thing, if possible.</li>
<li> <strong>Verify that <em>ProcessBuilder</em> is used to execute external commands.</strong> Check all code that executes external processes to make sure that <em>ProcessBuilder</em> is used to execute external processes. Make sure that <em>Runtime.exec()</em> is not used to execute external commands.</li>
<li> <strong>Verify that user data passed to external commands is validated.</strong> Verify that any user data that is passed to external processes as arguments via <em>ProcessBuilder</em> is first validated using positive validation routines.</li>
</ol><h2>How to Fix</h2><p>To use <em>ProcessBuilder</em> to execute external commands:
</p><ol>
<li> <strong>Find all code that executes external commands.</strong> Search the application code for the following keywords to find all code that executes external commands: <em>getRuntime</em>, <em>exec</em>, <em>start</em>, <em>ProcessBuilder</em>.</li>
<li> <strong>Avoid using external processes.</strong> Review each case where an external process is called to make sure it is absolutely necessary. Command injection vulnerabilities are very dangerous, so calling external processes should be avoided as much as possible to reduce the risk of such vulnerabilities. Replace code that calls external processes with Java code that does the same thing, if possible.</li>
<li> <strong>Don't let the user choose the external application.</strong> This should go without saying, but the user should not be able to choose the external process which is being executed. If this is absolutely necessary, it might be an option for an administrative user, and then this functionality should be protected with access controls and ideally not exposed to the Internet. Allowing the user to choose which external command to execute is essentially the definition of a command injection vulnerability.</li>
<li> <strong>Use parameterized APIs.</strong> <em>ProcessBuilder</em> is the parameterized API for calling external commands in Java. Replace all code that uses <em>Runtime.exec()</em> with code that uses <em>ProcessBuilder</em>. Avoid calling processes that can spawn other processes based on parameters passed to them. For example, calling <em>cmd.exe</em> or <em>bash</em> and passing parameters to them essentially negates the use of parameterization, because shell interpreters can spawn other processes based on parameters passed to them. </li>
<li> <strong>Validate user data passed to external commands.</strong> Use positive input validation on data passed to external commands. </li>
</ol>
