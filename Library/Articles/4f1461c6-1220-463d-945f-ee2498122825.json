{
  "TeamMentor_Article": {
    "$": {
      "Metadata_Hash": "0",
      "Content_Hash": "0"
    },
    "Metadata": [
      {
        "Id": [
          "4f1461c6-1220-463d-945f-ee2498122825"
        ],
        "Id_History": [
          "4f1461c6-1220-463d-945f-ee2498122825,1150ae9f-43c0-4577-a22b-0965ca373332,"
        ],
        "Library_Id": [
          "c037d0d2-0617-44f3-b846-21dc3d02c4f8"
        ],
        "Title": [
          "Names of Uploaded Files Are Scrambled"
        ],
        "Category": [
          "File I/O"
        ],
        "Phase": [
          "Implementation"
        ],
        "Technology": [
          "PHP"
        ],
        "Type": [
          "Checklist Item"
        ],
        "DirectLink": [
          "Names of Uploaded Files Are Scrambled"
        ],
        "Author": [
          ""
        ],
        "Priority": [
          ""
        ],
        "Status": [
          ""
        ]
      }
    ],
    "Content": [
      {
        "$": {
          "Sanitized": "false",
          "DataType": "wikitext"
        },
        "Data": [
          "==Applies To==\r\n\r\n* PHP\r\n\r\n==What to Check For==\r\n\r\nVerify that names and extensions of uploaded files are scrambled.\r\n\r\n==Why==\r\n\r\nScramble names and extensions of uploaded files to make it more difficult for attackers to upload and execute malicious code. Even if an attacker is able to upload a malicious script, changing its file extension should prevent it from being executed. Changing the name of the file should also make it more difficult for the attacker to create an HTTP request to access the malicious script.\r\n\r\n==How to Check==\r\n\r\nTo verify that names and extensions of uploaded files are scrambled:\r\n\r\n# **Find all code used to upload files.** Search your application code for calls to move_uploaded_files(). Make a spreadsheet that enumerates this code.\r\n# **Review code that is responsible for file uploads.** Examine all code that is responsible for file uploads to make sure that it uses some technique to scramble file names and extensions.\r\n# **Test file uploads.** Make sure that authentication is required for uploading files by issuing HTTP upload requests directly to the script that is responsible for uploading files. Once it's clear that authentication is required for uploading, test the upload functionality using different user roles provided by the application. Check to make sure that the names and extensions of the uploaded files are scrambled.\r\n\r\n==How to Fix==\r\n\r\nTo scramble names and extensions of uploaded files:\r\n\r\n# **Find all code used to upload files.** Search your application code for calls to move_uploaded_files(). Make a spreadsheet that enumerates this code.\r\n# **Add code to maintain an uploaded-file lookup table.** If the original file names need to be preserved, they should be stored in a lookup table, either in a database or in an XML file.\r\n# **Add code to access uploaded files indirectly.** For accessing the uploaded files, use a PHP script to read the specified file and return its contents. This can be used to show uploaded images in the browser or for any other purpose where users need to access the uploaded files. Using a PHP script to return the contents (rather than the web server processing the uploaded files as a result of direct requests) ensures that the uploaded files will not be executed as code.\r\n# **Change code to scramble file names.** Web servers execute PHP files as code based on file extensions. If a file has an extension that is defined as code in the server's configuration, it will be executed. Common PHP file extensions are .php and .php5, but there may be others, depending on the server configuration. Scrambling the file extensions, or even removing them completely, prevents execution. Scrambling the file names also makes it more difficult for the attacker to find the uploaded file(s) and thus makes it harder to create HTTP requests that access those files directly.\r\n"
        ]
      }
    ]
  }
}