{
  "TeamMentor_Article": {
    "$": {
      "Metadata_Hash": "568941921",
      "Content_Hash": "-530372650"
    },
    "Metadata": [
      {
        "Id": [
          "187120b9-70fd-4774-a22e-451ad7dcd344"
        ],
        "Id_History": [
          "187120b9-70fd-4774-a22e-451ad7dcd344,0646db57-9e6c-4b48-b707-1a5841a610ac,"
        ],
        "Library_Id": [
          "be5273b1-d682-4361-99d9-6234f2d47eb7"
        ],
        "Title": [
          "How to Test for DNS Poisoning Bugs"
        ],
        "Category": [
          "Communication Security"
        ],
        "Phase": [
          "Deployment"
        ],
        "Technology": [
          "Technology Independent"
        ],
        "Type": [
          "How To"
        ],
        "DirectLink": [
          "How to Test for DNS Poisoning Bugs"
        ],
        "Tag": [
          ""
        ],
        "Security_Demand": [
          ""
        ],
        "Author": [
          ""
        ],
        "Priority": [
          "1"
        ],
        "Status": [
          ""
        ],
        "Source": [
          "SI"
        ]
      }
    ],
    "Content": [
      {
        "$": {
          "Sanitized": "true",
          "DataType": "Html"
        },
        "Data": [
          "<h1>Applies To</h1>\r\n  <p>\r\n    <ul>\r\n      <li>DNS (Domain Name System) software</li>\r\n    </ul>\r\n  </p>\r\n  <h1>Summary</h1>\r\n  <p>The Domain Name System is implemented heavily across the Internet to resolve domain names (such as <i>www.example.com</i>) to their respective IP address. Internet clients such as web browsers query a collection of DNS servers to resolve domain names, e.g. <i>www.example.com</i>, into an IP addresses, e.g. <i>201.77.100.88</i>.&nbsp; </p>\r\n  <p>During a DNS Poisoning attack an adversary attacks a vulnerable DNS server to replace a valid domain name (e.g. <i>www.example.com</i> with IP <i>201.77.100.88</i>) with the adversary's malicious IP (<i>w.x.y.z</i>). An adversary can also achieve this by executing a Man in the Middle (MitM) style attack between a DNS client and DNS server, and attempt to respond to the client faster than the authentic server. The adversary can then replace the contents of the affected domain name with potentially malicious content of their choosing.&nbsp;</p>\r\n  <p>Follow these steps to test for DNS Poisoning bugs:</p>\r\n  <ul>\r\n    <li>Step 1: Understand Attack Scenarios.</li>\r\n    <li>Step 2: Analyze Root Causes and Mitigations.</li>\r\n    <li>Step 3: Start Testing and Exploring.</li>\r\n    <li>Step 4: Tune Test Cases.</li>\r\n  </ul>\r\n  <h1>Step 1: Understand Attack Scenarios</h1>\r\n  <p>First you must understand the details of DNS Poisoning attacks. The following scenarios illustrate the two common DNS Poisoning attacks:</p>\r\n  <ul>\r\n    <li>DNS poisoning by DNS cache poisoning. </li>\r\n    <li>DNS poisoning by DNS server forgery.</li>\r\n  </ul>\r\n  <h2>DNS poisoning by DNS cache poisoning </h2>\r\n  <p>During a DNS cache poisoning attack, an adversary tampers with a DNS server cache so that the server responds with malicious data to its clients. The adversary's goal is to replace the cache so that certain domain names resolve to an adversary-controlled IP address (<i>w.x.y.z</i>).&nbsp; If the attack is successful, when a client queries the DNS server for a safe domain (say <i>www.example.com</i>), the DNS server directs the client to the adversary's IP address (<i>w.x.y.z</i>).&nbsp; </p>\r\n  <p>In detail:</p>\r\n  <ol>\r\n    <li>The attacker discovers a vulnerable DNS server.</li>\r\n    <li>The attacker forces the DNS server to make a request to a domain controlled by an attacker's nameserver.</li>\r\n    <li>The attacker responds with an empty answer but uses additional sections in the response to cache additional records in the DNS server cache.</li>\r\n  </ol>\r\n  <h2>DNS poisoning by DNS server forgery</h2>\r\n  <p>A variant of DNS Poisoning, known as DNS Forgery, consists of intruding upon the target network to impersonate a real DNS server, and then trying to beat the DNS server's real answer to a client request with an alternate answer of the adversary's choosing. The alternate response must, however, contain a valid request id from the original DNS server (built from a 16-bit nonce). By sending multiple simultaneous requests to the original server, the adversary can execute a modification of the birthday attack in order to predict a valid request <i>id </i>in a reasonable amount of time.</p>\r\n  <p>In detail:</p>\r\n  <ol>\r\n    <li>The attacker executes Man in the Middle attack between a DNS server and a DNS client.</li>\r\n    <li>The attacker waits for the client to make a DNS request.</li>\r\n    <li>The attacker intercepts the DNS request.</li>\r\n    <li>The attacker starts a birthday attack to try to predict a valid DNS response nonce for the request.</li>\r\n    <li>The attacker sends back a valid DNS response to the client with a malicious IP address for the requested domain name.</li>\r\n  </ol>\r\n  <h1>Step 2: Analyze Root Causes and Mitigations</h1>\r\n  <p>During this step you must understand what causes DNS poisoning. Once you understand the root causes, you can identify mitigations both in design and implementation. With this information you can review the application's architecture and source code; and then recognize both safe and unsafe practices.</p>\r\n  <h2>DNS Poisoning Root Cause</h2>\r\n  <p>The principal cause for DNS Poisoning bugs is that DNS servers are too trustful of DNS responses. This allows malicious DNS nodes (such as spoofed DNS servers) to replace valid DNS nodes. When these malicious nodes are recognized as valid, they can send malicious responses to DNS servers or attempt to reply faster to DNS clients.</p>\r\n  <h2>DNS Poisoning Mitigations</h2>\r\n  <p>The principal mitigation for this bug is for both DNS servers and clients to be less trusting of DNS responses.&nbsp;<a style=\"mso-comment-reference: A_2; mso-comment-date: 20080402T1025\"></a><a style=\"mso-comment-reference: IG_1; mso-comment-date: 20080401T2106\">A possible way to achieve this is to add a additional layer of security, such as randomly selecting a source port</a>, to the existing 16-bit nonce to decrease the chances of race attacks such as the birthday attack.</p>\r\n  <p>Another mitigation consists of using digital signatures to authenticate DNS nodes. A possible implementation is via digital certificates that are used during authentication of DNS data to ensure that this data comes from a trusted source. Therefore, an application can check for verify the authenticity of DNS messages using signatures over a reputable and secure method such as Secure Sockets Layer (SSL) or Transport Layer Security (TLS).</p>\r\n  <p>A secure version of DNS named DNSSEC also uses cryptographic certificates to validate DNS packets.&nbsp;&nbsp; Although this mitigation against DNS poisoning attacks is ideal; recent survey results indicate that DNSSEC is far from being widely deployed.</p>\r\n  <p>However, there are interim solutions until DNSSEC is widely used on the Internet, such as running the latest BIND version along with anti-DNS forgery firewall rules or running OpenDNS, which randomizes the ports to add an additional layer of security to prevent against forgery attacks.</p>\r\n  <p>If you have access to the DNS application's source code or design specifications, at the end of this step you should be able to determine if your application is vulnerable by design or if it implements any of the DNS forgery mitigation techniques mentioned above.&nbsp;</p>\r\n  <h1>Step 3: Start Testing and Exploring</h1>\r\n  <p>Now that you know what DNS poisoning attacks look like and how to protect against them, you must test for both secure and insecure implementations.</p>\r\n  <h2>Testing a DNS server against DNS cache poisoning</h2>\r\n  <ol>\r\n    <li>Select the target DNS server.</li>\r\n    <li>Set up a web client (browser) to uses the target DNS server.</li>\r\n    <li>Set up an adverse/attacker controlled DNS server (it will send specially crafted responses - see step 6).</li>\r\n    <li>Set up an adverse/attacker controlled web server. </li>\r\n    <li>Set up a trigger that starts a DNS lookup query from within the target DNS server to the adverse DNS sever.&nbsp; </li>\r\n    <li>Use the adverse DNS server to reply to the query with extra information in the DNS packets. Set the Answers, Authoritative nameservers, and Additional records fields of the DNS packets to direct all futures requests to a .com&nbsp;domain to resolve to the IP address of the adversary web server (from step 4).&nbsp; </li>\r\n    <li>Open the web browser from step 2 and navigate to any .com domain.&nbsp;</li>\r\n  </ol>\r\n  <p>Expected Result: If the test fails, the web browser displays the content from the adversary's web server for any .com domain entered in the web browser. If the intended website loads, rather than the adversary's content, then this test has passed.</p>\r\n  <h2>Testing a DNS server against DNS Forgery</h2>\r\n  <ol>\r\n    <li>Select the target DNS server.</li>\r\n    <li>Set up a web client (browser) to uses the target DNS resolver.</li>\r\n    <li>Set up an adverse/attacker controlled DNS server.</li>\r\n    <li>Set up an adverse/attacker controlled web server.</li>\r\n    <li>Execute Man-in-the-Middle attack and intercept a DNS request from the client to the server.</li>\r\n    <li>Start a DNS birthday attack [v] against the server to predict a valid DNS request ID.</li>\r\n    <li>Send a response to the client with a valid request ID but mapping all .com domains to the IP address of the adverse web server (from step 4).</li>\r\n    <li>Open the web browser from step 2 and navigate to any .com domain.</li>\r\n  </ol>\r\n  <p>Expected Result: If the test fails, the web browser displays the content from the adversary's web server for any .com domain entered in the web browser. If the intended website loads, rather than the adversary's content, then this test has passed.&nbsp;&nbsp;</p>\r\n  <h1>Step 4: Tune Test Cases</h1>\r\n  <p>Now that you're done with the basic DNS poisoning tests, let's look at some example attacker controlled DNS responses. </p>\r\n  <p>The following response redirects the victim domain name server (<i>ns.example.com</i>) to the attacker's IP (<i>w.x.y.z</i>):</p>\r\n  <p>\r\n    <font face=\"'Courier New'\">Answer:<br />(no response)<br />Authority section:<br />example.com. 3600 IN NS ns.bankingsite.com.<br />Additional section:<br />ns.teammentorexample.com. IN A w.x.y.z&nbsp;</font>\r\n  </p>\r\n  <p>The following response redirects the Name Server records for the victim site (<i>banking.com</i>) to another target domain (<i>ns.example.com</i>):</p>\r\n  <p>\r\n    <font face=\"'Courier New'\">Answer:<br />(no response)<br />Authority section:<br />teammentorexample.com. 3600 IN NS ns.example.com.<br />Additional section:<br />ns.example.com. IN A w.x.y.z</font>\r\n  </p>\r\n  <p>The following response directs the Name Server records of all .com domains to the attacker's IP:</p>\r\n  <p>\r\n    <font face=\"'Courier New'\">Answer:<br />www.example.com: type A, class inet, addr w.x.y.z<br />Additional records:<br />com: type A, class inet, addr w.x.y.z</font>\r\n  </p>\r\n  <p>These are only a select few variations of DNS cache poisoning attacks. There are different kinds of DNS attack techniques surfacing the Internet on a regular basis. Make sure to keep up to date with the latest testing and prevention methods.</p>\r\n  <h1>Conclusions</h1>\r\n  <p>DNS Poisoning is a serious issue that can have a devastating effect. If you are in charge of deploying and administering DNS servers, then you must make sure that they are not vulnerable to this class of attack. This article describes the two most common DNS poisoning scenarios, what causes them, and how to prevent them. The last two steps guide you in testing for DNS poisoning vulnerabilities present in your current implementation.&nbsp;</p>\r\n  <h1>Additional Resources</h1>\r\n  <p>\r\n    <ul>\r\n      <li>For more information about DNS Cache Poisoning vulnerabilities, see&nbsp;<a href=\"http://en.wikipedia.org/wiki/DNS_cache_poisoning\">http://en.wikipedia.org/wiki/DNS_cache_poisoning</a></li>\r\n    </ul>\r\n  </p>\r\n  <div>\r\n  </div>"
        ]
      }
    ]
  }
}