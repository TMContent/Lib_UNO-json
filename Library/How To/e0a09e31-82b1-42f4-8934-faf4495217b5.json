{
  "TeamMentor_Article": {
    "$": {
      "Metadata_Hash": "928420527",
      "Content_Hash": "-1579561141"
    },
    "Metadata": [
      {
        "Id": [
          "e0a09e31-82b1-42f4-8934-faf4495217b5"
        ],
        "Id_History": [
          "e0a09e31-82b1-42f4-8934-faf4495217b5,15a84cf7-722d-44c0-a049-ea81f71eaa24,"
        ],
        "Library_Id": [
          "26bd1a04-beed-4a66-917d-b6ab0a7d634c"
        ],
        "Title": [
          "Create a Threat Model"
        ],
        "Category": [
          "Security Engineering"
        ],
        "Phase": [
          "Design"
        ],
        "Technology": [
          "Technology Independent"
        ],
        "Type": [
          "How To"
        ],
        "DirectLink": [
          "Create a Threat Model"
        ],
        "Tag": [
          ""
        ],
        "Security_Demand": [
          ""
        ],
        "Author": [
          ""
        ],
        "Priority": [
          ""
        ],
        "Status": [
          ""
        ],
        "Source": [
          "SI"
        ]
      }
    ],
    "Content": [
      {
        "$": {
          "Sanitized": "true",
          "DataType": "Html"
        },
        "Data": [
          "<h1>Summary</h1>\n  <p>This How To describes an approach for creating a threat model for a Web application. The threat modeling activity helps you to model your security design so that you can expose potential security design flaws and vulnerabilities before you invest significant time or resources in a flawed design and/or problems become difficult to reverse. This How To provides prioritized vulnerability categories and a threat list to make the threat modeling activity easier. </p>\n  <h1>Contents</h1>\n  <ul>\n    <li>Objectives </li>\n    <li>Overview </li>\n    <li>Before You Begin </li>\n    <li>Input </li>\n    <li>Output </li>\n    <li>Summary of Steps </li>\n    <li>Step 1: Identify Security Objectives </li>\n    <li>Step 2: Create an Application Overview </li>\n    <li>Step 3: Decompose Your Application </li>\n    <li>Step 4: Identify Threats </li>\n    <li>Step 5: Identify Vulnerabilities </li>\n    <li>What to Do Next&nbsp; </li>\n    <li>Agile Considerations </li>\n    <li>MSF Agile Considerations </li>\n    <li>Additional Resources</li>\n  </ul>\n  <h1>Objectives</h1>\n  <p>By performing the steps in this module, you will: </p>\n  <ul>\n    <li>Identify relevant threats to your particular application scenario. </li>\n    <li>Identify key vulnerabilities in your application design. </li>\n    <li>Improve your security design.</li>\n  </ul>\n  <h1>Overview</h1>\n  <p>Threat modeling is a structured activity for identifying and evaluating application threats and vulnerabilities. This How To presents a question-driven approach to threat modeling that can help you identify security design problems early in the application design process. This approach allows you to quickly create a basic threat model for your application scenario. Then you can use this threat model to help refine your application's design early and for communication among team members. </p>\n  <p>The threat modeling approach presented here focuses on identifying and addressing vulnerabilities. The security objectives, threats, and attacks that you identify in the early steps of the activity are the scoping mechanisms designed to help you find vulnerabilities in your application. You can use the identified vulnerabilities to help shape your design and direct and scope your security testing.</p>\n  <h1>Before You Begin</h1>\n  <p>Use this module to quickly create an effective threat model for your application. When using this module, keep the following in mind: </p>\n  <ol>\n    <li>\n      <p>\n        <b>Do not get blocked on steps or implementation. </b>Focus on the approach. If you do get blocked on a particular step, skip ahead to step 4, \"Identify Threats.\" The primary objective of the activity is to improve security design, not to model for the sake of modeling. </p>\n    </li>\n    <li>\n      <p>\n        <b>Use scenarios to scope the modeling activity.</b> Identify scenarios that are out of scope to help limit your threat modeling activity. What are you not going to talk about? For example, are operational practices out of scope? </p>\n    </li>\n    <li>\n      <p>\n        <b>Use your existing design documents if you have them.</b> Use items such as documented use cases or user stories, data flow diagrams, architecture diagrams, and other design documentation if you have them. </p>\n    </li>\n    <li>\n      <p>\n        <b>Start with a whiteboard.</b> It can be easier to get started by modeling on a whiteboard before you start capturing information in documents or getting lost in details. A helpful technique is to use a digital camera or whiteboard with print capability to document and distribute the information from the whiteboard. </p>\n    </li>\n    <li>\n      <p />\n      <b>Use an iterative approach.</b> Add more detail and evolve your threat model as you continue design and development. Use ongoing modeling to reduce risk and to inform your design decisions. For example, when early in the design process, you may have only basic use cases, an initial deployment topology, and an idea of how you will layer your application. By using an iterative approach, you become familiar with the modeling process and can evolve your threat model to examine \"what if\" scenarios as more information becomes available to you. <p>You might choose to adopt a more formal approach and identify milestones for revisiting your model. What is most important is that you revisit the model when you need to make an engineering decision, as you introduce new levels of risk, and when you contemplate significant design choices. </p></li>\n    <li>\n      <p>\n        <b>Review and use the Template: Web Application Threat Model.</b> Use the companion template while creating your threat model. The template includes exit criteria for each step described in this How To. </p>\n    </li>\n    <li>\n      <b>Adapt the activity for your situation.</b> If you are new to threat modeling, consider reading this document and then reading the companion walkthrough, \"Walkthrough: Creating a Threat Model for a Web Application,\" to become more familiar with the approach. If you have existing applications, you can use the threat and vulnerability identification approaches in steps 4 and 5. With this information, you can determine where to focus your efforts. </li>\n    <li>\n      <p>\n        <b>Obtain input about host and network constraints from your system and network administrators.</b> To be able to draw and understand your end-to-end deployment scenario, you need to have information about the host configuration, firewall policies, allowed protocols and ports, and so on. Obtain this information by talking to your system and network administrators. </p>\n    </li>\n  </ol>\n  <h1>Input</h1>\n  <p>The following input is useful for threat modeling: </p>\n  <ul>\n    <li>Use cases and usage scenarios </li>\n    <li>Data flows </li>\n    <li>Data schemas </li>\n    <li>Deployment diagrams </li>\n  </ul>\n  <p>Although all of these are useful, none of them are essential. However, you do need to have knowledge of your application's primary function and architecture.</p>\n  <h1>Output</h1>\n  <p>The output of the threat modeling activity is a threat model. The main items captured by the threat model include the following: </p>\n  <ul>\n    <li>A list of threats </li>\n    <li>A list of vulnerabilities </li>\n  </ul>\n  <h1>Summary of Steps</h1>\n  <p>The five major threat modeling steps are shown in Figure 1. </p>\n  <p>\n    <img alt=\"\" src=\"http://msdn2.microsoft.com/en-us/library/ms978527.f01tmwa01(en-us,MSDN.10).gif\" border=\"0\" />\n  </p>\n  <p>\n    <b>Figure 1. The iterative threat modeling process</b>\n  </p>\n  <p>These steps are: </p>\n  <ol>\n    <li>\n      <p>\n        <b>Identify security objectives.</b> Clear objectives help you to focus the threat modeling activity and determine how much effort to spend on subsequent steps. </p>\n    </li>\n    <li>\n      <p>\n        <b>Create an application</b>\n        <b>overview. </b>Itemizing your application's important characteristics and actors helps you to identify relevant threats during step 4. </p>\n    </li>\n    <li>\n      <p>\n        <b>Decompose your application.</b> A detailed understanding of the mechanics of your application makes it easier for you to uncover more relevant and more detailed threats. </p>\n    </li>\n    <li>\n      <p>\n        <b>Identify threats. </b>Use details from steps 2 and 3 to identify threats relevant to your application scenario and context. </p>\n    </li>\n    <li>\n      <p>\n        <b>Identify vulnerabilities.</b> Review the layers of your application to identify weaknesses related to your threats. Use vulnerability categories to help you focus on those areas where mistakes are most often made. </p>\n    </li>\n  </ol>\n  <p>You add progressively more detail to your threat model as you move through your application development life cycle and discover more details about your application design. Because key resources identified in threat modeling are also likely to be key resources from a performance and functionality perspective, you can expect to revisit and adjust your model as you balance all of your needs. This is normal and is a valuable outcome of the process.</p>\n  <h1>Step 1: Identify Security Objectives</h1>\n  <p>Security objectives are goals and constraints related to the confidentiality, integrity, and availability of your data and application. They include: </p>\n  <ul>\n    <li>\n      <b>Confidentiality.</b> This includes protecting against unauthorized information disclosure. </li>\n    <li>\n      <b>Integrity.</b> This includes preventing unauthorized information changes. </li>\n    <li>\n      <b>Availability.</b> This includes providing the required services even while under attack. </li>\n  </ul>\n  <p>Security-specific objectives are a subset of project objectives, and you should use them to guide your threat modeling efforts. You may find it helpful to think of security objectives in terms of constraints. Consider the question, \"What do you <i>not</i> want to happen?\" For example, an attacker must not be able to steal user credentials. </p>\n  <p>By identifying your key security objectives, you can determine where to focus your efforts. Identifying your objectives also helps you to understand the goals of potential attackers and concentrate on those areas of your application that require closer attention. For example, if you identify customer account details as sensitive data that needs protecting, you can examine how securely the data is stored and how access to the data is controlled and audited.</p>\n  <p>To determine your security objectives, consider the following questions: </p>\n  <ul>\n    <li>\n      <b>What client data do you need to protect?</b> For example, does your application use user accounts and passwords, customer account details including personalization information, financial history and transaction records, customer credit card numbers, bank details, or travel itineraries? </li>\n    <li>\n      <b>Do you have compliance requirements?</b> Compliance requirements may include security policy, privacy laws, regulations, and standards. </li>\n    <li>\n      <b>Do you have specific quality of service requirements? </b>Quality of service requirements include availability and performance requirements. </li>\n    <li>\n      <b>Are there intangible assets that you need to protect?</b> Intangible items include your company's reputation, trade secrets, and intellectual property. </li>\n  </ul>\n  <p>The following are examples of some common security objectives: </p>\n  <ul>\n    <li>Prevent attackers from obtaining sensitive customer data, including passwords and profile information. </li>\n    <li>Meet service-level agreements for application availability. </li>\n    <li>Protect the company's online business credibility. </li>\n  </ul>\n  <h1>Step 2: Create an Application Overview</h1>\n  <p>In this step, you outline what your Web application does. Your goal is to identify your application's key functionality, characteristics, and clients. This will help you to identify relevant threats during step 4.</p>\n  <blockquote>\n    <b>Note</b>&nbsp;&nbsp;&nbsp;Remember that threat modeling is an iterative process. Do not let this step block your progress. Identify as much detail as you can and then add more detail as your design evolves. For example, if you are in the middle of your design and have not tackled physical deployment, you can still perform this step, although with less data. Itemize what you can as soon as you can.</blockquote>\n  <p>To create an application overview: </p>\n  <ul>\n    <li>\n      <b>Draw the end-to-end deployment scenario.</b>\n    </li>\n    <li>\n      <b>Identify roles</b>. </li>\n    <li>\n      <b>Identify key usage scenarios</b>. </li>\n    <li>\n      <b>Identify technologies</b>. </li>\n    <li>\n      <b>Identify application security mechanisms</b>. </li>\n  </ul>\n  <p>The next sections describe each of these.</p>\n  <h2>Draw the End-to-End Deployment Scenario</h2>\n  <p>Use a whiteboard to draw the end-to-end deployment scenario. First, draw a rough diagram that describes the composition and structure of your application, its subsystems, and its deployment characteristics. Add details about the authentication, authorization, and communication mechanisms as you discover them. Remember that you may not have all of the details early in the design process.</p>\n  <p>Figure 2 is an example of an initial whiteboard diagram that shows the application architecture with some details.</p>\n  <p>\n    <img alt=\"\" src=\"http://msdn2.microsoft.com/en-us/library/ms978527.f01tmwa02(en-us,MSDN.10).gif\" border=\"0\" />\n  </p>\n  <p>\n    <b>Figure 2. Example whiteboard drawing depicting an application architecture</b>\n  </p>\n  <p>Your deployment diagram should generally include the following: </p>\n  <ul>\n    <li>\n      <b>End-to-end deployment topology. </b>Show the layout of the servers and indicate intranet, extranet, or Internet access. Start with logical network topologies, and then refine this to show physical topologies when you have those details. You can add or remove threats depending on your choice of specific physical topologies. </li>\n    <li>\n      <b>Logical layers.</b> Show where the presentation layer, business layer, and data access layers reside. Refine this to include physical server boundaries when you know them. </li>\n    <li>\n      <b>Key components. </b>Show the important components within each logical layer. Refine this to include actual process and component boundaries when you know them. </li>\n    <li>\n      <b>Key services.</b> Identify any important services. Show these as processes when you know them. </li>\n    <li>\n      <b>Communication ports and protocols. </b>Show which servers, components, and services communicate with each other and how they do it. Show the specifics of inbound and outbound information packages when you know them. </li>\n    <li>\n      <b>Identities.</b> Show the main identities used for the application and any relevant service accounts if you have this information. </li>\n    <li>\n      <b>External dependencies.</b> Show the dependencies that your application has on external systems. Later in the modeling process, this will help you identify vulnerabilities that can arise if any assumptions you make about the external systems are false or if the external systems change in any way. </li>\n  </ul>\n  <blockquote>\n    <b>Note</b>&nbsp;&nbsp;&nbsp;As your design evolves, you should regularly revisit the threat model to add more detail. For example, you might not know all of the components initially. Subdivide your application as necessary to get enough detail to find your threats.</blockquote>\n  <h2>Identify Roles</h2>\n  <p>Identify your application's roles: that is, identify who can do what within your application. What can your users do? What higher-privileged groups of users do you have? For example, who can read data, who can update data, who can delete data? </p>\n  <p>Use role identification to determine both what is supposed to happen and what is not supposed to happen.</p>\n  <h2>Identify Key Usage Scenarios</h2>\n  <p>What are the important features of your application? What does it do? Use your application's use cases to derive this information. Identify the dominant application functionality and usage, and capture the Create, Read, Update, and Delete aspects. </p>\n  <p>Key features are often explained in the context of use cases. They can help you and others to understand how your application is intended to be used and how it can be misused. Use cases help you identify data flows and provide focus when you identify threats later in the modeling process.</p>\n  <p>Avoid attempting to list every possible use case. Instead, start by identifying the main use cases that exercise the predominant Create, Read, Update, and Delete functionality of your application. For example, a self-service, employee human resources application might include the following use cases: </p>\n  <ul>\n    <li>Employee views financial data. </li>\n    <li>Employee updates personal data. </li>\n    <li>Manager views employee details. </li>\n    <li>Manager deletes employee records. </li>\n  </ul>\n  <p>In these cases, you can look at the possibilities of the business rules being misused. For example, consider a user trying to modify personal details of another user. You often need to consider several use cases happening simultaneously to perform a complete analysis. </p>\n  <p>Also identify what scenarios are out of scope, and use your key scenarios to constrain the discussion. For example, you might decide that operational practices, such as backup and restore, are out of scope for the initial threat modeling exercise.</p>\n  <h2>Identify Technologies</h2>\n  <p>Where you can identify them, list the technologies and key features of the software and technologies that you use. Identify the following: </p>\n  <ul>\n    <li>Operating systems </li>\n    <li>Web server software </li>\n    <li>Database server software </li>\n    <li>Technologies used in the presentation, business, and data access layers </li>\n    <li>Development languages </li>\n  </ul>\n  <p>Identifying technologies helps you to focus on technology-specific threats later in the threat modeling activity. It also helps you determine the correct and most appropriate mitigation techniques. </p>\n  <h2>Identify Application Security Mechanisms</h2>\n  <p>Identify any key points that you know about the following: </p>\n  <ul>\n    <li>Input and data validation </li>\n    <li>Authentication </li>\n    <li>Authorization </li>\n    <li>Configuration management </li>\n    <li>Sensitive data </li>\n    <li>Session management </li>\n    <li>Cryptography </li>\n    <li>Parameter manipulation </li>\n    <li>Exception management </li>\n    <li>Auditing and logging </li>\n  </ul>\n  <p>The purpose of this effort is to identify interesting details and be able to add detail where necessary, or to identify where you might need to learn more.</p>\n  <p>For example, you might know how your application is authenticated by the database or how your users are authorized. You might know the other areas where your application performs authentication and authorization. You might also know certain details about how input validation is to be performed. Highlight these and other key elements of your application security mechanisms.</p>\n  <h1>Step 3: Decompose Your Application</h1>\n  <p>In this step, you break down your application to identify trust boundaries, data flows, entry points, and exit points. The more you know about the mechanics of your application, the easier it is to uncover threats and discover vulnerabilities. To decompose your application: </p>\n  <ul>\n    <li>\n      <b>Identify trust boundaries.</b>\n    </li>\n    <li>\n      <b>Identify data flows.</b>\n    </li>\n    <li>\n      <b>Identify entry points.</b>\n    </li>\n    <li>\n      <b>Identify exit points.</b>\n    </li>\n  </ul>\n  <p>The next sections describe each of these.</p>\n  <h2>Identify Trust Boundaries</h2>\n  <p>Identify your application's trust boundaries to help focus your analysis on areas of concern. Trust boundaries indicate where trust levels change. You can think of trust from the perspective of confidentiality and integrity. For example, a change in access control levels in your application where a specific role or privilege level is required to access a resource or operation would be a change in trust level. Another example would be at an entry point in your application where you might not fully trust the data passed to the entry point.</p>\n  <p>To help identify trust boundaries: </p>\n  <ul>\n    <li>Start by identifying your outer system boundaries. For example, your application can write to files on server X, it can make calls to the database on server Y, and it can call Web service Z. This defines your system boundary. </li>\n    <li>Identify access control points or the key places where access requires additional privileges or role membership. For example, a particular page might be restricted to managers. The page requires authenticated access and also requires that the caller is a member of a particular role. </li>\n    <li>Identify trust boundaries from a data flow perspective. For each subsystem, consider whether the upstream data flow or user input is trusted, and if it is not, consider how the data flow and input can be authenticated and authorized. Knowing which entry points exist between trust boundaries allows you to focus your threat identification on these key entry points. For example, you are likely to have to perform more validation on data passed through an entry point at a trust boundary. </li>\n  </ul>\n  <p>Some example trust boundaries are: </p>\n  <ul>\n    <li>A perimeter firewall. The firewall is likely to be the first trust boundary. It moves qualified information from the untrusted Internet to your trusted data center. </li>\n    <li>The boundary between the Web server and database server. Your database may or may not be included in your application's trust boundary. Often the Web servers act as a second firewall to the databases. This significantly limits network access to the databases and thereby reduces the attack surface. Describe the network topology within your data center. Do any other applications write to the database? If they do, do you trust those applications? If you trust the applications that write to the database, you may still not want to trust the databaseâ€”is it protected? </li>\n    <li>The entry point into a business component that exposes privileged data (data that should be available to only particular users). In this case, you need an access check to ensure that only the appropriate callers are allowed access. This is a trust boundary. </li>\n    <li>The boundary between your application and a third-party service. Do you trust the service's identity? Can you trust the data returned from the service? </li>\n  </ul>\n  <h2>Identify Data Flows</h2>\n  <p>Trace your application's data input through the application from entry to exit. You do this to understand how your application interacts with external systems and clients and how internal components interact. Pay particular attention to data flow across trust boundaries and how that data is validated at the trust boundary entry point. Also pay close attention to sensitive data items and how these flow through your system, where they are passed over a network, and where they are persisted.</p>\n  <p>A good approach is to start at the highest level and then deconstruct the application by analyzing the data flow between individual subsystems. For example, start by analyzing the data flow between your Web application, your middle tier servers, and your database server. Then consider page-to-page and component-to-component data flows. </p>\n  <h2>Identify Entry Points</h2>\n  <p>The entry points of your application also serve as entry points for attacks. Entry points can include the front-end Web application listening for HTTP requests. This entry point is intended to be exposed to clients. Other entry points, such as internal entry points exposed by subcomponents across the layers of your application, may exist only to support internal communication with other components. However, you should know where these are and what types of input they receive in case an attacker manages to bypass the front door of the application and directly attack an internal entry point. Additional levels of checking provides defense in depth but may be costly in terms of money and performance.</p>\n  <p>Consider the trust levels required to access an entry point and the type of functionality exposed by the entry point. Early in the threat modeling activity, focus your attention on entry points that expose privileged functionality, such as administration interfaces.</p>\n  <h2>Identify Exit Points</h2>\n  <p>Identify the points where your application sends data to the client or to external systems. Prioritize the exit points where your application writes data that includes client input or includes data from untrusted sources, such as shared databases. </p>\n  <h1>Step 4: Identify Threats</h1>\n  <p>In this step, you identify threats and attacks that might affect your application and compromise your security objectives. These threats are the bad effects that could happen to your application. To conduct this identification process, bring members of the development and test teams together to conduct an informed brainstorming session. Use a whiteboard to identify potential threats. Ideally, the team consists of application architects, security professionals, developers, testers, and system administrators.</p>\n  <p>You can use two basic approaches: </p>\n  <ul>\n    <li>\n      <b>Start with common threats and attacks.</b> With this approach, you start with a list of common threats grouped by application vulnerability categories. Next, apply the threat list to your own application architecture. While doing this, use the data you gathered. For example, use the identified scenarios to review data flows, paying particular attention to entry points and where trust boundaries are crossed. You will be able to eliminate some threats immediately because they do not apply to your application and its use cases. Use the \"Cheat Sheet: Web Application Security Frame\" as a starting point. </li>\n    <li>\n      <b>Use a question-driven approach.</b> A question-driven approach can help you identify relevant threats and attacks. The STRIDE categorization includes broad categories of threats, such as spoofing, tampering, repudiation, information disclosure, and denial of service. You can use the STRIDE model to ask questions related to each aspect of the architecture and design of your application. This is a goal-based approach, where you consider the goals of an attacker. For example, could an attacker spoof an identity to access your server or Web application? Could someone tamper with data over the network or in a data store? Is sensitive information disclosed when you report an error message or log an event? Could someone deny service? </li>\n  </ul>\n  <p>While identifying threats, examine the application tier by tier, layer by layer, and feature by feature. By focusing on vulnerability categories, you focus on the areas where security mistakes are most frequently made. The threats identified at this stage do not necessarily indicate vulnerabilities. Identify potential threats and the actions that an attacker might try to use to exploit the application.</p>\n  <p>During this step, you perform the following tasks: </p>\n  <ul>\n    <li>\n      <b>Identify common threats and attacks.</b>\n    </li>\n    <li>\n      <b>Identify threats along use cases.</b>\n    </li>\n    <li>\n      <b>Identify threats along data flows. </b>\n    </li>\n  </ul>\n  <p>The next sections describe each of these.</p>\n  <h2>Identify Common Threats and Attacks</h2>\n  <p>There are a number of common threats and attacks that rely on common vulnerabilities. As a starting point, use the companion document, \"Cheat Sheet: Web Application Security Frame.\" The cheat sheet will help you identify threats and attacks relevant to your application. </p>\n  <h3>Web Application Security Frame</h3>\n  <p>The following vulnerability categories were developed by security experts who have examined and analyzed the top security issues across many Web applications. They have been refined with input from Microsoft consultants, product support engineers, customers, and Microsoft partners. This section identifies a set of key questions to ask for each category.</p>\n  <h3>Authentication</h3>\n  <p>Review authentication by asking the following: </p>\n  <ul>\n    <li>How could an attacker spoof identity? </li>\n    <li>How could an attacker gain access to the credential store? </li>\n    <li>How could an attacker mount a dictionary attack? How are your user's credentials stored and what password policies are enforced? </li>\n    <li>How can an attacker modify, intercept, or bypass your user's credential reset mechanism? </li>\n  </ul>\n  <h3>Authorization</h3>\n  <p>Review authorization by asking the following: </p>\n  <ul>\n    <li>How could an attacker influence authorization checks to gain access to privileged operations? </li>\n    <li>How could an attacker elevate privileges? </li>\n  </ul>\n  <h3>Input and Data Validation</h3>\n  <ul>\n    <li>Review input and data validation by asking the following: </li>\n    <li>How could an attacker inject SQL commands? </li>\n    <li>How could an attacker perform a cross-site scripting attack? </li>\n    <li>How could an attacker bypass input validation? </li>\n    <li>How could an attacker send invalid input to influence security logic on the server? </li>\n    <li>How could an attacker send malformed input to crash the application? </li>\n  </ul>\n  <h3>Configuration Management</h3>\n  <p>Review configuration management by asking the following: </p>\n  <ul>\n    <li>How could an attacker gain access to administration functionality? </li>\n    <li>How could an attacker gain access to your application's configuration data? </li>\n  </ul>\n  <h3>Sensitive Data</h3>\n  <p>Review sensitive data by asking the following: </p>\n  <ul>\n    <li>Where and how does your application store sensitive data? </li>\n    <li>When and where is sensitive data passed across a network? </li>\n    <li>How could an attacker view sensitive data? </li>\n    <li>How could an attacker manipulate sensitive data? </li>\n  </ul>\n  <h3>Session Management</h3>\n  <p>Review session management by asking the following: </p>\n  <ul>\n    <li>Do you use a custom encryption algorithm, and do you trust the algorithm? </li>\n    <li>How could an attacker hijack a session? </li>\n    <li>How could an attacker view or manipulate another user's session state? </li>\n  </ul>\n  <h3>Cryptography</h3>\n  <p>Review cryptography by asking the following: </p>\n  <ul>\n    <li>What would it take for an attacker to crack your encryption? </li>\n    <li>How could an attacker obtain access to encryption keys? </li>\n    <li>Which cryptographic standards are you using? What, if any, are the known attacks on these standards? </li>\n    <li>Are you creating your own cryptography? </li>\n    <li>How does your deployment topology potentially impact your choice of encryption methods? </li>\n  </ul>\n  <h3>Parameter Manipulation</h3>\n  <p>Review parameter manipulation by asking the following: </p>\n  <ul>\n    <li>How could an attacker manipulate parameters to influence security logic on the server? </li>\n    <li>How could an attacker manipulate sensitive parameter data? </li>\n  </ul>\n  <h3>Exception Management</h3>\n  <p>Review exception management by asking the following: </p>\n  <ul>\n    <li>How could an attacker crash the application? </li>\n    <li>How could an attacker gain useful exception details? </li>\n  </ul>\n  <h3>Auditing and Logging</h3>\n  <p>Review auditing and logging by asking the following: </p>\n  <ul>\n    <li>How could an attacker cover his or her tracks? </li>\n    <li>How can you prove that an attacker (or legitimate user) performed specific actions? </li>\n  </ul>\n  <h2>Identify Threats Along Use Cases</h2>\n  <p>Examine each of your application's key use cases that you identified earlier, and examine ways in which a user could maliciously or unintentionally coerce the application into performing an unauthorized operation or into disclosing sensitive or private data.</p>\n  <p>Ask questions and try to think as an attacker would. Examples of the types of question you should ask include the following: </p>\n  <ul>\n    <li>How can a client inject malicious input here? </li>\n    <li>Is data being written out based on user input or on unvalidated user input? </li>\n    <li>How could an attacker manipulate session data? </li>\n    <li>How could an attacker obtain sensitive data as it is passed over the network? </li>\n    <li>How could an attacker bypass your authorization checks? </li>\n  </ul>\n  <h2>Identify Threats Along Data Flows</h2>\n  <p>Review the key use cases and scenarios, and analyze the data flows. Analyze the data flow between individual components in your architecture. Data flow across trust boundaries is particularly important. A piece of code should assume that any data from outside the code's trust boundary is malicious. The code should perform thorough validation of the data. </p>\n  <p>When identifying threats associated with data flows, ask the following questions: </p>\n  <ul>\n    <li>How does data flow from the front end to the back end of your application? </li>\n    <li>Which components call which components? </li>\n    <li>What does valid data look like? </li>\n    <li>Where is validation performed? </li>\n    <li>How is the data constrained? </li>\n    <li>How is data validated against expected length, range, format, and type? </li>\n    <li>What sensitive data is passed between components and across networks, and how is that data secured while in transit? </li>\n  </ul>\n  <blockquote>\n    <b>Note</b>&nbsp;&nbsp;&nbsp;Use existing documentation if you have it. For example, data flow diagrams (DFDs) and Unified Modeling Language (UML) sequence diagrams can help you to analyze your application and identify data flows.</blockquote>\n  <h2>Explore Additional Threats by Using Threat/Attack Trees</h2>\n  <p>The previous activities have helped you to identify the more obvious and pervasive security issues. You can now explore additional threats and attacks. (It is helpful to set a time limit so that you do not become blocked by this activity.)</p>\n  <p>Attack trees and attack patterns are the primary tools that many security professionals use. They allow you to analyze threats in greater depth, going beyond what you already know to identify other threat possibilities.</p>\n  <p>The categorized lists of known threats only reveal the common, known threats. Additional approaches, such as using threat/attack trees and attack patterns, can help you identify other potential threats.</p>\n  <p>An attack tree is a way of identifying and documenting the potential attacks on your system in a structured and hierarchical manner. The tree structure gives you a detailed picture of various attacks that the attacker uses to compromise the system. By creating attack trees, you create a reusable representation of security issues that will help to focus your threat and mitigation efforts. Your test team can use the trees to create test plans that validate security design. Architects or developer leads can use the trees to evaluate the security cost of alternative approaches. Developers can use the trees to make informed coding decisions during implementation.</p>\n  <p>Attack patterns are a formalized approach to capturing attack information in your enterprise. These patterns can help you identify common attack techniques.</p>\n  <h3>Creating Attack Trees</h3>\n  <p>When creating an attack tree, assume the role of the attacker. Consider what you must do to launch a successful attack and identify goals and sub-goals of the attack. You can use a hierarchical diagram to represent your attack tree, or you can use a simple outline. What is important is that you construct something that portrays the attack profile of your application. Then you can evaluate security risks and use the appropriate countermeasures to mitigate them, such as correcting a design approach, hardening a configuration setting, and other solutions.</p>\n  <p>Start building an attack tree by creating root nodes that represent the goals of the attacker. Then add the leaf nodes, which are the attack methodologies that represent unique attacks. Figure 3 shows a simple example.</p>\n  <p>\n    <img alt=\"\" src=\"http://msdn2.microsoft.com/en-us/library/ms978527.f01tmwa03(en-us,MSDN.10).gif\" border=\"0\" />\n  </p>\n  <p>\n    <b>Figure 3. Attack tree example</b>\n  </p>\n  <p>You can label leaf nodes with AND and OR labels. For example, in Figure 3, both 1.1 and 1.2 must occur for the threat to result in an attack.</p>\n  <p>Attack trees like the one in Figure 3 have a tendency to become complex quickly. They are also time-consuming to create. An alternative approach is to structure your attack tree using an outline, such as the following.</p>\n  <div>\n    <pre>1.  Goal One<br />    1.1 Sub-goal one<br />    1.2 Sub-goal two2<br />2.  Goal Two<br />    2.1 Sub-goal one<br />    2.2 Sub-goal two  </pre>\n  </div>\n  <blockquote>\n    <b>Note</b>&nbsp;&nbsp;&nbsp;In addition to goals and sub-goals, attack trees include methodologies and required conditions. </blockquote>\n  <p>The following is a more complete example of the outline approach.</p>\n  <div>\n    <pre>Threat #1 Attacker obtains authentication credentials by monitoring the network<br />  1.1 Clear text credentials sent over the network<br /> AND<br />  1.2 Attacker uses network-monitoring tools<br />      1.2.1 Attacker recognizes credential data  </pre>\n  </div>\n  <h1>Step 5: Identify Vulnerabilities</h1>\n  <p>In this step, you review the Web application security frame and explicitly look for vulnerabilities. Focus on the vulnerability categories as you did while identifying threats in the previous step. However, note that the sample questions presented in this section are designed to help you identify vulnerabilities, not threats. A useful way of proceeding is to examine your application layer by layer, considering each of the vulnerability categories in each layer.</p>\n  <h2>Authentication</h2>\n  <p>Identify authentication vulnerabilities by asking the following: </p>\n  <ul>\n    <li>Are user names and passwords sent in clear text over an unprotected channel? Is any ad hoc cryptography used for sensitive information? </li>\n    <li>Are credentials stored? If they are stored, how are they stored and protected? </li>\n    <li>Do you enforce strong passwords? What other password policies are enforced? </li>\n    <li>How are credentials verified? </li>\n    <li>How is the authenticated user identified after the initial logon? </li>\n  </ul>\n  <p>Review authentication by looking for these common vulnerabilities: </p>\n  <ul>\n    <li>Passing authentication credentials or authentication cookies over unencrypted network links, which can lead to credential capture or session hijacking </li>\n    <li>Using weak password and account policies, which can lead to unauthorized access </li>\n    <li>Mixing personalization with authentication </li>\n  </ul>\n  <h2>Authorization</h2>\n  <p>Identify authorization vulnerabilities by asking the following: </p>\n  <ul>\n    <li>What access controls are used at the entry points of the application? </li>\n    <li>Does your application use roles? If it uses roles, are they sufficiently granular for access control and auditing purposes? </li>\n    <li>Does your authorization code fail securely and grant access only upon successful confirmation of credentials? </li>\n    <li>Do you restrict access to system resources? </li>\n    <li>Do you restrict database access? </li>\n    <li>How is authorization enforced at the database? </li>\n  </ul>\n  <p>Review authorization by looking for these common vulnerabilities: </p>\n  <ul>\n    <li>Using over-privileged roles and accounts </li>\n    <li>Failing to provide sufficient role granularity </li>\n    <li>Failing to restrict system resources to particular application identities </li>\n  </ul>\n  <h2>Input and Data Validation</h2>\n  <ul>\n    <li>Identify input and data validation vulnerabilities by asking the following: </li>\n    <li>Is all input data validated? </li>\n    <li>Do you validate for length, range, format, and type? </li>\n    <li>Do you rely on client-side validation? </li>\n    <li>Could an attacker inject commands or malicious data into the application? </li>\n    <li>Do you trust data you write out to Web pages, or do you need to HTML-encode it to help prevent cross-site scripting attacks? </li>\n    <li>Do you validate input before using it in SQL statements to help prevent SQL injection? </li>\n    <li>Is data validated at the recipient entry point as it is passed between separate trust boundaries? </li>\n    <li>Can you trust data in the database? </li>\n    <li>Do you accept input file names, URLs, or user names? Have you addressed canonicalization issues? </li>\n  </ul>\n  <p>Review input validation by looking for these common vulnerabilities: </p>\n  <ul>\n    <li>Relying exclusively on client-side validation </li>\n    <li>Using a <i>deny</i> approach instead of <i>allow</i> for filtering input </li>\n    <li>Writing data you did not validate out to Web pages </li>\n    <li>Using input you did not validate to generate SQL queries </li>\n    <li>Using insecure data access coding techniques, which can increase the threat posed by SQL injection </li>\n    <li>Using input file names, URLs, or user names for security decisions </li>\n  </ul>\n  <h2>Configuration Management</h2>\n  <p>Identify configuration management vulnerabilities by asking the following: </p>\n  <ul>\n    <li>How do you protect remote administration interfaces? </li>\n    <li>Do you protect configuration stores? </li>\n    <li>Do you encrypt sensitive configuration data? </li>\n    <li>Do you separate administrator privileges? </li>\n    <li>Do you use least privileged process and service accounts? </li>\n  </ul>\n  <p>Review configuration management by looking for these common vulnerabilities: </p>\n  <ul>\n    <li>Storing configuration secrets, such as connection strings and service account credentials, in clear text </li>\n    <li>Failing to protect the configuration management aspects of your application, including administration interfaces </li>\n    <li>Using over-privileged process accounts and service accounts </li>\n  </ul>\n  <h2>Sensitive Data</h2>\n  <p>Identify sensitive data vulnerabilities by asking the following: </p>\n  <ul>\n    <li>Do you store secrets in persistent stores? </li>\n    <li>How do you store sensitive data? </li>\n    <li>Do you store secrets in memory? </li>\n    <li>Do you pass sensitive data over the network? </li>\n    <li>Do you log sensitive data? </li>\n  </ul>\n  <p>Review sensitive data by looking for these common vulnerabilities: </p>\n  <ul>\n    <li>Storing secrets when you do not need to store them </li>\n    <li>Storing secrets in code </li>\n    <li>Storing secrets in clear text </li>\n    <li>Passing sensitive data in clear text over networks </li>\n  </ul>\n  <h2>Session Management</h2>\n  <p>Identify session management vulnerabilities by asking the following: </p>\n  <ul>\n    <li>How are session cookies generated? </li>\n    <li>How are session identifiers exchanged? </li>\n    <li>How is session state protected as it crosses the network? </li>\n    <li>How is session state protected to prevent session hijacking? </li>\n    <li>How is the session state store protected? </li>\n    <li>Do you restrict session lifetime? </li>\n    <li>How does the application authenticate with the session store? </li>\n    <li>Are credentials passed over the network and are they maintained by the application? If they are, how are they protected? </li>\n  </ul>\n  <p>Review session management by looking for these common vulnerabilities: </p>\n  <ul>\n    <li>Passing session identifiers over unencrypted channels </li>\n    <li>Prolonged session lifetime </li>\n    <li>Insecure session state stores </li>\n    <li>Session identifiers in query strings </li>\n  </ul>\n  <h2>Cryptography</h2>\n  <p>Identify cryptography vulnerabilities by asking the following: </p>\n  <ul>\n    <li>What algorithms and cryptographic techniques are used? </li>\n    <li>Do you use custom encryption algorithms? </li>\n    <li>Why do you use particular algorithms? </li>\n    <li>How long are encryption keys, and how are they protected? </li>\n    <li>How often are keys recycled? </li>\n    <li>How are encryption keys distributed? </li>\n  </ul>\n  <p>Review cryptography by looking for these common vulnerabilities: </p>\n  <ul>\n    <li>Using custom cryptography </li>\n    <li>Using the wrong algorithm or a key size that is too small </li>\n    <li>Failing to protect encryption keys </li>\n    <li>Using the same key for a prolonged period of time </li>\n  </ul>\n  <h2>Parameter Manipulation</h2>\n  <p>Identify parameter manipulation parameters by asking the following: </p>\n  <ul>\n    <li>Do you validate all input parameters? </li>\n    <li>Do you validate all parameters in form fields, view state, cookie data, and HTTP headers? </li>\n    <li>Do you pass sensitive data in parameters? </li>\n    <li>Does the application detect tampered parameters? </li>\n  </ul>\n  <p>Review parameter manipulation by looking for these common vulnerabilities: </p>\n  <ul>\n    <li>Failing to validate all input parameters. This makes your application susceptible to denial of service attacks and code injection attacks, including SQL injection and XSS. </li>\n    <li>Including sensitive data in unencrypted cookies. Cookie data can be changed at the client or it can be captured and changed as it is passed over the network. </li>\n    <li>Including sensitive data in query strings and form fields. Query strings and form fields are easily changed on the client. </li>\n    <li>Trusting HTTP header information. This information is easily changed on the client. </li>\n  </ul>\n  <h2>Exception Management</h2>\n  <p>Identify exception management vulnerabilities by asking the following: </p>\n  <ul>\n    <li>How does the application handle error conditions? </li>\n    <li>Are exceptions ever allowed to propagate back to the client? </li>\n    <li>What type of data is included in exception messages? </li>\n    <li>Do you reveal too much information to the client? </li>\n    <li>Where do you log exception details? Are the log files secure? </li>\n  </ul>\n  <p>Review exception management by looking for these common vulnerabilities: </p>\n  <ul>\n    <li>Failing to validate all input parameters </li>\n    <li>Revealing too much information to the client </li>\n  </ul>\n  <h2>Auditing and Logging</h2>\n  <p>Identify auditing and logging vulnerabilities by asking the following: </p>\n  <ul>\n    <li>Have you identified key activities to audit? </li>\n    <li>Does your application audit activity across all layers and servers? </li>\n    <li>How are log files protected? </li>\n  </ul>\n  <p>Review auditing and logging by looking for these common vulnerabilities: </p>\n  <ul>\n    <li>Failing to audit failed logons </li>\n    <li>Failing to protect audit files </li>\n    <li>Failing to audit across application layers and servers </li>\n  </ul>\n  <h1>What to Do Next</h1>\n  <p>After you complete the threat modeling activity, do the following: </p>\n  <ul>\n    <li>If you capture your threat model in a document, keep the document lightweight and avoid over-formatting so you can easily update it. Key content should include your security objectives, key scenarios, protected resources, a threat list, and a vulnerability list. </li>\n    <li>Use the vulnerabilities to help shape your security design and implementation. For example, developers should notice anti-patterns related to the identified vulnerabilities and use patterns to address the issues. </li>\n    <li>Use the vulnerabilities to plan and scope your system testing. For example, testers should test against the vulnerabilities to verify that the development team fixed or addressed all vulnerabilities. </li>\n    <li>Track and prioritize vulnerabilities in your work item tracking system. </li>\n    <li>If you have high priority threats and you have no corresponding vulnerabilities, you need to make a decision. Without a vulnerability to track and act on, the threat you identified can be easily overlooked. Will you investigate it further to identify vulnerabilities or rule it out of scope or accept the risk? </li>\n    <li>Communicate the information you capture to relevant team members. This may include your application development team, your test team, and your network and system administrators. </li>\n  </ul>\n  <h1>Agile Considerations</h1>\n  <p>You should begin the threat modeling exercise early in your project so that the threat model influences the design of your application. To create and update the threat model, develop user stories. A user story describes what the application should do from the point of view of the customer. In this case, you would create stories around the threats, attacks, and security objectives. You should be able to complete a story in a single iteration. You may need to develop new stories as you create and update the threat model. </p>\n  <p>Consider the following when you plan your stories: </p>\n  <ul>\n    <li>Early in the project, reduce risk by creating a candidate architecture that supports architecturally significant end-to-end scenarios that exercise all layers of the architecture. </li>\n    <li>Create your first threat model for this candidate architecture. This will change, but it is a good starting point. </li>\n    <li>Using your threat model to guide you, make changes to your architecture, design, and code to meet your security objectives. </li>\n    <li>Create a threat model based on what you know at the time and define a list of questions that need to be addressed in subsequent stories and iterations. </li>\n    <li>After you make enough significant changes to the architecture and design, consider creating a story that reflects these changes. Batch together the small changes in the architecture and design and address them together. </li>\n    <li>If you need to work with outside security groups, you need to schedule a time to complete the threat model to provide to the external group. These groups tend to provide better input when they understand the entire application. </li>\n  </ul>\n  <h1>MSF Agile Considerations</h1>\n  <p>The Microsoft Solutions Framework (MSF) Agile Software Development processes use the architecture diagrams found in the Microsoft Visual Studio Team System. These processes use scenarios instead of use cases. Therefore, when applying the threat modeling activity to MSF for Agile Software Development or MSF for CMMI Process Improvement, use scenarios and system and logical data center diagrams as input. </p>\n  <p>For more information about building threat models using the system and logical data center diagrams, see the MSF process guidance or the MSF Web site. </p>\n  <h2>\n  </h2>\n  <p />\n  <hr />\n  <p>Adapted from Microsoft patterns & practices guidance.</p>"
        ]
      }
    ]
  }
}