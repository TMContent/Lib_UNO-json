{
  "TeamMentor_Article": {
    "$": {
      "Metadata_Hash": "1511839967",
      "Content_Hash": "-1128878689"
    },
    "Metadata": [
      {
        "Id": [
          "7c2df051-dbf3-407d-8093-23554d59fb51"
        ],
        "Id_History": [
          "7c2df051-dbf3-407d-8093-23554d59fb51,8b6c7a90-c699-405e-9b0c-573043801de1,"
        ],
        "Library_Id": [
          "be5273b1-d682-4361-99d9-6234f2d47eb7"
        ],
        "Title": [
          "[SINK] Windows Authentication Is Used to Connect to SQL Server"
        ],
        "Category": [
          "Authentication"
        ],
        "Phase": [
          "Implementation"
        ],
        "Technology": [
          ".NET 3.5"
        ],
        "Type": [
          "Checklist Item"
        ],
        "DirectLink": [
          "Windows Authentication Is Used to Connect to SQL Server"
        ],
        "Tag": [
          "ASP.NET,ASP.NET 3.5,ASP"
        ],
        "Security_Demand": [
          ""
        ],
        "Author": [
          ""
        ],
        "Priority": [
          "2"
        ],
        "Status": [
          ""
        ],
        "Source": [
          "SI"
        ]
      }
    ],
    "Content": [
      {
        "$": {
          "Sanitized": "true",
          "DataType": "html"
        },
        "Data": [
          "<h1>What to Check For</h1>\n  <p>Ensure that Windows authentication is used when connecting the web-application to the SQL Server whenever possible.</p>\n  <h1>Why</h1>\n  <p>Windows Authentication offers several advantages over basic SQL Authentication:</p>\n  <ul>\n    <li>No credentials are passed over the network during authentication and you do not need to embed user names and passwords in the database connection string. When using basic SQL Authentication, the credentials are Base64 encoded and sent over the network. This encoding can be easily reversed and an attacker can obtain the credentials by monitoring the network. Using Windows Authentication prevents this scenario. <li>You can enforce Active Directory password policies. <li>Active Directory provides a single identity store with a single set of management tools. You do not have to maintain a separate set of SQL accounts. <li>You benefit from centralized account management. User accounts are subject to normal account management security policies such as password expiration periods, minimum lengths, and account lockout after multiple invalid logon requests.</li></li></li></li>\n  </ul>\n  <p>Not using Windows authentication is less robust, since a seperate set of access credentials need to be maintained in a seperate store, which significantly complictes the administration and account management tasks as the number of accounts grow.</p>\n  <h1>How to Check</h1>\n  <p>Windows authentication offers distinct security related advantages over other authentication methods. Take the following steps to ensure that Windows authentication is being used to connect to the SQL server:</p>\n  <ol>\n    <li>\n      <p>\n        <strong>Check that a connection string is configured.</strong> Check that the connection string is stored in the <strong>connectionStrings</strong>&gt; section of your application's web.config file and it includes either the '<strong>Trusted_Connection=Yes</strong>' attribute, or the equivalent attribute '<strong>Integrated Security=SSPI</strong>' as follows:</p>\n      <pre>\n        <connectionstrings>\n          <br />\n          <add name=\"MyLocalSQLServer1\">\n          </add>\n          <br />        connectionString=\"Server=MyServer;Database=pubs;Trusted_Connection=Yes;\"/&gt;<br /><add name=\"MyLocalSQLServer2\"></add><br />       connectionString=\"Initial Catalog=pubs;<br />       data source=localhost;Integrated Security=SSPI;\"<br />       providerName=\"System.Data.SqlClient\"/&gt;<br /></connectionstrings>\n      </pre>\n      <li>\n        <p>\n          <strong>Verify that the connection string is encrypted.</strong> Encrypting the connection string inside the configuration file ensures its confidentiality in case this file is compromised. Once the application accesses the configuration file, it should decrypt the connection string just before use. Once you have located the <strong>connectionStrings</strong>&gt; section in <strong>web.config,</strong> it should look like the following:</p>\n        <pre>\n          <connectionstrings>\n            <br />\n            <encrypteddata>\n              <br />\n              <cipherdata>\n                <br />\n                <ciphervalue>GHAFQEW234A21...</ciphervalue>\n                <br />\n              </cipherdata>\n              <br />\n            </encrypteddata>\n            <br />\n          </connectionstrings>\n        </pre>\n        <li>\n          <p>\n            <strong>Ensure that SQL Server security is configured.</strong> Check that a SQL Server login has been created for your application's service account, and it has been granted restricted permissions to access your database. Ensure that you have provided no direct table access, and limited access to selected stored procedures only. Where table access is necessary, check that you have granted the minimum access required. </p>\n          <li>\n            <p>\n              <strong>Test security access.</strong> Check database access to ensure that appropriate database permissions are provided and permissions unneccessary to the application's operation are denied. Refer to the <a href=\"/article/fab1733c-61d7-46a8-88c6-2617a643c0d9\">Use Least Privileged Accounts for Database Access</a> guideline.</p>\n          </li>\n        </li>\n      </li>\n    </li>\n  </ol>\n  <h1>Problem Example</h1>\n  <p>A web-application uses basic SQL Authentication to connect to its database server. This connection is not secured within the intranet and can be spied upon by users within the network. When the web-application connects to the database server, an attacker notices the following data being sent to the database server:</p>\n  <pre>RHJpdmVyPXtTUUwgU2VydmVyfTtTZXJ2ZXI9bXlTZXJ2ZXJBZ<br />GRyZXNzO0RhdGFiYXNlPW15RGF0YUJhc2U7VWlkPW15VXNlcm5hbWU7UHdkPW15UGFzc3dvcmQ7</pre>\n  <p>The attacker recognizes this as Base64 encoding and is able to decode it very easily. Upon decoding this string, the attacker sees the string:</p>\n  <pre>Driver=&amp;#123;SQL Server&amp;#125;;Server=myServerAddress;Database=myDataBase;Uid=myUsername;Pwd=myPassword;</pre>\n  <p>This connection string gives the attacker enough information to compromise the integrity of the database server.</p>\n  <p>Adapted from Microsoft patterns &amp; practices guidance. </p>"
        ]
      }
    ]
  }
}