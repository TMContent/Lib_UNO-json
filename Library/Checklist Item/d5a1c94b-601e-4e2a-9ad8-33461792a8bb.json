{
  "TeamMentor_Article": {
    "$": {
      "Metadata_Hash": "483670763",
      "Content_Hash": "-2020609598"
    },
    "Metadata": [
      {
        "Id": [
          "d5a1c94b-601e-4e2a-9ad8-33461792a8bb"
        ],
        "Id_History": [
          "d5a1c94b-601e-4e2a-9ad8-33461792a8bb,961f7b5b-37db-4e88-8851-507958322450,"
        ],
        "Library_Id": [
          "be5273b1-d682-4361-99d9-6234f2d47eb7"
        ],
        "Title": [
          "Parameterized APIs with Type-safe Parameters Are Used for Data Access"
        ],
        "Category": [
          "Database Security"
        ],
        "Phase": [
          "Implementation"
        ],
        "Technology": [
          "Java"
        ],
        "Type": [
          "Checklist Item"
        ],
        "DirectLink": [
          "Parameterized APIs Are Used for Data Access"
        ],
        "Tag": [
          ""
        ],
        "Security_Demand": [
          ""
        ],
        "Author": [
          ""
        ],
        "Priority": [
          "2"
        ],
        "Status": [
          ""
        ],
        "Source": [
          "SI"
        ]
      }
    ],
    "Content": [
      {
        "$": {
          "Sanitized": "true",
          "DataType": "markdown"
        },
        "Data": [
          "## Applies To ##\r\n\r\n* Java\r\n\r\n\r\n## What to Check For ##\r\n\r\nEnsure that type-safe SQL parameters are used with stored procedures or prepared statements when performing database transactions.\r\n\r\n\r\n## Why ##\r\n\r\nUse type-safe parameters with parameterized APIs to prevent SQL injection. Attackers can use a SQL injection to manipulate the database in unforeseen ways. SQL injection allows an attacker to execute arbitrary queries on the application database. In some cases, SQL injection can result in command execution.\r\n\r\n\r\n## How to Check ##\r\n\r\nTo check if parameterized APIs with type-safe parameters are used to execute SQL queries:\r\n\r\n1. **Identify all database transactions.** Locate all SQL queries throughout your application. Example: `\"select user from myappUsers where user = ? and pass = ?;\"`\r\n\r\n2. **Verify that each transaction uses stored procedures with type-safe parameters or prepared statements.** Verify that your application interacts with the backend database through the use of parameterized APIs instead of concatenating untrusted data into SQL syntax. \r\n\r\n    An example of using a stored procedure: \r\n\r\n        Connection.prepareStatement(\"exec PlaceOrder(?, ?, ?);\");\r\n\r\n    An example of using a prepared statement:\r\n\r\n        Connection cn = MyApp.getDBConnection();\r\n        PreparedStatement st = cn.prepareStatement(\r\n           \"select user from myappUsers where user = ? and pass = ?;\");\r\n        st.setString(1, user);\r\n        st.setString(2, new String(passDigest));\r\n        ResultSet rs = st.executeQuery();\r\n\r\n\r\n## How to Fix ##\r\n\r\nTo use type-safe SQL parameters with parameterized APIs, follow these steps:\r\n\r\n1. **Identify the SQL queries.** Locate all SQL queries throughout your application. Example:\r\n\r\n\t\tConnection cn = MyApp.getDBConnection();\r\n\t\tStatement st = cn.createStatement();\r\n\t\tString query = \"select login_attempts from myappUsers where user = \\\"\" + user\r\n\t\t\t\t\t + \"\\\" and pass = \\\"\" + new String(passDigest) + \"\\\";\";\r\n\t\tResultSet rs = st.executeQuery(query);\r\n\r\n2. **Identify the parameters in each SQL query.** After locating all SQL queries, identify the parameters in each query. Understand the format and type of each parameter's data.\r\n\r\n3. **Use PreparedStatement or stored procedures.** Java supports parameterized queries via its PreparedStatement class. PreparedStatement is mapped by most databases to a parameterized query or a stored procedure. Turn all SQL queries into parameterized queries. To accomplish this, turn all Statement objects into PreparedStatement objects. For example, the SQL query from Step 1 would be:\r\n\r\n\t\tConnection cn = MyApp.getDBConnection();\r\n\t\tPreparedStatement st = cn.prepareStatement(\"select login_attempts from myappUsers\"\r\n\t\t\t\t\t\t\t + \" where user = ? and pass = ?;\");\r\n\t\tst.setString(1, user);\r\n\t\tst.setString(2, new String(passDigest));\r\n\t\tResultSet rs = st.executeQuery();\r\n\r\n\r\n## Problem Example ##\r\n\r\nIn the following example untrusted input is concatenated into SQL syntax, which causes SQL injection.\r\n\r\n\t// The application crafts the SQL query based on user's input\r\n\tConnection cn = MyApp.getDBConnection();\r\n\tStatement st = cn.createStatement();\r\n\tString query = \"select login_attempts from myappUsers where user = \\\"\"\r\n\t\t\t\t+ user + \"\\\" and pass = \\\"\" + passHash + \"\\\";\";\r\n\tResultSet rs = st.executeQuery(query);\r\n\r\n\r\n## Solution Example ##\r\n\r\nThe following code uses PreparedStatement, which prevents SQL injection:\r\n\r\n\t// The application uses parameterized queries\r\n\tConnection cn = MyApp.getDBConnection();\r\n\tPreparedStatement st = cn.prepareStatement(\"select user from myappUsers\"\r\n\t\t\t\t\t\t+ \" where user = ? and pass = ?;\");\r\n\tst.setString(1, user);\r\n\tst.setString(2, passHash);\r\n\tResultSet rs = st.executeQuery();\r\n"
        ]
      }
    ]
  }
}