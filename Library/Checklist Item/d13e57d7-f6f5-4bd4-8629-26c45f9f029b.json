{
  "TeamMentor_Article": {
    "$": {
      "Metadata_Hash": "1202242816",
      "Content_Hash": "-1893620991"
    },
    "Metadata": [
      {
        "Id": [
          "d13e57d7-f6f5-4bd4-8629-26c45f9f029b"
        ],
        "Id_History": [
          "d13e57d7-f6f5-4bd4-8629-26c45f9f029b,5b3bd4e1-69c4-4d0b-824c-d86d1d737ef8,"
        ],
        "Library_Id": [
          "be5273b1-d682-4361-99d9-6234f2d47eb7"
        ],
        "Title": [
          "Exception Details Are Not Disclosed to the Client"
        ],
        "Category": [
          "Error and Exception Management"
        ],
        "Phase": [
          "Implementation"
        ],
        "Technology": [
          "Java"
        ],
        "Type": [
          "Checklist Item"
        ],
        "DirectLink": [
          "Exception Details Are Not Disclosed to the Client"
        ],
        "Tag": [
          ""
        ],
        "Security_Demand": [
          ""
        ],
        "Author": [
          ""
        ],
        "Priority": [
          "2"
        ],
        "Status": [
          ""
        ],
        "Source": [
          "SI"
        ]
      }
    ],
    "Content": [
      {
        "$": {
          "Sanitized": "true",
          "DataType": "html"
        },
        "Data": [
          "<h1>What to Check For</h1>\r\n  <p>Ensure that exception details are not disclosed to the client.</p>\r\n  <h1>Why</h1>\r\n  <p>Exceptions contain sensitive information about the application (e.g. call stack, fragments of code, etc.). Disclosing such information to an attacker could aid them&amp;nbsp;in attacking the system.</p>\r\n  <h1>How to Check</h1>\r\n  <p>Use the following steps to ensure that no exception details are disclosed to the client:</p>\r\n  <ol>\r\n    <li>\r\n      <p>\r\n        <strong>Verify that all expected exceptions are caught. </strong>Verifying that all expected exceptions are handled minimizes the risk of such exceptions surfacing to the root of the execution stack. Make sure all exceptions are handled accordingly.</p>\r\n    </li>\r\n    <li>\r\n      <p>\r\n        <strong>Verify that there is global exception handler. </strong>Global exception handling prevents unhandled exceptions&amp;nbsp;from surfacing&amp;nbsp;to the client. Make sure your application always has a global exception handler at the root of its code. In the case of Java Servlets, all root code will be at the servlet level. Example:</p>\r\n      <pre>public final class SampleServlet extends HttpServlet<br />{<br />      public void doGet(HttpServletRequest request, HttpServletResponse response)<br />            throws ServletException, IOException<br />      {<br />            ...<br />      }<br /><br />      public void doPost(HttpServletRequest request, HttpServletResponse response)<br />            throws ServletException, IOException<br />      {<br />            ...<br />      }<br />}</pre>\r\n    </li>\r\n    <li>\r\n      <p>\r\n        <strong>Verify that all exceptions are either logged or discarded. </strong>Exceptions should be always logged or discarded. Because exceptions contain information sensitive to the inner workings of the application data, they should never be exposed to the client. For example, the following code performs multiple authorization checks at the servlet level by using JAAS. Since multiple exceptions can be raised, the application will log the all raised exceptions associated with the \"AccessApp\" permission check and will discard all raised exceptions associated with the \"ModifyUsers\" permission check:</p>\r\n      <pre>public void doGet(HttpServletRequest request, HttpServletResponse response)<br />      throws ServletException, IOException<br />{<br />      String body;<br />      PrintWriter out = response.getWriter();<br /><br />      try<br />      {<br />            // Check if the user is a valid user<br />            Subject.doAsPrivileged(subject, new AuthAction(\"AccessApp\"), null);<br /><br />            boolean isAdmin = false;<br />            try<br />            {<br />                  // Check if the user has administrative privileges<br />                  Subject.doAsPrivileged(subject, new AuthAction(\"ModifyUsers\"), null);<br />                  isAdmin = true;<br />            }<br />            // If the user has no administrative privileges, the exception is discarded<br />            catch (Exception e) { }<br /><br />            if (isAdmin)<br />            {<br />                  ...<br />            }<br /><br />            else<br />            {<br />                  ...<br />            }<br />      }<br />      // If the user is not a valid user, an error message is returned to the client<br />      catch (Exception e)<br />      {<br />            // Add logging<br />            body = \"The system is not able to process your request at the time. Please try again later.\";<br />      }<br />      finally<br />      {<br />            out.println(body);<br />            out.flush();<br />            out.close();<br />      }<br />}</pre>\r\n    </li>\r\n    <li>\r\n      <p>\r\n        <strong>Ensure an error page is setup for all unhandled java.lang.Throwable exceptions.</strong> This configuration allows the application to gracefully catch exceptions and redirect the user to a generic error page.</p>\r\n      <pre>&amp;nbsp;&lt;error-page&gt;<br />&amp;nbsp;&amp;nbsp; &lt;exception-type&gt;java.lang.Throwable&lt;/exception-type&gt;<br />&amp;nbsp;&amp;nbsp; &lt;location&gt;/error/errorGeneric.jsp&lt;/location&gt;<br />&amp;nbsp;&lt;/error-page&gt;</pre>\r\n    </li>\r\n    <li>\r\n      <p>\r\n        <strong>Ensure an error page is setup for all relevant HTTPerror codes.</strong> This configuration allows the application to gracefully catch HTTP error codes and redirect the user to a generic error page.</p>\r\n      <pre>&amp;nbsp;&lt;error-page&gt;<br />&amp;nbsp;&amp;nbsp; &lt;error-code&gt;404&lt;/error-code&gt;<br />&amp;nbsp;&amp;nbsp; &lt;location&gt;/error/error404.jsp&lt;/location&gt;<br />&amp;nbsp;&lt;/error-page&gt;<br />&amp;nbsp;&lt;error-page&gt;<br />&amp;nbsp;&amp;nbsp; &lt;error-code&gt;500&lt;/error-code&gt;<br />&amp;nbsp;&amp;nbsp; &lt;location&gt;/error/error500.jsp&lt;/location&gt;<br />&amp;nbsp;&lt;/error-page&gt;</pre>\r\n    </li>\r\n  </ol>\r\n  <h1>How to Fix</h1>\r\n  <p>Exception handling is a mechanism used by the application to recover after unpredicted errors occur. To fully aid developers, exceptions contain important information such as call stack and lines of code. However, disclosing such information with the client should be avoided.</p>\r\n  <p>Data within the exceptions should be passed to you using your application's logging mechanism. The user on the client should only be notified that an error has occurred and should not be given internal application details. The exception can be hidden from the user by dynamically generating an error message or using a predefined JSP error page.</p>\r\n  <h2>Dynamically Generated Error Messages</h2>\r\n  <p>Certain error messages are dynamically generated when an exception is caught. Their use is triggered by unexpected errors such as a&amp;nbsp;failure to connect to a database server. Since dynamically generated error messages may contain user-supplied data, it is recommended to encode the user's input prior to displaying it to the client. </p>\r\n  <h2>JSP Error Messages</h2>\r\n  <p>JSP error pages provide an effective way of telling the user that something went wrong. Since JSP error pages are pre-designed and reveal little detailed information, error pages are used when your application needs a global exception handler or it is expected to fail. The location of the appropriate error page is specified in your application's web deployment descriptor (e.g. web.xml) using the <em>&lt;location&gt;</em> tag. </p>\r\n  <pre>&lt;!-- Catch a system error using an HTML page --&gt;<br />&lt;error-page&gt;<br />  &lt;exception-type&gt;java.lang.NullPointerException&lt;/exception-type&gt;<br />  &lt;location&gt;/NPEerror.html&lt;/location&gt;<br />&lt;/error-page&gt;</pre>\r\n  <p>The JSP error pages should begin with the <em>&lt;%@page %&gt;</em> tag. </p>\r\n  <p>For example:</p>\r\n  <pre>&lt;%@page isErrorPage=\"true\" %&gt;</pre>\r\n  <p>Creating error pages for specific exception types not only allows you to ensure that sensitive data is not sent to the client, but it also improves the user experience. Design your error pages so they are useful for a typical user (not a developer), and you are unlikely to include any information that an attacker will find useful.</p>\r\n  <h1>Problem Example</h1>\r\n  <p>The following code produces a data analysis based on a financial index. Unfortunately, there is no global exception handling. Therefore, an attacker can force the application to reveal its call stack and possibly the source code filenames&amp;nbsp;by triggering an unhandled exception.</p>\r\n  <pre>import java.io.*;<br />import java.util.*;<br />import java.lang.*;<br />import javax.servlet.*;<br />import javax.servlet.http.*;import java.util.regex.*;<br /><br />public final class DataAggregator extends HttpServlet<br />{<br />      public void doGet(HttpServletRequest request, HttpServletResponse response)<br />            throws ServletException, IOException<br />      {<br />            PrintWriter out = response.getWriter();<br />            String searchTerm = request.getParameter(\"index\");<br />             // The application does not provide a global exception handler<br />            if (validateSearchTerm(searchTerm))<br />            {<br />                  String retString;<br />                  retString = \"The queried index \\\"\";<br />                  retString += encodeHtml(searchTerm);<br />                  retString += \"\\\" produced the following results:&lt;br&gt; \";<br />                  out.println(retString);<br />                  aggregateData(out, searchTerm);<br />            }<br />            else<br />            {<br />                  // Add the appropriate logging mechanisms<br />                  // Consult the Logging section<br />                   out.println(\"We cannot handle your request at the moment.\"<br />                             + \"Please try again later.\");<br />            } <br />            out.flush();<br />            out.close();<br />      }<br />}</pre>\r\n  <h1>Solution Example</h1>\r\n  <p>The following code produces a data analysis based on a financial index. Because the code provides a global exception handler, it is impossible for an unhandled exception to surface to the client. Therefore, no debug and source data will be disclosed&amp;nbsp;to the attacker.</p>\r\n  <pre>import java.io.*;<br />import java.util.*;<br />import java.lang.*;<br />import javax.servlet.*;<br />import javax.servlet.http.*;<br />import java.util.regex.*;<br /><br />public final class DataAggregator extends HttpServlet{<br />      public void doGet(HttpServletRequest request, HttpServletResponse response)<br />            throws ServletException, IOException<br />      {<br />            PrintWriter out = response.getWriter();<br />            String searchTerm = request.getParameter(\"index\");<br />             // The application provides a global exception handler<br />            try<br />            {<br />                  if (validateSearchTerm(searchTerm))<br />                  {<br />                        String retString;<br />                        retString = \"The queried index \\\"\";<br />                        retString += encodeHtml(searchTerm);<br />                        retString += \"\\\" produced the following results:&lt;br&gt; \";<br />                        out.println(retString);<br />                        aggregateData(out, searchTerm);<br />                  }<br />                  else<br />                  {<br />                        // Add the appropriate logging mechanisms<br />                        // Consult the Logging section<br />                         out.println(\"We cannot handle your request at the moment.\"<br />                                   + \"Please try again later.\");<br />                  }<br />            }<br />             catch (Throwable e)<br />            {<br />                  // Add the appropriate logging mechanisms<br />                  // Consult the Logging section<br />                   out.println(\"We cannot handle your request at the moment.\"<br />                             + \"Please try again later.\");<br />            }<br />            out.flush();<br />            out.close();<br />      }<br />}</pre>"
        ]
      }
    ]
  }
}