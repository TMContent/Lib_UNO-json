{
  "TeamMentor_Article": {
    "$": {
      "Metadata_Hash": "-261430353",
      "Content_Hash": "618896140"
    },
    "Metadata": [
      {
        "Id": [
          "b24a7dd0-a01a-4cbb-8559-6d566f54bd6c"
        ],
        "Id_History": [
          "b24a7dd0-a01a-4cbb-8559-6d566f54bd6c,4bc4a46c-0c81-4ccd-a46c-3c075d9a6dfc,"
        ],
        "Library_Id": [
          "be5273b1-d682-4361-99d9-6234f2d47eb7"
        ],
        "Title": [
          "[SINK] Health Monitoring Is Used for Logging And Auditing Events"
        ],
        "Category": [
          "Auditing and Logging"
        ],
        "Phase": [
          "Implementation"
        ],
        "Technology": [
          ".NET 3.5"
        ],
        "Type": [
          "Checklist Item"
        ],
        "DirectLink": [
          "Health Monitoring Is Used for Logging And Auditing Events"
        ],
        "Tag": [
          "ASP.NET,ASP.NET 3.5,ASP"
        ],
        "Security_Demand": [
          ""
        ],
        "Author": [
          ""
        ],
        "Priority": [
          "2"
        ],
        "Status": [
          ""
        ],
        "Source": [
          "SI"
        ]
      }
    ],
    "Content": [
      {
        "$": {
          "Sanitized": "true",
          "DataType": "Html"
        },
        "Data": [
          "<h1>What to Check For</h1>\r\n  <p>Check to ensure that&amp;nbsp;the ASP.NET Health Monitoring feature is used for logging.</p>\r\n  <h1>Why</h1>\r\n  <p>ASP.NET health monitoring supports many standard events that you can use to monitor the health of your application. Examples of security related events that are automatically generated include logon failures and successes when using the ASP.NET membership system, attempts to tamper with or reuse forms authentication tickets, and infrastructure events such as disk access failures. </p>\r\n  <p>The health monitoring feature includes built-in providers that allow you to log events to an email message, to SQL server, to the event log, as an ASP.NET trace output, or to the Windows Management Instrumentation (WMI) web event provider.</p>\r\n  <h1>How to Check</h1>\r\n  <p>You can recognize the use of health monitoring by scanning your configuration files:</p>\r\n  <ol>\r\n    <li>\r\n      <p>\r\n        <strong>Check If Health Monitoring is turned on. </strong>Health Monitoring is turned on by default in the machine level Web.Config file:</p>\r\n      <pre>&lt;healthMonitoring heartbeatInterval=\"0\" enabled=\"true\"&gt;  <br />&lt;bufferModes/&gt;  <br />&lt;providers/&gt;  <br />&lt;profiles/&gt;  <br />&lt;rules/&gt;  <br />&lt;eventMappings/&gt;<br />&lt;/healthMonitoring&gt;</pre>\r\n      <p>If the Enabled attribute is set to false in your machine or application level config file, then health monitoring has been turned off.&amp;nbsp; </p>\r\n      <li>\r\n        <p>\r\n          <strong>Check if Health Monitoring rules are enabled. </strong>By default the rules element is configured so that all errors and failure audits are logged:</p>\r\n        <pre>&lt;rules&gt; <br />&lt;add name=\"All Errors Default\" eventName=\"All Errors\" provider=\"EventLogProvider\"      <br />&amp;#9;profile=\"Default\" minInstances=\"1\" maxLimit=\"Infinite\"       <br />&amp;#9;minInterval=\"00:01:00\" custom=\"\" /&gt; <br />&lt;add name=\"Failure Audits Default\" eventName=\"Failure Audits\"      <br />&amp;#9;provider=\"EventLogProvider\" profile=\"Default\" minInstances=\"1\"     <br />&amp;#9;maxLimit=\"Infinite\" minInterval=\"00:01:00\" custom=\"\" /&gt;<br />&lt;/rules&gt;</pre>\r\n        <p>If there are no rules in the rules element, then health monitoring will not log any events.</p>\r\n      </li>\r\n    </li>\r\n  </ol>\r\n  <h1>How to Fix</h1>\r\n  <p>By default, health monitoring is enabled for ASP.NET applications and all Web infrastructure error events (inheriting from <b>System.Web.Management.WebErrorEvent</b>) and all audit failure events (inheriting from <b>System.Web.Management.WebFailureAuditEvent</b>) are written to the event log.&amp;nbsp; The default configuration is defined in the <b>&lt;healthMonitoring&gt;</b> element in the machine-level Web.config file.&amp;nbsp; To audit additional security related events, you create custom event types by deriving from one of the built-in types. </p>\r\n  <p>The health monitoring feature has built-in providers that allow you to log events in an e-mail message (<b>SimpleMailWebEventProvider</b>, <b>TemplatedMailWebEventProvider</b>), to SQL Server (<b>SqlWebEventProvider</b>), to the event log (<b>EventLogWebEventProvider</b>), as ASP.NET trace output (<b>TraceWebEventProvider</b>), or to the Windows Management Instrumentation (WMI) Web event provider (<b>WMIWebEventProvider</b>).&amp;nbsp; You can configure health monitoring in the machine or application Web.config file to modify the events that are logged and the way in which they are logged.&amp;nbsp;&amp;nbsp;</p>\r\n  <h1>Problem Example</h1>\r\n  <p>An ASP.NET application is deployed on a machine in which the machine level web.config file has been unchanged from default values.&amp;nbsp; However, the application-level web.config file has been modified so that health monitoring is turned off:</p>\r\n  <pre>&lt;healthMonitoring heartbeatInterval=\"0\" enabled=\"false\"&gt;</pre>\r\n  <h1>Solution Example</h1>\r\n  <p>An ASP.NET application is deployed on a machine in which the health monitoring element has been unchanged from defaults in both the machine level and application level web.config files, with one exception.&amp;nbsp; </p>\r\n  <p>The defaults look like:</p>\r\n  <pre>&lt;healthMonitoring heartbeatInterval=\"0\" enabled=\"true\"&gt;<br />&lt;rules&gt; <br />&lt;add name=\"All Errors Default\" eventName=\"All Errors\" provider=\"EventLogProvider\"      <br />&amp;#9;profile=\"Default\" minInstances=\"1\" maxLimit=\"Infinite\"      <br />&amp;#9;minInterval=\"00:01:00\" custom=\"\" /&gt; <br />&lt;add name=\"Failure Audits Default\" eventName=\"Failure Audits\"     <br />&amp;#9;provider=\"EventLogProvider\" profile=\"Default\" minInstances=\"1\"     <br />&amp;#9;maxLimit=\"Infinite\" minInterval=\"00:01:00\" custom=\"\" /&gt;<br />&lt;/rules&gt;<br />&lt;/healthMonitoring&gt;</pre>\r\n  <p>The only exception to the defaults is that A SQL event provider has been added:</p>\r\n  <pre>&lt;providers&gt;   <br />&lt;add connectionStringName=\"MySqlConnection\"      <br />&amp;#9;maxEventDetailsLength=\"1073741823\"      <br />&amp;#9;buffer=\"true\"      <br />&amp;#9;bufferMode=\"Extra Critical Notification\"       <br />&amp;#9;name=\"MySqlWebEventProvider\"       <br />&amp;#9;type=\"System.Web.Management.SqlWebEventProvider,System.Web,Version=2.0.0.0,Culture=neutral,PublicKeyToken=b03f5f7f11d50a3a\" /&gt; <br />&lt;/providers&gt;</pre>\r\n  <h1>Related Items</h1>\r\n  <ul>\r\n    <li>\r\n      <a href=\"/article/7317fcb7-b91b-4184-b5e4-01a25b8baf00\">Use Health Monitoring for Logging and Auditing Events</a>\r\n    </li>\r\n  </ul>\r\n  <hr />\r\n  <p>Adapted from Microsoft patterns &amp; practices guidance. </p>"
        ]
      }
    ]
  }
}