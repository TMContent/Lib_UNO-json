{
  "TeamMentor_Article": {
    "$": {
      "Metadata_Hash": "-1179870312",
      "Content_Hash": "1086183803"
    },
    "Metadata": [
      {
        "Id": [
          "c88e1b49-357d-4202-aafc-86ce0de485bd"
        ],
        "Id_History": [
          "c88e1b49-357d-4202-aafc-86ce0de485bd,c3898a20-55ca-4572-98c6-3f730b8b54cf,"
        ],
        "Library_Id": [
          "be5273b1-d682-4361-99d9-6234f2d47eb7"
        ],
        "Title": [
          "A Global Exception Handler Is Used for Unhandled Exceptions"
        ],
        "Category": [
          "Error and Exception Management"
        ],
        "Phase": [
          "Implementation"
        ],
        "Technology": [
          "Java"
        ],
        "Type": [
          "Checklist Item"
        ],
        "DirectLink": [
          "A Global Exception Handler Is Used for Unhandled Exceptions"
        ],
        "Tag": [
          ""
        ],
        "Security_Demand": [
          ""
        ],
        "Author": [
          ""
        ],
        "Priority": [
          "2"
        ],
        "Status": [
          ""
        ],
        "Source": [
          "SI"
        ]
      }
    ],
    "Content": [
      {
        "$": {
          "Sanitized": "true",
          "DataType": "html"
        },
        "Data": [
          "<h1>What to Check For</h1>\r\n  <p>Ensure that&amp;nbsp;a global exception handler has been implemented.</p>\r\n  <h1>Why</h1>\r\n  <p>Unhandled exceptions must be avoided as they can result in the application entering an unknown state and/or revealing sensitive internal application details. Using a global exception handler will prevent unhandled exceptions and help protect the application's performance and security.</p>\r\n  <h1>How to Check</h1>\r\n  <p>To check that your application has a global exception handling mechanism:</p>\r\n  <ol>\r\n    <li>\r\n      <p>\r\n        <strong>Identify all root code. </strong>Locate all root code inside your application. In the case of Java Servlets, all root code will be at the servlet level. Example:</p>\r\n      <pre>public final class SampleServlet extends HttpServlet<br />{<br />      public void doGet(HttpServletRequest request, HttpServletResponse response)<br />            throws ServletException, IOException<br />      {<br />            ...<br />      }<br />       public void doPost(HttpServletRequest request, HttpServletResponse response)<br />            throws ServletException, IOException<br />      {<br />            ...<br />      }<br />}</pre>\r\n    </li>\r\n    <li>\r\n      <p>\r\n        <strong>Verify that all exception handling at the root level is placed accordingly. </strong>Verify that all business logic at the root level is placed inside a <em>try/catch/finally</em> block. Make sure the caught exception is of type <em>Throwable</em>. Example:</p>\r\n      <pre>public void doGet(HttpServletRequest request, HttpServletResponse response)<br />      throws ServletException, IOException<br />{<br />      try<br />      {<br />            ...<br />      }<br />      catch (Throwable e)<br />      {<br />            // Add the appropriate logging mechanisms<br />      }<br />}</pre>\r\n    </li>\r\n    <li>\r\n      <strong>Verify that the application contains a global handler for java.lang.Throwable in your web.xml configuration file</strong>. A framework specific error handler (such as Struts, SpringMVC, JSF, etc.) may be desirable, but the web.xml handler is required as some exceptions can occur outside the framework.\r\n      <span><p /><pre>&lt;error-page&gt;<br />  &lt;exception-type&gt;java.lang.Throwable&lt;/exception-type&gt;<br />  &lt;location&gt;/error/myErrorPage.jsp&lt;/location&gt;<br />&lt;/error-page&gt;<br /></pre></span></li>\r\n    <li>\r\n      <strong>Additionally, HTTP error codes should be caught and handled by the application in the web.xml configuration file</strong>. This prevents detailed error information from being presented to the user in the case of a system error.\r\n        <pre>\r\n            &lt;error-page&gt;\r\n            &lt;error-code&gt;404&lt;/error-code&gt;\r\n            &lt;location&gt;/error/error404.jsp&lt;/location&gt;\r\n            &lt;/error-page&gt;\r\n            &lt;error-page&gt;\r\n            &lt;error-code&gt;500&lt;/error-code&gt;\r\n            &lt;location&gt;/error/error500.jsp&lt;/location&gt;\r\n            &lt;/error-page&gt;\r\n        </pre></li>\r\n  </ol>\r\n  <h1>How to Fix</h1>\r\n  <p>Global exception handlers will catch any exceptions that are not otherwise handled in your code. Use the following steps to set global exception handling:</p>\r\n  <ol>\r\n    <li>\r\n      <p>\r\n        <strong>Place handler in root code. </strong>Setting up the global exception handlers involves placing portions of the root execution code inside <em>try/catch/finally</em> blocks where the caught exception is of type <em>java.lang.Throwable</em>. Since the purpose of the global exceptions is to clean-up and bring your application into a known state, you should be careful when choosing which portions of the root execution code to place inside such blocks. Depending on your application's specifications, your application may either recover and continue working or exit gracefully. In each of these cases, the global exception handlers will be placed differently.</p>\r\n    </li>\r\n    <li>\r\n      <p>\r\n        <strong>Recover and continue. </strong>The root <em>try/catch/finally</em> block is placed inside a loop. This allows your application to recover from the exception and restart the execution of its current task. Example:</p>\r\n      <pre>public void doGet(HttpServletRequest request,<br />      HttpServletResponse response) throws ServletException, IOException{<br />      PrintWriter out = response.getWriter();<br />      workDone = false;<br /><br />      while (!workDone)<br />      {<br />            try<br />            {<br />                  ...<br />            }<br />            catch (Throwable e)<br />            {<br />                  logger.severe(\"Unhandled exception was caught:\\n\"<br />                            + e.toString());<br />                  out.println(\"An error has occurred.\");<br />            }<br />      }<br /><br />      out.flush();<br />      out.close();<br />}</pre>\r\n    </li>\r\n    <li>\r\n      <p>\r\n        <strong>Exit gracefully. </strong>There are two approaches to placing an exception handler that allows your application to exit gracefully:</p>\r\n      <ul>\r\n        <li>\r\n          <p>\r\n            <strong>Dynamic handling</strong>: This allows the handling to be conducted inside the Java code. It consists of placing the entire root execution code inside a <em>try/catch/finally</em> block. Using dynamic handling allows your application to log the error and provide an error message to the user without having to disclose any detailed information about the raised exception. Example:</p>\r\n          <pre>public void doGet(HttpServletRequest request,<br />      HttpServletResponse response) throws ServletException, IOException{<br />      PrintWriter out = response.getWriter();<br />      workDone = false;<br /><br />      try<br />      {<br />            ...<br />      }<br />      catch (Throwable e)<br />      {<br />            //Execute clean-up routine<br /><br />            logger.severe(\"Unhandled exception was caught:\\n\"<br />                       + e.toString());<br />            out.println(\"An error has occurred.\");<br />      }<br /><br />      out.flush();<br />      out.close();<br />}</pre>\r\n        </li>\r\n        <li>\r\n          <p>\r\n            <strong>JSP error pages</strong>: JSP error pages provide an effective way for placing a global exception handler. If an unhandled exception appears, JSP provides a mechanism for redirecting the user to an error page; therefore, the user never sees the actual error. Example:</p>\r\n          <pre>&lt;%@ page errorPage=\"error.html\" %&gt;</pre>\r\n          <p>The JSP error pages should begin with the <em>&lt;%@page %&gt;</em> tag. For example:</p>\r\n          <pre>&lt;%@ page isErrorPage=\"true\" %&gt;</pre>\r\n        </li>\r\n      </ul>\r\n    </li>\r\n    <li>\r\n      <p>\r\n        <strong>Ensure an error page is setup for all unhandled java.lang.Throwable exceptions.</strong> This configuration allows the application to gracefully catch exceptions and redirect the user to a generic error page</p>\r\n      <pre>&amp;nbsp;&lt;error-page&gt;<br />&amp;nbsp;&amp;nbsp; &lt;exception-type&gt;java.lang.Throwable&lt;/exception-type&gt;<br />&amp;nbsp;&amp;nbsp; &lt;location&gt;/error/errorGeneric.jsp&lt;/location&gt;<br />&amp;nbsp;&lt;/error-page&gt;</pre>\r\n    </li>\r\n    <li>\r\n      <p>\r\n        <strong>Ensure an error page is setup for all relevant HTTPerror codes.</strong> This configuration allows the application to gracefully catch HTTP error codes and redirect the user to a generic error page.</p>\r\n      <pre>&lt;error-page&gt;<br />&amp;nbsp;&amp;nbsp; &lt;error-code&gt;404&lt;/error-code&gt;<br />&amp;nbsp;&amp;nbsp; &lt;location&gt;/error/error404.jsp&lt;/location&gt;<br />&amp;nbsp;&lt;/error-page&gt;<br />&amp;nbsp;&lt;error-page&gt;<br />&amp;nbsp;&amp;nbsp; &lt;error-code&gt;500&lt;/error-code&gt;<br />&amp;nbsp;&amp;nbsp; &lt;location&gt;/error/error500.jsp&lt;/location&gt;<br />&amp;nbsp;&lt;/error-page&gt;</pre>\r\n    </li>\r\n  </ol>\r\n  <h1>Problem Example</h1>\r\n  <p>The following code produces a data analysis based on a financial index. Unfortunately, there is no global exception handling. Therefore, an attacker can force the application to reveal its call stack and possibly the source code filenames&amp;nbsp;by triggering an unhandled exception.</p>\r\n  <pre>import java.io.*;<br />import java.util.*;<br />import java.lang.*;<br />import javax.servlet.*;<br />import javax.servlet.http.*;<br />import java.util.regex.*;<br /><br />public final class DataAggregator extends HttpServlet{<br />      public void doGet(HttpServletRequest request, HttpServletResponse response)<br />            throws ServletException, IOException<br />      {<br />            PrintWriter out = response.getWriter();<br />            String searchTerm = request.getParameter(\"index\");<br /><br />            // The application does not provide a global exception handler<br />            if (validateSearchTerm(searchTerm))<br />            {<br />                  String retString;<br /><br />                  retString = \"The queried index \\\"\";<br />                  retString += encodeHtml(searchTerm);<br />                  retString += \"\\\" produced the following results:&lt;br&gt; \";<br />                  out.println(retString);<br />                  aggregateData(out, searchTerm);<br />            }<br />            else<br />            {<br />                  // Add the appropriate logging mechanisms<br />                  // Consult the Logging section<br /><br />                  out.println(\"We cannot handle your request at the moment.<br />                           + \" Please try again later.\");<br />            }<br /><br />            out.flush();<br />            out.close();<br />      }<br />}</pre>\r\n  <h1>Solution Example</h1>\r\n  <p>The following code produces a data analysis based on a financial index. Because the code provides a global exception, it is impossible for an unhandled exception to surface to the client. Therefore, no debug and source data will be disclosed&amp;nbsp;to the attacker.</p>\r\n  <pre>import java.io.*;<br />import java.util.*;<br />import java.lang.*;<br />import javax.servlet.*;<br />import javax.servlet.http.*;<br />import java.util.regex.*;<br /><br />public final class DataAggregator extends HttpServlet{<br />      public void doGet(HttpServletRequest request, HttpServletResponse response)<br />            throws ServletException, IOException<br />      {<br />            PrintWriter out = response.getWriter();<br />            String searchTerm = request.getParameter(\"index\");<br /><br />            // The application provides a global exception handler<br />            try<br />            {<br />                  if (validateSearchTerm(searchTerm))<br />                  {<br />                        String retString;<br /><br />                        retString = \"The queried index \\\"\";<br />                        retString += encodeHtml(searchTerm);<br />                        retString += \"\\\" produced the following results:&lt;br&gt; \";<br />                        out.println(retString);<br />                        aggregateData(out, searchTerm);<br />                  }<br />                  else<br />                  {<br />                        // Add the appropriate logging mechanisms<br />                        // Consult the Logging section<br /><br />                        out.println(\"We cannot handle your request at the moment.<br />                                 + \" Please try again later.\");<br />                  }<br />            }<br /><br />            catch (Throwable e)<br />            {<br />                  // Add the appropriate logging mechanisms<br />                  // Consult the Logging section<br /><br />                  out.println(\"We cannot handle your request at the moment.\"<br />                           + \" Please try again later.\");<br />            }<br /><br />            out.flush();<br />            out.close();<br />      }<br />}</pre>"
        ]
      }
    ]
  }
}