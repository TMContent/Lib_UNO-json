{
  "TeamMentor_Article": {
    "$": {
      "Metadata_Hash": "2095774266",
      "Content_Hash": "1426445762"
    },
    "Metadata": [
      {
        "Id": [
          "58e5c2d7-7917-4c79-b329-b676173f6764"
        ],
        "Id_History": [
          "58e5c2d7-7917-4c79-b329-b676173f6764,67c9afab-bb76-40c7-aca0-e15040a14bbb,"
        ],
        "Library_Id": [
          "c4b9cb6a-4561-4451-9b6c-4e59d73584f6"
        ],
        "Title": [
          "Use ESAPI to Override the SendRedirect() Method"
        ],
        "Category": [
          "Redirects and Forwards"
        ],
        "Phase": [
          "Implementation"
        ],
        "Technology": [
          "Java"
        ],
        "Type": [
          "Code Example"
        ],
        "DirectLink": [
          "Use ESAPI to Override the SendRedirect() Method"
        ],
        "Tag": [
          ""
        ],
        "Security_Demand": [
          ""
        ],
        "Author": [
          ""
        ],
        "Priority": [
          ""
        ],
        "Status": [
          ""
        ],
        "Source": [
          "SI"
        ]
      }
    ],
    "Content": [
      {
        "$": {
          "Sanitized": "true",
          "DataType": "Html"
        },
        "Data": [
          "<h1>Applies to</h1>\r\n  <ul>\r\n    <li>Java web-based applications.</li>\r\n  </ul>\r\n  <h1>Summary</h1>\r\n  <span>\r\n    <p>Use the ESAPI library to override the <em>HttpServletResponse.sendRedirect() </em>method.</p>\r\n  </span>\r\n  <h1>Objectives</h1>\r\n  <span>\r\n    <p>The ESAPI library provides a replacement method for the <em>HttpServletResponse.sendRedirect()</em> method that validates the redirect location to ensure it is a relative url within the application. This prevents unvalidated redirects, which can lead users to dangerous sites that may install malware or perform other harmful activities.</p>\r\n  </span>\r\n  <h1>Scenarios</h1>\r\n  <span>\r\n    <p>Applications that perform redirects are very common. It is also common to use dynamic data to construct a portion of the redirect. When this occurs, validation is necessary in order to prevent an attacker from using the dynamic portion of the redirect to lead a user to a dangerous external site. The following shows 2 examples. The first example uses the standard <em>sendRedirect()</em> method which allows an attacker to manipulate the redirect location possibly taking a user to a dangerous external site. The second example resolves this issue by using the <em>HTTPUtilities.sendRedirect()</em> method which performs a validation on the incoming location, and throws an <em>AccessControlException</em> if the location is not pointing to an expected internal resource.</p>\r\n  </span>\r\n  <h1>Solution Example</h1>\r\n  <span>\r\n    <p>An example of an insecure redirect is shown below:</p>\r\n    <pre>\r\n      <p>HttpServletRequest request = ...;</p>\r\n      <p>HttpServletResponse response = ...;</p>\r\n      <p>String location = request.getParameter(\"loc\") &#43; \"/other/url\";</p>\r\n      <p>response.sendRedirect(location);</p>\r\n    </pre>\r\n    <p>A more secure example using ESAPI is shown below:</p>\r\n    <pre>\r\n      <p>HttpServletRequest request = ...;</p>\r\n      <p>HttpServletResponse response = ...;</p>\r\n      <p>String location = request.getParameter(\"loc\") &#43; \"/other/url\";</p>\r\n      <p>try &#123;</p>\r\n      <p>&#9;ESAPI.httpUtilities().sendRedirect(response,location);</p>\r\n      <p>&#125; catch (AccessControlException ace) &#123;</p>\r\n      <p>&#9;//a bad location was attempted ... handle exception here</p>\r\n      <p>&#125;</p>\r\n    </pre>\r\n    <p>(Note that additional protections should be added, such as whitelist validation, but the example above is for simplicity.)</p>\r\n    <p>In addition to using this function, you'll need to update the <em>ESAPI.properties</em> file for your application to inform ESAPI what your application name is so it knows the expected relative path. An example of the snippet you need to update is below:</p>\r\n    <pre>Validator.Redirect=&#94;\\\\/myapp.&#42;&#36;</pre>\r\n  </span>\r\n  <h1>See Also</h1>\r\n  <span>\r\n    <ul>\r\n      <li>For more information about unvalidated redirects and forwards, please see <a href=\"https://www.owasp.org/index.php/Top_10_2010-A10\">https://www.owasp.org/index.php/Top_10_2010-A10</a><li>For more information about ESAPI, please see <a href=\"https://www.owasp.org/index.php/Category:OWASP_Enterprise_Security_API\">https://www.owasp.org/index.php/Category:OWASP_Enterprise_Security_API</a></li></li>\r\n    </ul>\r\n  </span>\r\n  <h1>Redirects and Forwards Guidelines</h1>\r\n  <ul>\r\n    <li>\r\n      <a href=\"/article/0ed7310a-a0fd-4074-9c0f-37f48cf2bf4f\">Don't Use Redirects or Forwards if Possible</a>\r\n      <li>\r\n        <a href=\"/article/be525e05-0785-4b0c-8266-1ab4a0be08ea\">Calculate Destinations of Redirects and Forwards Without User Input</a>\r\n        <li>\r\n          <a href=\"/article/8a8fe651-2168-4c88-b89a-0b6b442da2f8\">Use Mapping Values When Redirecting on User Input</a>\r\n          <li>\r\n            <a href=\"/article/e7a1c675-9cae-4c12-85f3-4eb4269c197d\">Validate Destinations of Redirects and Forwards</a>\r\n          </li>\r\n        </li>\r\n      </li>\r\n    </li>\r\n  </ul>\r\n  <h1>Redirects and Forwards Checklists</h1>\r\n  <ul>\r\n    <li>\r\n      <a href=\"/article/11e960d3-09c4-4b40-9e20-a17fbe3116e7\">Redirects and Forwards Are Not Used Unless Necessary</a>\r\n      <li>\r\n        <a href=\"/article/b77c82d9-0a87-4f01-9943-f3a9fc52b561\">Destinations of Redirects and Forwards Are Calculated Without User Input</a>\r\n        <li>\r\n          <a href=\"/article/7bef867d-4dcb-47ea-ac58-651b9552cc1c\">Mapping Values Are Used for Redirects and Forwards</a>\r\n          <li>\r\n            <a href=\"/article/346a9c98-e2ce-4551-85b4-ba8f4acdd9dc\">Destinations of Redirects and Forwards Are Validated</a>\r\n          </li>\r\n        </li>\r\n      </li>\r\n    </li>\r\n  </ul>\r\n  <h1>Redirects and Forwards Code Example</h1>\r\n  <ul>\r\n    <li>\r\n      <a href=\"/article/58e5c2d7-7917-4c79-b329-b676173f6764\">Use ESAPI to Override the sendRedirect() Method</a>\r\n    </li>\r\n  </ul>"
        ]
      }
    ]
  }
}