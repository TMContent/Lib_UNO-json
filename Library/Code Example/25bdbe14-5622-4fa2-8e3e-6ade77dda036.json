{
  "TeamMentor_Article": {
    "$": {
      "Metadata_Hash": "2063540344",
      "Content_Hash": "1070440173"
    },
    "Metadata": [
      {
        "Id": [
          "25bdbe14-5622-4fa2-8e3e-6ade77dda036"
        ],
        "Id_History": [
          "25bdbe14-5622-4fa2-8e3e-6ade77dda036,f55bd36a-c35a-4a48-a013-60015d52877d,"
        ],
        "Library_Id": [
          "be5273b1-d682-4361-99d9-6234f2d47eb7"
        ],
        "Title": [
          "[SINK] Export the Public Key from an RSA Key Pair for Distribution"
        ],
        "Category": [
          "Cryptography"
        ],
        "Phase": [
          "Implementation"
        ],
        "Technology": [
          ".NET 3.5"
        ],
        "Type": [
          "Code Example"
        ],
        "DirectLink": [
          "Export the Public Key from an RSA Key Pair for Distribution"
        ],
        "Tag": [
          "ASP.NET,ASP.NET 3.5,ASP"
        ],
        "Security_Demand": [
          ""
        ],
        "Author": [
          ""
        ],
        "Priority": [
          ""
        ],
        "Status": [
          ""
        ],
        "Source": [
          "ASP.NET 3.5"
        ]
      }
    ],
    "Content": [
      {
        "$": {
          "Sanitized": "true",
          "DataType": "Html"
        },
        "Data": [
          "<h1>Applies to</h1>\r\n  <ul>\r\n    <li>C#</li>\r\n  </ul>\r\n  <h1>Summary</h1>\r\n  <p>The purpose of this code snippet is to illustrate how the owner of an RSA key pair should export public key data for distribution. We save the key data to an XML file that can be communicated to recipients, who will then be able to send encrypted messages to the owner that only the key owner can read.</p>\r\n  <h1>Objective</h1>\r\n  <ul>\r\n    <li>Securely distribute the public component of a registry-stored keypair that other parties can use to only encrypt messages for the key owner</li>\r\n  </ul>\r\n  <h1>Scenarios</h1>\r\n  <ul>\r\n    <li>Distributed client-server architecture where clients need to send confidential encrypted messages to the server but don't need to ever read those messages <li>Application does not want to maintain a dedicated key store for encryption purposes</li></li>\r\n  </ul>\r\n  <h1>Solution Example</h1>\r\n  <pre>public void SerializeAndSaveRSAPublicKey(RSACryptoServiceProvider myRSA, string fileName)<br />&#123;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Convert the RSA public key to an xml string (passing \"false\" retrieves<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // only the public key instead of both the private and public key<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; string publicKeyXml = myRSA.ToXmlString(false);</pre>\r\n  <pre>\r\n    <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Write the XML data out to the file location of your choosing<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StreamWriter keyWriter = new StreamWriter(fileName);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; keyWriter.Write(publicKeyXml);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; keyWriter.Close();<br />&#125;</pre>\r\n  <h1>&nbsp;</h1>\r\n  <h1>Problem Example</h1>\r\n  <p>The following example demonstrates the generation of an RSA key pair and storage of both the public and private keys on the file system. </p>\r\n  <pre>// The RSA CSP class automatically generates public and private key material<br />// during construction<br />myRSA = new RSACryptoServiceProvider();</pre>\r\n  <pre>\r\n    <br />///// Store in the registry using DPAPI and a Registry ACL /////</pre>\r\n  <pre>\r\n    <br />// Convert the RSA public key to an xml string - passing \"true\" retrieves<br />// both the private and public key data from the RSA CSP<br />string keyPairXml = myRSA.ToXmlString(true);</pre>\r\n  <pre>\r\n    <br />// Open up the key pair file and read into a string<br />StreamWriter keyWriter = new StreamWriter(&#64;\"C:\\temp\\rsakeypair.xml\");<br />keyWriter.Write(keyPairXml);<br />keyWriter.Close();</pre>\r\n  <ul>\r\n    <li>If the file system becomes compromised the private key may be exposed and the confidentiality of any encrypted messages using this keypair could be compromised. <li>Distributing both public and private keys will allow anyone with access to the private key to decrypt messages that should have been intended for only the owner of the keypair. <li>Default encryption key size may not provide sufficient strength and security</li></li></li>\r\n  </ul>\r\n  <h1>Test Case</h1>\r\n  <p>The following classes must be included in any project making use of the sample code provided above:</p>\r\n  <pre>using System.IO;<br />using System.Security;<br />using System.Security.AccessControl;<br />using System.Security.Cryptography;<br />using System.Text;<br />using Microsoft.Win32;</pre>\r\n  <p>Execute the following code and then open up the file </p>\r\n  <pre>C:\\temp\\rsa_publickey.xml </pre>\r\n  <p>to see only the public key data included.</p>\r\n  <pre>static void Main(string&#91;&#93; args)<br />&#123;<br />&nbsp;&nbsp;&nbsp; // Generate an RSA keypair and a filename for export<br />&nbsp;&nbsp;&nbsp; myRSA = new RSACryptoServiceProvider(2048);<br />&nbsp;&nbsp;&nbsp; string fileName = &#64;\"C:\\temp\\publickey.xml\";</pre>\r\n  <pre>\r\n    <br />&nbsp;&nbsp;&nbsp; // Serialize the public key from an RSA key pair and write to a file<br />&nbsp;&nbsp;&nbsp; SerializeAndSaveRSAPublicKey(myRSA, fileName);<br />&#125;</pre>\r\n  <h1>Expected Result</h1>\r\n  <p>The following data is output to the file \"C:\\temp\\rsa_publickey.xml\":</p>\r\n  <pre>&lt;RSAKeyValue&gt;</pre>\r\n  <pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Modulus&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tnLAgAJwXXxYj&#43;2QPX6q/mHZZf23xSvvovoBlZ1Y7RbTlkY4N2nlcGxfR6mQcTTWKf<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WShQ7yEaX6rVfhhRhdaHLCsg7g3AmW2BsoBxWUijD81ZeNKyWrw8t0gjnigNR46&#43;Pq<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; O1Xi7R9aA&#43;PgaluhuZBBgJK2wIAlRJSPlTr5OjDr4vJlZiAG/VqmJVXioPfv1QI2hf<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LM86JgIcrD47L0K44tKwyhAj4PN1nsomjPeb0P9m9t3od/c&#43;yZGKk&#43;iJ1nwQwG02H/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EXROaO6YFKb3xijNv69gv&#43;ZLGc&#43;qssXs7Bs7CdzqmQvSylxuXkYz5bQG&#43;&#43;raYWm4l0<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 56WhtIRG8mqQ==<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/Modulus&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Exponent&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AQAB<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/Exponent&gt;<br />&lt;/RSAKeyValue&gt;</pre>\r\n  <h1>More Information</h1>\r\n  <p>RSA is an algorithm for public key (also knows as asymmetric) cryptography in which distinct public and private keys are created. Encryption operations makes use of the public key while decryption requires the private key. This offers an advantage over symmetric cryptography because the secret key used to decrypt a message does not need to be shared in order to support encryption of messages to a recipient. </p>\r\n  <p>The RSA private key must be securely stored in order to maintain the confidentiality of data encrypted using an individual's public RSA key. However, the public key can be freely distributed by the owner of the key pair to anyone who wishes to send an encrypted message to that owner. </p>\r\n  <h1>Additional Resources</h1>\r\n  <ul>\r\n    <li>RSACryptoServiceProvider(.NET): <a href=\"http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cpref/html/frlrfsystemsecuritycryptographyrsacryptoserviceproviderclassctortopic.asp\">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cpref/html/frlrfsystemsecuritycryptographyrsacryptoserviceproviderclassctortopic.asp</a></li>\r\n  </ul>\r\n  <hr />\r\n  <p>Adapted from Microsoft patterns & practices guidance.</p>"
        ]
      }
    ]
  }
}